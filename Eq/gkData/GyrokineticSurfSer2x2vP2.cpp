#include <GyrokineticModDecl.h> 
double GyrokineticSurf2x2vSer_X_P2_Bvars_0(const double q_, const double m_, const double cflL, const double cflR, const double *w, const double *dxv, const double amax_in, const double *Bmag, const double *BmagInv, const double *Gradpar, const double *BdriftX, const double *BdriftY, const double *Phi, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w[NDIM]: Cell-center coordinates. dxv[NDIM]: Cell spacing. H/f: Input Hamiltonian/distribution function. out: Incremented output 
  double dfac_x = 2.0/dxv[0]; 
  double dfac_y = 2.0/dxv[1]; 
  double dfac_v = 2.0/dxv[2]; 
  double dfac_m = 2.0/dxv[3]; 
  double wx = w[0]; 
  double wy = w[1]; 
  double wv = w[2]; 
  double wm = w[3]; 
  double wv2 = wv*wv; 
  double dfac_v2 = dfac_v*dfac_v; 
  double q2 = q_*q_; 
  double incr[48]; 
  // surface-averaged phase velocity in this direction 
  double alpha0 = (0.04166666666666666*(dfac_v2*(6.0*BdriftX[0]*m_*wv2-1.0*BmagInv[0]*(3.0*(3.872983346207417*Phi[6]-3.0*Phi[3])+5.196152422706631*Phi[2])*dfac_y*q_)+2.0*BdriftX[0]*m_))/(dfac_v2*q_); 

  double alpha[20]; 
  alpha[0] = (0.2357022603955158*(dfac_v2*(6.0*BdriftX[0]*m_*wv2+BmagInv[0]*((-11.61895003862225*Phi[6])+9.0*Phi[3]-5.196152422706631*Phi[2])*dfac_y*q_)+2.0*BdriftX[0]*m_))/(dfac_v2*q_); 
  alpha[1] = 0.7071067811865475*BmagInv[0]*(6.708203932499369*Phi[7]-3.872983346207417*Phi[5])*dfac_y; 
  alpha[2] = (1.632993161855453*BdriftX[0]*m_*wv)/(dfac_v*q_); 
  alpha[8] = (0.421637021355784*BdriftX[0]*m_)/(dfac_v2*q_); 
  double amax = 0.0; 
  bool upwind = false; 
  if(upwind) 
    amax = std::abs(alpha0); 
  else 
    amax = amax_in; 

  double Ghat[20]; 
  double favg[20]; 
  favg[0] = 0.7071067811865475*(2.23606797749979*(fr[11]+fl[11])+1.732050807568877*(fl[1]-1.0*fr[1])+fr[0]+fl[0]); 
  favg[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[19]+fl[19])+3.0*(fl[5]-1.0*fr[5]))+3.0*(fr[2]+fl[2])); 
  favg[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[21]+fl[21])+3.0*(fl[6]-1.0*fr[6]))+3.0*(fr[3]+fl[3])); 
  favg[3] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[25]+fl[25])+3.0*(fl[8]-1.0*fr[8]))+3.0*(fr[4]+fl[4])); 
  favg[4] = 0.7071067811865475*(2.23606797749979*(fr[32]+fl[32])+1.732050807568877*(fl[15]-1.0*fr[15])+fr[7]+fl[7]); 
  favg[5] = 0.7071067811865475*(2.23606797749979*(fr[35]+fl[35])+1.732050807568877*(fl[16]-1.0*fr[16])+fr[9]+fl[9]); 
  favg[6] = 0.7071067811865475*(2.23606797749979*(fr[37]+fl[37])+1.732050807568877*(fl[17]-1.0*fr[17])+fr[10]+fl[10]); 
  favg[7] = -0.1414213562373095*(8.660254037844387*fr[20]-1.0*(8.660254037844387*fl[20]+5.0*(fr[12]+fl[12]))); 
  favg[8] = -0.1414213562373095*(8.660254037844387*fr[23]-1.0*(8.660254037844387*fl[23]+5.0*(fr[13]+fl[13]))); 
  favg[9] = -0.1414213562373095*(8.660254037844387*fr[28]-1.0*(8.660254037844387*fl[28]+5.0*(fr[14]+fl[14]))); 
  favg[10] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[44]+fl[44])+3.0*(fl[31]-1.0*fr[31]))+3.0*(fr[18]+fl[18])); 
  favg[11] = -0.1414213562373095*(8.660254037844387*fr[33]-1.0*(8.660254037844387*fl[33]+5.0*(fr[22]+fl[22]))); 
  favg[12] = -0.1414213562373095*(8.660254037844387*fr[34]-1.0*(8.660254037844387*fl[34]+5.0*(fr[24]+fl[24]))); 
  favg[13] = -0.1414213562373095*(8.660254037844387*fr[36]-1.0*(8.660254037844387*fl[36]+5.0*(fr[26]+fl[26]))); 
  favg[14] = -0.1414213562373095*(8.660254037844387*fr[39]-1.0*(8.660254037844387*fl[39]+5.0*(fr[27]+fl[27]))); 
  favg[15] = -0.1414213562373095*(8.660254037844387*fr[41]-1.0*(8.660254037844387*fl[41]+5.0*(fr[29]+fl[29]))); 
  favg[16] = -0.1414213562373095*(8.660254037844387*fr[42]-1.0*(8.660254037844387*fl[42]+5.0*(fr[30]+fl[30]))); 
  favg[17] = -0.1414213562373095*(8.660254037844387*fr[45]-1.0*(8.660254037844387*fl[45]+5.0*(fr[38]+fl[38]))); 
  favg[18] = -0.1414213562373095*(8.660254037844387*fr[46]-1.0*(8.660254037844387*fl[46]+5.0*(fr[40]+fl[40]))); 
  favg[19] = -0.1414213562373095*(8.660254037844387*fr[47]-1.0*(8.660254037844387*fl[47]+5.0*(fr[43]+fl[43]))); 

  Ghat[0] = -0.125*((6.324555320336761*fr[11]-6.324555320336761*fl[11]-4.898979485566357*(fr[1]+fl[1])+2.828427124746191*fr[0]-2.828427124746191*fl[0])*amax-1.414213562373095*(alpha[8]*favg[8]+alpha[2]*favg[2]+alpha[1]*favg[1]+alpha[0]*favg[0])); 
  Ghat[1] = -0.008333333333333333*((94.8683298050514*fr[19]-94.8683298050514*fl[19]-73.48469228349535*(fr[5]+fl[5])+42.42640687119286*fr[2]-42.42640687119286*fl[2])*amax-21.21320343559643*alpha[8]*favg[12]-18.97366596101028*alpha[1]*favg[7]-21.21320343559643*(alpha[2]*favg[4]+alpha[0]*favg[1]+favg[0]*alpha[1])); 
  Ghat[2] = -0.008333333333333333*((94.8683298050514*fr[21]-94.8683298050514*fl[21]-73.48469228349535*(fr[6]+fl[6])+42.42640687119286*fr[3]-42.42640687119286*fl[3])*amax-18.97366596101028*(alpha[2]*favg[8]+favg[2]*alpha[8])-21.21320343559643*(alpha[1]*favg[4]+alpha[0]*favg[2]+favg[0]*alpha[2])); 
  Ghat[3] = -0.008333333333333333*((94.8683298050514*fr[25]-94.8683298050514*fl[25]-73.48469228349535*(fr[8]+fl[8])+42.42640687119286*fr[4]-42.42640687119286*fl[4])*amax-21.21320343559643*alpha[8]*favg[14]-21.21320343559643*(alpha[2]*favg[6]+alpha[1]*favg[5]+alpha[0]*favg[3])); 
  Ghat[4] = -0.008333333333333333*((94.86832980505142*fr[32]-94.86832980505142*fl[32]-73.48469228349535*(fr[15]+fl[15])+42.42640687119286*fr[7]-42.42640687119286*fl[7])*amax-18.97366596101028*(alpha[2]*favg[12]+alpha[1]*favg[11]+favg[4]*alpha[8])-21.21320343559643*(alpha[0]*favg[4]+alpha[1]*favg[2]+favg[1]*alpha[2])); 
  Ghat[5] = -0.008333333333333333*((94.86832980505142*fr[35]-94.86832980505142*fl[35]-73.48469228349535*(fr[16]+fl[16])+42.42640687119286*fr[9]-42.42640687119286*fl[9])*amax-21.21320343559643*alpha[8]*favg[18]-18.97366596101028*alpha[1]*favg[13]-21.21320343559643*(alpha[2]*favg[10]+alpha[0]*favg[5]+alpha[1]*favg[3])); 
  Ghat[6] = -0.008333333333333333*((94.86832980505142*fr[37]-94.86832980505142*fl[37]-73.48469228349535*(fr[17]+fl[17])+42.42640687119286*fr[10]-42.42640687119286*fl[10])*amax-18.97366596101028*alpha[2]*favg[14]-21.21320343559643*alpha[1]*favg[10]-18.97366596101028*favg[6]*alpha[8]-21.21320343559643*(alpha[0]*favg[6]+alpha[2]*favg[3])); 
  Ghat[7] = 0.008333333333333333*((73.48469228349536*(fr[20]+fl[20])-42.42640687119286*fr[12]+42.42640687119286*fl[12])*amax+21.21320343559643*alpha[2]*favg[11]+21.21320343559643*alpha[0]*favg[7]+18.97366596101028*alpha[1]*favg[1]); 
  Ghat[8] = 0.001190476190476191*((514.3928459844675*(fr[23]+fl[23])-296.98484809835*fr[13]+296.98484809835*fl[13])*amax+148.492424049175*alpha[1]*favg[12]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[8]+148.492424049175*favg[0]*alpha[8]+132.815661727072*alpha[2]*favg[2]); 
  Ghat[9] = 0.01863389981249824*((32.86335345030997*(fr[28]+fl[28])-18.97366596101028*fr[14]+18.97366596101028*fl[14])*amax+9.48683298050514*(alpha[2]*favg[16]+alpha[1]*favg[15]+alpha[0]*favg[9])); 
  Ghat[10] = -0.008333333333333333*((94.8683298050514*fr[44]-94.8683298050514*fl[44]-73.48469228349535*(fr[31]+fl[31])+42.42640687119286*fr[18]-42.42640687119286*fl[18])*amax-18.97366596101028*(alpha[2]*favg[18]+alpha[1]*favg[17])+((-18.97366596101028*alpha[8])-21.21320343559643*alpha[0])*favg[10]-21.21320343559643*(alpha[1]*favg[6]+alpha[2]*favg[5])); 
  Ghat[11] = 0.008333333333333333*((73.48469228349536*(fr[33]+fl[33])-42.42640687119286*fr[22]+42.42640687119286*fl[22])*amax+(18.97366596101028*alpha[8]+21.21320343559643*alpha[0])*favg[11]+21.21320343559643*alpha[2]*favg[7]+18.97366596101028*alpha[1]*favg[4]); 
  Ghat[12] = 0.001190476190476191*((514.3928459844675*(fr[34]+fl[34])-296.98484809835*fr[24]+296.98484809835*fl[24])*amax+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[12]+148.492424049175*(alpha[1]*favg[8]+favg[1]*alpha[8])+132.815661727072*alpha[2]*favg[4]); 
  Ghat[13] = 0.03227486121839514*((18.97366596101028*(fr[36]+fl[36])-10.95445115010333*fr[26]+10.95445115010333*fl[26])*amax+5.477225575051662*(alpha[2]*favg[17]+alpha[0]*favg[13])+4.898979485566357*alpha[1]*favg[5]); 
  Ghat[14] = 0.004610694459770734*((132.815661727072*(fr[39]+fl[39])-76.68115805072327*fr[27]+76.68115805072327*fl[27])*amax+38.34057902536163*alpha[1]*favg[18]+(24.49489742783179*alpha[8]+38.34057902536163*alpha[0])*favg[14]+38.34057902536163*favg[3]*alpha[8]+34.2928563989645*alpha[2]*favg[6]); 
  Ghat[15] = 0.03227486121839514*((18.97366596101028*(fr[41]+fl[41])-10.95445115010333*fr[29]+10.95445115010333*fl[29])*amax+5.477225575051662*(alpha[2]*favg[19]+alpha[0]*favg[15]+alpha[1]*favg[9])); 
  Ghat[16] = 0.006454972243679028*((94.86832980505142*(fr[42]+fl[42])-54.77225575051663*fr[30]+54.77225575051663*fl[30])*amax+27.38612787525831*alpha[1]*favg[19]+(24.49489742783179*alpha[8]+27.38612787525831*alpha[0])*favg[16]+27.38612787525831*alpha[2]*favg[9]); 
  Ghat[17] = 0.008333333333333333*((73.48469228349536*(fr[45]+fl[45])-42.42640687119286*fr[38]+42.42640687119286*fl[38])*amax+(18.97366596101028*alpha[8]+21.21320343559643*alpha[0])*favg[17]+21.21320343559643*alpha[2]*favg[13]+18.97366596101028*alpha[1]*favg[10]); 
  Ghat[18] = 0.001190476190476191*((514.3928459844675*(fr[46]+fl[46])-296.98484809835*fr[40]+296.98484809835*fl[40])*amax+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[18]+148.492424049175*alpha[1]*favg[14]+132.815661727072*alpha[2]*favg[10]+148.492424049175*favg[5]*alpha[8]); 
  Ghat[19] = 0.00116461873828114*((525.8136552049599*(fr[47]+fl[47])-303.5786553761646*fr[43]+303.5786553761646*fl[43])*amax+(135.7645019878172*alpha[8]+151.7893276880823*alpha[0])*favg[19]+151.7893276880823*(alpha[1]*favg[16]+alpha[2]*favg[15])+(32.86335345030997*alpha[8]+36.74234614174767*alpha[0])*favg[10]+36.74234614174767*(alpha[1]*favg[6]+alpha[2]*favg[5])); 
  incr[0] = 0.7071067811865475*Ghat[0]*dfac_x; 
  incr[1] = -1.224744871391589*Ghat[0]*dfac_x; 
  incr[2] = 0.7071067811865475*Ghat[1]*dfac_x; 
  incr[3] = 0.7071067811865475*Ghat[2]*dfac_x; 
  incr[4] = 0.7071067811865475*Ghat[3]*dfac_x; 
  incr[5] = -1.224744871391589*Ghat[1]*dfac_x; 
  incr[6] = -1.224744871391589*Ghat[2]*dfac_x; 
  incr[7] = 0.7071067811865475*Ghat[4]*dfac_x; 
  incr[8] = -1.224744871391589*Ghat[3]*dfac_x; 
  incr[9] = 0.7071067811865475*Ghat[5]*dfac_x; 
  incr[10] = 0.7071067811865475*Ghat[6]*dfac_x; 
  incr[11] = 1.58113883008419*Ghat[0]*dfac_x; 
  incr[12] = 0.7071067811865475*Ghat[7]*dfac_x; 
  incr[13] = 0.7071067811865475*Ghat[8]*dfac_x; 
  incr[14] = 0.7071067811865475*Ghat[9]*dfac_x; 
  incr[15] = -1.224744871391589*Ghat[4]*dfac_x; 
  incr[16] = -1.224744871391589*Ghat[5]*dfac_x; 
  incr[17] = -1.224744871391589*Ghat[6]*dfac_x; 
  incr[18] = 0.7071067811865475*Ghat[10]*dfac_x; 
  incr[19] = 1.58113883008419*Ghat[1]*dfac_x; 
  incr[20] = -1.224744871391589*Ghat[7]*dfac_x; 
  incr[21] = 1.58113883008419*Ghat[2]*dfac_x; 
  incr[22] = 0.7071067811865475*Ghat[11]*dfac_x; 
  incr[23] = -1.224744871391589*Ghat[8]*dfac_x; 
  incr[24] = 0.7071067811865475*Ghat[12]*dfac_x; 
  incr[25] = 1.58113883008419*Ghat[3]*dfac_x; 
  incr[26] = 0.7071067811865475*Ghat[13]*dfac_x; 
  incr[27] = 0.7071067811865475*Ghat[14]*dfac_x; 
  incr[28] = -1.224744871391589*Ghat[9]*dfac_x; 
  incr[29] = 0.7071067811865475*Ghat[15]*dfac_x; 
  incr[30] = 0.7071067811865475*Ghat[16]*dfac_x; 
  incr[31] = -1.224744871391589*Ghat[10]*dfac_x; 
  incr[32] = 1.58113883008419*Ghat[4]*dfac_x; 
  incr[33] = -1.224744871391589*Ghat[11]*dfac_x; 
  incr[34] = -1.224744871391589*Ghat[12]*dfac_x; 
  incr[35] = 1.58113883008419*Ghat[5]*dfac_x; 
  incr[36] = -1.224744871391589*Ghat[13]*dfac_x; 
  incr[37] = 1.58113883008419*Ghat[6]*dfac_x; 
  incr[38] = 0.7071067811865475*Ghat[17]*dfac_x; 
  incr[39] = -1.224744871391589*Ghat[14]*dfac_x; 
  incr[40] = 0.7071067811865475*Ghat[18]*dfac_x; 
  incr[41] = -1.224744871391589*Ghat[15]*dfac_x; 
  incr[42] = -1.224744871391589*Ghat[16]*dfac_x; 
  incr[43] = 0.7071067811865475*Ghat[19]*dfac_x; 
  incr[44] = 1.58113883008419*Ghat[10]*dfac_x; 
  incr[45] = -1.224744871391589*Ghat[17]*dfac_x; 
  incr[46] = -1.224744871391589*Ghat[18]*dfac_x; 
  incr[47] = -1.224744871391589*Ghat[19]*dfac_x; 

  outr[0] += incr[0]; 
  outr[1] += incr[1]; 
  outr[2] += incr[2]; 
  outr[3] += incr[3]; 
  outr[4] += incr[4]; 
  outr[5] += incr[5]; 
  outr[6] += incr[6]; 
  outr[7] += incr[7]; 
  outr[8] += incr[8]; 
  outr[9] += incr[9]; 
  outr[10] += incr[10]; 
  outr[11] += incr[11]; 
  outr[12] += incr[12]; 
  outr[13] += incr[13]; 
  outr[14] += incr[14]; 
  outr[15] += incr[15]; 
  outr[16] += incr[16]; 
  outr[17] += incr[17]; 
  outr[18] += incr[18]; 
  outr[19] += incr[19]; 
  outr[20] += incr[20]; 
  outr[21] += incr[21]; 
  outr[22] += incr[22]; 
  outr[23] += incr[23]; 
  outr[24] += incr[24]; 
  outr[25] += incr[25]; 
  outr[26] += incr[26]; 
  outr[27] += incr[27]; 
  outr[28] += incr[28]; 
  outr[29] += incr[29]; 
  outr[30] += incr[30]; 
  outr[31] += incr[31]; 
  outr[32] += incr[32]; 
  outr[33] += incr[33]; 
  outr[34] += incr[34]; 
  outr[35] += incr[35]; 
  outr[36] += incr[36]; 
  outr[37] += incr[37]; 
  outr[38] += incr[38]; 
  outr[39] += incr[39]; 
  outr[40] += incr[40]; 
  outr[41] += incr[41]; 
  outr[42] += incr[42]; 
  outr[43] += incr[43]; 
  outr[44] += incr[44]; 
  outr[45] += incr[45]; 
  outr[46] += incr[46]; 
  outr[47] += incr[47]; 

  outl[0] += -1.0*incr[0]; 
  outl[1] += incr[1]; 
  outl[2] += -1.0*incr[2]; 
  outl[3] += -1.0*incr[3]; 
  outl[4] += -1.0*incr[4]; 
  outl[5] += incr[5]; 
  outl[6] += incr[6]; 
  outl[7] += -1.0*incr[7]; 
  outl[8] += incr[8]; 
  outl[9] += -1.0*incr[9]; 
  outl[10] += -1.0*incr[10]; 
  outl[11] += -1.0*incr[11]; 
  outl[12] += -1.0*incr[12]; 
  outl[13] += -1.0*incr[13]; 
  outl[14] += -1.0*incr[14]; 
  outl[15] += incr[15]; 
  outl[16] += incr[16]; 
  outl[17] += incr[17]; 
  outl[18] += -1.0*incr[18]; 
  outl[19] += -1.0*incr[19]; 
  outl[20] += incr[20]; 
  outl[21] += -1.0*incr[21]; 
  outl[22] += -1.0*incr[22]; 
  outl[23] += incr[23]; 
  outl[24] += -1.0*incr[24]; 
  outl[25] += -1.0*incr[25]; 
  outl[26] += -1.0*incr[26]; 
  outl[27] += -1.0*incr[27]; 
  outl[28] += incr[28]; 
  outl[29] += -1.0*incr[29]; 
  outl[30] += -1.0*incr[30]; 
  outl[31] += incr[31]; 
  outl[32] += -1.0*incr[32]; 
  outl[33] += incr[33]; 
  outl[34] += incr[34]; 
  outl[35] += -1.0*incr[35]; 
  outl[36] += incr[36]; 
  outl[37] += -1.0*incr[37]; 
  outl[38] += -1.0*incr[38]; 
  outl[39] += incr[39]; 
  outl[40] += -1.0*incr[40]; 
  outl[41] += incr[41]; 
  outl[42] += incr[42]; 
  outl[43] += -1.0*incr[43]; 
  outl[44] += -1.0*incr[44]; 
  outl[45] += incr[45]; 
  outl[46] += incr[46]; 
  outl[47] += incr[47]; 
return std::abs(alpha0); 
} 
double GyrokineticSurf2x2vSer_Y_P2_Bvars_0(const double q_, const double m_, const double cflL, const double cflR, const double *w, const double *dxv, const double amax_in, const double *Bmag, const double *BmagInv, const double *Gradpar, const double *BdriftX, const double *BdriftY, const double *Phi, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w[NDIM]: Cell-center coordinates. dxv[NDIM]: Cell spacing. H/f: Input Hamiltonian/distribution function. out: Incremented output 
  double dfac_x = 2.0/dxv[0]; 
  double dfac_y = 2.0/dxv[1]; 
  double dfac_v = 2.0/dxv[2]; 
  double dfac_m = 2.0/dxv[3]; 
  double wx = w[0]; 
  double wy = w[1]; 
  double wv = w[2]; 
  double wm = w[3]; 
  double wv2 = wv*wv; 
  double dfac_v2 = dfac_v*dfac_v; 
  double q2 = q_*q_; 
  double incr[48]; 
  // surface-averaged phase velocity in this direction 
  double alpha0 = (0.04166666666666666*(dfac_v2*(6.0*BdriftY[0]*m_*wv2+BmagInv[0]*(3.0*(3.872983346207417*Phi[7]-3.0*Phi[3])+5.196152422706631*Phi[1])*dfac_x*q_)+2.0*BdriftY[0]*m_))/(dfac_v2*q_); 

  double alpha[20]; 
  alpha[0] = (0.2357022603955158*(dfac_v2*(6.0*BdriftY[0]*m_*wv2+BmagInv[0]*(11.61895003862225*Phi[7]-9.0*Phi[3]+5.196152422706631*Phi[1])*dfac_x*q_)+2.0*BdriftY[0]*m_))/(dfac_v2*q_); 
  alpha[1] = -0.7071067811865475*BmagInv[0]*(6.708203932499369*Phi[6]-3.872983346207417*Phi[4])*dfac_x; 
  alpha[2] = (1.632993161855453*BdriftY[0]*m_*wv)/(dfac_v*q_); 
  alpha[8] = (0.421637021355784*BdriftY[0]*m_)/(dfac_v2*q_); 
  double amax = 0.0; 
  bool upwind = false; 
  if(upwind) 
    amax = std::abs(alpha0); 
  else 
    amax = amax_in; 

  double Ghat[20]; 
  double favg[20]; 
  favg[0] = 0.7071067811865475*(2.23606797749979*(fr[12]+fl[12])+1.732050807568877*(fl[2]-1.0*fr[2])+fr[0]+fl[0]); 
  favg[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[20]+fl[20])+3.0*(fl[5]-1.0*fr[5]))+3.0*(fr[1]+fl[1])); 
  favg[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[22]+fl[22])+3.0*(fl[7]-1.0*fr[7]))+3.0*(fr[3]+fl[3])); 
  favg[3] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[26]+fl[26])+3.0*(fl[9]-1.0*fr[9]))+3.0*(fr[4]+fl[4])); 
  favg[4] = 0.7071067811865475*(2.23606797749979*(fr[33]+fl[33])+1.732050807568877*(fl[15]-1.0*fr[15])+fr[6]+fl[6]); 
  favg[5] = 0.7071067811865475*(2.23606797749979*(fr[36]+fl[36])+1.732050807568877*(fl[16]-1.0*fr[16])+fr[8]+fl[8]); 
  favg[6] = 0.7071067811865475*(2.23606797749979*(fr[38]+fl[38])+1.732050807568877*(fl[18]-1.0*fr[18])+fr[10]+fl[10]); 
  favg[7] = -0.1414213562373095*(8.660254037844387*fr[19]-1.0*(8.660254037844387*fl[19]+5.0*(fr[11]+fl[11]))); 
  favg[8] = -0.1414213562373095*(8.660254037844387*fr[24]-1.0*(8.660254037844387*fl[24]+5.0*(fr[13]+fl[13]))); 
  favg[9] = -0.1414213562373095*(8.660254037844387*fr[29]-1.0*(8.660254037844387*fl[29]+5.0*(fr[14]+fl[14]))); 
  favg[10] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[45]+fl[45])+3.0*(fl[31]-1.0*fr[31]))+3.0*(fr[17]+fl[17])); 
  favg[11] = -0.1414213562373095*(8.660254037844387*fr[32]-1.0*(8.660254037844387*fl[32]+5.0*(fr[21]+fl[21]))); 
  favg[12] = -0.1414213562373095*(8.660254037844387*fr[34]-1.0*(8.660254037844387*fl[34]+5.0*(fr[23]+fl[23]))); 
  favg[13] = -0.1414213562373095*(8.660254037844387*fr[35]-1.0*(8.660254037844387*fl[35]+5.0*(fr[25]+fl[25]))); 
  favg[14] = -0.1414213562373095*(8.660254037844387*fr[40]-1.0*(8.660254037844387*fl[40]+5.0*(fr[27]+fl[27]))); 
  favg[15] = -0.1414213562373095*(8.660254037844387*fr[41]-1.0*(8.660254037844387*fl[41]+5.0*(fr[28]+fl[28]))); 
  favg[16] = -0.1414213562373095*(8.660254037844387*fr[43]-1.0*(8.660254037844387*fl[43]+5.0*(fr[30]+fl[30]))); 
  favg[17] = -0.1414213562373095*(8.660254037844387*fr[44]-1.0*(8.660254037844387*fl[44]+5.0*(fr[37]+fl[37]))); 
  favg[18] = -0.1414213562373095*(8.660254037844387*fr[46]-1.0*(8.660254037844387*fl[46]+5.0*(fr[39]+fl[39]))); 
  favg[19] = -0.1414213562373095*(8.660254037844387*fr[47]-1.0*(8.660254037844387*fl[47]+5.0*(fr[42]+fl[42]))); 

  Ghat[0] = -0.125*((6.324555320336761*fr[12]-6.324555320336761*fl[12]-4.898979485566357*(fr[2]+fl[2])+2.828427124746191*fr[0]-2.828427124746191*fl[0])*amax-1.414213562373095*(alpha[8]*favg[8]+alpha[2]*favg[2]+alpha[1]*favg[1]+alpha[0]*favg[0])); 
  Ghat[1] = -0.008333333333333333*((94.8683298050514*fr[20]-94.8683298050514*fl[20]-73.48469228349535*(fr[5]+fl[5])+42.42640687119286*fr[1]-42.42640687119286*fl[1])*amax-21.21320343559643*alpha[8]*favg[12]-18.97366596101028*alpha[1]*favg[7]-21.21320343559643*(alpha[2]*favg[4]+alpha[0]*favg[1]+favg[0]*alpha[1])); 
  Ghat[2] = -0.008333333333333333*((94.8683298050514*fr[22]-94.8683298050514*fl[22]-73.48469228349535*(fr[7]+fl[7])+42.42640687119286*fr[3]-42.42640687119286*fl[3])*amax-18.97366596101028*(alpha[2]*favg[8]+favg[2]*alpha[8])-21.21320343559643*(alpha[1]*favg[4]+alpha[0]*favg[2]+favg[0]*alpha[2])); 
  Ghat[3] = -0.008333333333333333*((94.8683298050514*fr[26]-94.8683298050514*fl[26]-73.48469228349535*(fr[9]+fl[9])+42.42640687119286*fr[4]-42.42640687119286*fl[4])*amax-21.21320343559643*alpha[8]*favg[14]-21.21320343559643*(alpha[2]*favg[6]+alpha[1]*favg[5]+alpha[0]*favg[3])); 
  Ghat[4] = -0.008333333333333333*((94.86832980505142*fr[33]-94.86832980505142*fl[33]-73.48469228349535*(fr[15]+fl[15])+42.42640687119286*fr[6]-42.42640687119286*fl[6])*amax-18.97366596101028*(alpha[2]*favg[12]+alpha[1]*favg[11]+favg[4]*alpha[8])-21.21320343559643*(alpha[0]*favg[4]+alpha[1]*favg[2]+favg[1]*alpha[2])); 
  Ghat[5] = -0.008333333333333333*((94.86832980505142*fr[36]-94.86832980505142*fl[36]-73.48469228349535*(fr[16]+fl[16])+42.42640687119286*fr[8]-42.42640687119286*fl[8])*amax-21.21320343559643*alpha[8]*favg[18]-18.97366596101028*alpha[1]*favg[13]-21.21320343559643*(alpha[2]*favg[10]+alpha[0]*favg[5]+alpha[1]*favg[3])); 
  Ghat[6] = -0.008333333333333333*((94.86832980505142*fr[38]-94.86832980505142*fl[38]-73.48469228349535*(fr[18]+fl[18])+42.42640687119286*fr[10]-42.42640687119286*fl[10])*amax-18.97366596101028*alpha[2]*favg[14]-21.21320343559643*alpha[1]*favg[10]-18.97366596101028*favg[6]*alpha[8]-21.21320343559643*(alpha[0]*favg[6]+alpha[2]*favg[3])); 
  Ghat[7] = 0.008333333333333333*((73.48469228349536*(fr[19]+fl[19])-42.42640687119286*fr[11]+42.42640687119286*fl[11])*amax+21.21320343559643*alpha[2]*favg[11]+21.21320343559643*alpha[0]*favg[7]+18.97366596101028*alpha[1]*favg[1]); 
  Ghat[8] = 0.001190476190476191*((514.3928459844675*(fr[24]+fl[24])-296.98484809835*fr[13]+296.98484809835*fl[13])*amax+148.492424049175*alpha[1]*favg[12]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[8]+148.492424049175*favg[0]*alpha[8]+132.815661727072*alpha[2]*favg[2]); 
  Ghat[9] = 0.01863389981249824*((32.86335345030997*(fr[29]+fl[29])-18.97366596101028*fr[14]+18.97366596101028*fl[14])*amax+9.48683298050514*(alpha[2]*favg[16]+alpha[1]*favg[15]+alpha[0]*favg[9])); 
  Ghat[10] = -0.008333333333333333*((94.8683298050514*fr[45]-94.8683298050514*fl[45]-73.48469228349535*(fr[31]+fl[31])+42.42640687119286*fr[17]-42.42640687119286*fl[17])*amax-18.97366596101028*(alpha[2]*favg[18]+alpha[1]*favg[17])+((-18.97366596101028*alpha[8])-21.21320343559643*alpha[0])*favg[10]-21.21320343559643*(alpha[1]*favg[6]+alpha[2]*favg[5])); 
  Ghat[11] = 0.008333333333333333*((73.48469228349536*(fr[32]+fl[32])-42.42640687119286*fr[21]+42.42640687119286*fl[21])*amax+(18.97366596101028*alpha[8]+21.21320343559643*alpha[0])*favg[11]+21.21320343559643*alpha[2]*favg[7]+18.97366596101028*alpha[1]*favg[4]); 
  Ghat[12] = 0.001190476190476191*((514.3928459844675*(fr[34]+fl[34])-296.98484809835*fr[23]+296.98484809835*fl[23])*amax+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[12]+148.492424049175*(alpha[1]*favg[8]+favg[1]*alpha[8])+132.815661727072*alpha[2]*favg[4]); 
  Ghat[13] = 0.03227486121839514*((18.97366596101028*(fr[35]+fl[35])-10.95445115010333*fr[25]+10.95445115010333*fl[25])*amax+5.477225575051662*(alpha[2]*favg[17]+alpha[0]*favg[13])+4.898979485566357*alpha[1]*favg[5]); 
  Ghat[14] = 0.004610694459770734*((132.815661727072*(fr[40]+fl[40])-76.68115805072327*fr[27]+76.68115805072327*fl[27])*amax+38.34057902536163*alpha[1]*favg[18]+(24.49489742783179*alpha[8]+38.34057902536163*alpha[0])*favg[14]+38.34057902536163*favg[3]*alpha[8]+34.2928563989645*alpha[2]*favg[6]); 
  Ghat[15] = 0.03227486121839514*((18.97366596101028*(fr[41]+fl[41])-10.95445115010333*fr[28]+10.95445115010333*fl[28])*amax+5.477225575051662*(alpha[2]*favg[19]+alpha[0]*favg[15]+alpha[1]*favg[9])); 
  Ghat[16] = 0.006454972243679028*((94.86832980505142*(fr[43]+fl[43])-54.77225575051663*fr[30]+54.77225575051663*fl[30])*amax+27.38612787525831*alpha[1]*favg[19]+(24.49489742783179*alpha[8]+27.38612787525831*alpha[0])*favg[16]+27.38612787525831*alpha[2]*favg[9]); 
  Ghat[17] = 0.008333333333333333*((73.48469228349536*(fr[44]+fl[44])-42.42640687119286*fr[37]+42.42640687119286*fl[37])*amax+(18.97366596101028*alpha[8]+21.21320343559643*alpha[0])*favg[17]+21.21320343559643*alpha[2]*favg[13]+18.97366596101028*alpha[1]*favg[10]); 
  Ghat[18] = 0.001190476190476191*((514.3928459844675*(fr[46]+fl[46])-296.98484809835*fr[39]+296.98484809835*fl[39])*amax+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[18]+148.492424049175*alpha[1]*favg[14]+132.815661727072*alpha[2]*favg[10]+148.492424049175*favg[5]*alpha[8]); 
  Ghat[19] = 0.00116461873828114*((525.8136552049599*(fr[47]+fl[47])-303.5786553761646*fr[42]+303.5786553761646*fl[42])*amax+(135.7645019878172*alpha[8]+151.7893276880823*alpha[0])*favg[19]+151.7893276880823*(alpha[1]*favg[16]+alpha[2]*favg[15])+(32.86335345030997*alpha[8]+36.74234614174767*alpha[0])*favg[10]+36.74234614174767*(alpha[1]*favg[6]+alpha[2]*favg[5])); 
  incr[0] = 0.7071067811865475*Ghat[0]*dfac_y; 
  incr[1] = 0.7071067811865475*Ghat[1]*dfac_y; 
  incr[2] = -1.224744871391589*Ghat[0]*dfac_y; 
  incr[3] = 0.7071067811865475*Ghat[2]*dfac_y; 
  incr[4] = 0.7071067811865475*Ghat[3]*dfac_y; 
  incr[5] = -1.224744871391589*Ghat[1]*dfac_y; 
  incr[6] = 0.7071067811865475*Ghat[4]*dfac_y; 
  incr[7] = -1.224744871391589*Ghat[2]*dfac_y; 
  incr[8] = 0.7071067811865475*Ghat[5]*dfac_y; 
  incr[9] = -1.224744871391589*Ghat[3]*dfac_y; 
  incr[10] = 0.7071067811865475*Ghat[6]*dfac_y; 
  incr[11] = 0.7071067811865475*Ghat[7]*dfac_y; 
  incr[12] = 1.58113883008419*Ghat[0]*dfac_y; 
  incr[13] = 0.7071067811865475*Ghat[8]*dfac_y; 
  incr[14] = 0.7071067811865475*Ghat[9]*dfac_y; 
  incr[15] = -1.224744871391589*Ghat[4]*dfac_y; 
  incr[16] = -1.224744871391589*Ghat[5]*dfac_y; 
  incr[17] = 0.7071067811865475*Ghat[10]*dfac_y; 
  incr[18] = -1.224744871391589*Ghat[6]*dfac_y; 
  incr[19] = -1.224744871391589*Ghat[7]*dfac_y; 
  incr[20] = 1.58113883008419*Ghat[1]*dfac_y; 
  incr[21] = 0.7071067811865475*Ghat[11]*dfac_y; 
  incr[22] = 1.58113883008419*Ghat[2]*dfac_y; 
  incr[23] = 0.7071067811865475*Ghat[12]*dfac_y; 
  incr[24] = -1.224744871391589*Ghat[8]*dfac_y; 
  incr[25] = 0.7071067811865475*Ghat[13]*dfac_y; 
  incr[26] = 1.58113883008419*Ghat[3]*dfac_y; 
  incr[27] = 0.7071067811865475*Ghat[14]*dfac_y; 
  incr[28] = 0.7071067811865475*Ghat[15]*dfac_y; 
  incr[29] = -1.224744871391589*Ghat[9]*dfac_y; 
  incr[30] = 0.7071067811865475*Ghat[16]*dfac_y; 
  incr[31] = -1.224744871391589*Ghat[10]*dfac_y; 
  incr[32] = -1.224744871391589*Ghat[11]*dfac_y; 
  incr[33] = 1.58113883008419*Ghat[4]*dfac_y; 
  incr[34] = -1.224744871391589*Ghat[12]*dfac_y; 
  incr[35] = -1.224744871391589*Ghat[13]*dfac_y; 
  incr[36] = 1.58113883008419*Ghat[5]*dfac_y; 
  incr[37] = 0.7071067811865475*Ghat[17]*dfac_y; 
  incr[38] = 1.58113883008419*Ghat[6]*dfac_y; 
  incr[39] = 0.7071067811865475*Ghat[18]*dfac_y; 
  incr[40] = -1.224744871391589*Ghat[14]*dfac_y; 
  incr[41] = -1.224744871391589*Ghat[15]*dfac_y; 
  incr[42] = 0.7071067811865475*Ghat[19]*dfac_y; 
  incr[43] = -1.224744871391589*Ghat[16]*dfac_y; 
  incr[44] = -1.224744871391589*Ghat[17]*dfac_y; 
  incr[45] = 1.58113883008419*Ghat[10]*dfac_y; 
  incr[46] = -1.224744871391589*Ghat[18]*dfac_y; 
  incr[47] = -1.224744871391589*Ghat[19]*dfac_y; 

  outr[0] += incr[0]; 
  outr[1] += incr[1]; 
  outr[2] += incr[2]; 
  outr[3] += incr[3]; 
  outr[4] += incr[4]; 
  outr[5] += incr[5]; 
  outr[6] += incr[6]; 
  outr[7] += incr[7]; 
  outr[8] += incr[8]; 
  outr[9] += incr[9]; 
  outr[10] += incr[10]; 
  outr[11] += incr[11]; 
  outr[12] += incr[12]; 
  outr[13] += incr[13]; 
  outr[14] += incr[14]; 
  outr[15] += incr[15]; 
  outr[16] += incr[16]; 
  outr[17] += incr[17]; 
  outr[18] += incr[18]; 
  outr[19] += incr[19]; 
  outr[20] += incr[20]; 
  outr[21] += incr[21]; 
  outr[22] += incr[22]; 
  outr[23] += incr[23]; 
  outr[24] += incr[24]; 
  outr[25] += incr[25]; 
  outr[26] += incr[26]; 
  outr[27] += incr[27]; 
  outr[28] += incr[28]; 
  outr[29] += incr[29]; 
  outr[30] += incr[30]; 
  outr[31] += incr[31]; 
  outr[32] += incr[32]; 
  outr[33] += incr[33]; 
  outr[34] += incr[34]; 
  outr[35] += incr[35]; 
  outr[36] += incr[36]; 
  outr[37] += incr[37]; 
  outr[38] += incr[38]; 
  outr[39] += incr[39]; 
  outr[40] += incr[40]; 
  outr[41] += incr[41]; 
  outr[42] += incr[42]; 
  outr[43] += incr[43]; 
  outr[44] += incr[44]; 
  outr[45] += incr[45]; 
  outr[46] += incr[46]; 
  outr[47] += incr[47]; 

  outl[0] += -1.0*incr[0]; 
  outl[1] += -1.0*incr[1]; 
  outl[2] += incr[2]; 
  outl[3] += -1.0*incr[3]; 
  outl[4] += -1.0*incr[4]; 
  outl[5] += incr[5]; 
  outl[6] += -1.0*incr[6]; 
  outl[7] += incr[7]; 
  outl[8] += -1.0*incr[8]; 
  outl[9] += incr[9]; 
  outl[10] += -1.0*incr[10]; 
  outl[11] += -1.0*incr[11]; 
  outl[12] += -1.0*incr[12]; 
  outl[13] += -1.0*incr[13]; 
  outl[14] += -1.0*incr[14]; 
  outl[15] += incr[15]; 
  outl[16] += incr[16]; 
  outl[17] += -1.0*incr[17]; 
  outl[18] += incr[18]; 
  outl[19] += incr[19]; 
  outl[20] += -1.0*incr[20]; 
  outl[21] += -1.0*incr[21]; 
  outl[22] += -1.0*incr[22]; 
  outl[23] += -1.0*incr[23]; 
  outl[24] += incr[24]; 
  outl[25] += -1.0*incr[25]; 
  outl[26] += -1.0*incr[26]; 
  outl[27] += -1.0*incr[27]; 
  outl[28] += -1.0*incr[28]; 
  outl[29] += incr[29]; 
  outl[30] += -1.0*incr[30]; 
  outl[31] += incr[31]; 
  outl[32] += incr[32]; 
  outl[33] += -1.0*incr[33]; 
  outl[34] += incr[34]; 
  outl[35] += incr[35]; 
  outl[36] += -1.0*incr[36]; 
  outl[37] += -1.0*incr[37]; 
  outl[38] += -1.0*incr[38]; 
  outl[39] += -1.0*incr[39]; 
  outl[40] += incr[40]; 
  outl[41] += incr[41]; 
  outl[42] += -1.0*incr[42]; 
  outl[43] += incr[43]; 
  outl[44] += incr[44]; 
  outl[45] += -1.0*incr[45]; 
  outl[46] += incr[46]; 
  outl[47] += incr[47]; 
return std::abs(alpha0); 
} 
double GyrokineticSurf2x2vSer_Vpar_P2_Bvars_0(const double q_, const double m_, const double cflL, const double cflR, const double *w, const double *dxv, const double amax_in, const double *Bmag, const double *BmagInv, const double *Gradpar, const double *BdriftX, const double *BdriftY, const double *Phi, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w[NDIM]: Cell-center coordinates. dxv[NDIM]: Cell spacing. H/f: Input Hamiltonian/distribution function. out: Incremented output 
  double dfac_x = 2.0/dxv[0]; 
  double dfac_y = 2.0/dxv[1]; 
  double dfac_v = 2.0/dxv[2]; 
  double dfac_m = 2.0/dxv[3]; 
  double wx = w[0]; 
  double wy = w[1]; 
  double wv = w[2]; 
  double wm = w[3]; 
  double wv2 = wv*wv; 
  double dfac_v2 = dfac_v*dfac_v; 
  double q2 = q_*q_; 
  double incr[48]; 
  // surface-averaged phase velocity in this direction 
  double alpha0 = -(0.2165063509461096*(dfac_v*(BdriftY[0]*Phi[2]*dfac_y+BdriftX[0]*Phi[1]*dfac_x)*wv-1.0*(BdriftY[0]*Phi[2]*dfac_y+BdriftX[0]*Phi[1]*dfac_x)))/dfac_v; 

  double alpha[20]; 
  alpha[0] = -(0.7071067811865475*(BdriftY[0]*Phi[2]*dfac_y+BdriftX[0]*Phi[1]*dfac_x)*(1.732050807568877*dfac_v*wv-1.732050807568877))/dfac_v; 
  alpha[1] = -(0.7071067811865475*(dfac_v*(1.732050807568877*BdriftY[0]*Phi[3]*dfac_y+3.872983346207417*BdriftX[0]*Phi[4]*dfac_x)*wv-1.732050807568877*BdriftY[0]*Phi[3]*dfac_y-3.872983346207417*BdriftX[0]*Phi[4]*dfac_x))/dfac_v; 
  alpha[2] = -(0.7071067811865475*(dfac_v*(3.872983346207417*BdriftY[0]*Phi[5]*dfac_y+1.732050807568877*BdriftX[0]*Phi[3]*dfac_x)*wv-3.872983346207417*BdriftY[0]*Phi[5]*dfac_y-1.732050807568877*BdriftX[0]*Phi[3]*dfac_x))/dfac_v; 
  alpha[4] = -(0.7071067811865475*(BdriftY[0]*Phi[7]*dfac_y+BdriftX[0]*Phi[6]*dfac_x)*(3.872983346207417*dfac_v*wv-3.872983346207417))/dfac_v; 
  alpha[7] = -(0.3162277660168379*BdriftY[0]*Phi[6]*dfac_y*(3.872983346207417*dfac_v*wv-3.872983346207417))/dfac_v; 
  alpha[8] = -(0.1414213562373095*BdriftX[0]*Phi[7]*dfac_x*(8.660254037844387*dfac_v*wv-8.660254037844387))/dfac_v; 
  double amax = 0.0; 
  bool upwind = false; 
  if(upwind) 
    amax = std::abs(alpha0); 
  else 
    amax = amax_in; 

  double Ghat[20]; 
  double favg[20]; 
  favg[0] = 0.7071067811865475*(2.23606797749979*(fr[13]+fl[13])+1.732050807568877*(fl[3]-1.0*fr[3])+fr[0]+fl[0]); 
  favg[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[23]+fl[23])+3.0*(fl[6]-1.0*fr[6]))+3.0*(fr[1]+fl[1])); 
  favg[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[24]+fl[24])+3.0*(fl[7]-1.0*fr[7]))+3.0*(fr[2]+fl[2])); 
  favg[3] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[27]+fl[27])+3.0*(fl[10]-1.0*fr[10]))+3.0*(fr[4]+fl[4])); 
  favg[4] = 0.7071067811865475*(2.23606797749979*(fr[34]+fl[34])+1.732050807568877*(fl[15]-1.0*fr[15])+fr[5]+fl[5]); 
  favg[5] = 0.7071067811865475*(2.23606797749979*(fr[39]+fl[39])+1.732050807568877*(fl[17]-1.0*fr[17])+fr[8]+fl[8]); 
  favg[6] = 0.7071067811865475*(2.23606797749979*(fr[40]+fl[40])+1.732050807568877*(fl[18]-1.0*fr[18])+fr[9]+fl[9]); 
  favg[7] = -0.1414213562373095*(8.660254037844387*fr[21]-1.0*(8.660254037844387*fl[21]+5.0*(fr[11]+fl[11]))); 
  favg[8] = -0.1414213562373095*(8.660254037844387*fr[22]-1.0*(8.660254037844387*fl[22]+5.0*(fr[12]+fl[12]))); 
  favg[9] = -0.1414213562373095*(8.660254037844387*fr[30]-1.0*(8.660254037844387*fl[30]+5.0*(fr[14]+fl[14]))); 
  favg[10] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[46]+fl[46])+3.0*(fl[31]-1.0*fr[31]))+3.0*(fr[16]+fl[16])); 
  favg[11] = -0.1414213562373095*(8.660254037844387*fr[32]-1.0*(8.660254037844387*fl[32]+5.0*(fr[19]+fl[19]))); 
  favg[12] = -0.1414213562373095*(8.660254037844387*fr[33]-1.0*(8.660254037844387*fl[33]+5.0*(fr[20]+fl[20]))); 
  favg[13] = -0.1414213562373095*(8.660254037844387*fr[37]-1.0*(8.660254037844387*fl[37]+5.0*(fr[25]+fl[25]))); 
  favg[14] = -0.1414213562373095*(8.660254037844387*fr[38]-1.0*(8.660254037844387*fl[38]+5.0*(fr[26]+fl[26]))); 
  favg[15] = -0.1414213562373095*(8.660254037844387*fr[42]-1.0*(8.660254037844387*fl[42]+5.0*(fr[28]+fl[28]))); 
  favg[16] = -0.1414213562373095*(8.660254037844387*fr[43]-1.0*(8.660254037844387*fl[43]+5.0*(fr[29]+fl[29]))); 
  favg[17] = -0.1414213562373095*(8.660254037844387*fr[44]-1.0*(8.660254037844387*fl[44]+5.0*(fr[35]+fl[35]))); 
  favg[18] = -0.1414213562373095*(8.660254037844387*fr[45]-1.0*(8.660254037844387*fl[45]+5.0*(fr[36]+fl[36]))); 
  favg[19] = -0.1414213562373095*(8.660254037844387*fr[47]-1.0*(8.660254037844387*fl[47]+5.0*(fr[41]+fl[41]))); 

  Ghat[0] = -0.125*((6.324555320336761*fr[13]-6.324555320336761*fl[13]-4.898979485566357*(fr[3]+fl[3])+2.828427124746191*fr[0]-2.828427124746191*fl[0])*amax-1.414213562373095*(alpha[8]*favg[8]+alpha[7]*favg[7]+alpha[4]*favg[4]+alpha[2]*favg[2]+alpha[1]*favg[1]+alpha[0]*favg[0])); 
  Ghat[1] = -0.008333333333333333*((94.8683298050514*fr[23]-94.8683298050514*fl[23]-73.48469228349535*(fr[6]+fl[6])+42.42640687119286*fr[1]-42.42640687119286*fl[1])*amax-21.21320343559643*alpha[8]*favg[12]-18.97366596101028*(alpha[4]*favg[11]+alpha[1]*favg[7]+favg[1]*alpha[7])-21.21320343559643*(alpha[2]*favg[4]+favg[2]*alpha[4]+alpha[0]*favg[1]+favg[0]*alpha[1])); 
  Ghat[2] = -0.008333333333333333*((94.8683298050514*fr[24]-94.8683298050514*fl[24]-73.48469228349535*(fr[7]+fl[7])+42.42640687119286*fr[2]-42.42640687119286*fl[2])*amax-18.97366596101028*alpha[4]*favg[12]-21.21320343559643*alpha[7]*favg[11]-18.97366596101028*(alpha[2]*favg[8]+favg[2]*alpha[8])-21.21320343559643*(alpha[1]*favg[4]+favg[1]*alpha[4]+alpha[0]*favg[2]+favg[0]*alpha[2])); 
  Ghat[3] = -0.008333333333333333*((94.8683298050514*fr[27]-94.8683298050514*fl[27]-73.48469228349535*(fr[10]+fl[10])+42.42640687119286*fr[4]-42.42640687119286*fl[4])*amax-21.21320343559643*(alpha[8]*favg[14]+alpha[7]*favg[13])-21.21320343559643*(alpha[4]*favg[10]+alpha[2]*favg[6]+alpha[1]*favg[5]+alpha[0]*favg[3])); 
  Ghat[4] = -0.008333333333333333*((94.86832980505142*fr[34]-94.86832980505142*fl[34]-73.48469228349535*(fr[15]+fl[15])+42.42640687119286*fr[5]-42.42640687119286*fl[5])*amax-18.97366596101028*(alpha[2]*favg[12]+alpha[1]*favg[11]+alpha[4]*favg[8]+favg[4]*alpha[8]+alpha[4]*favg[7]+favg[4]*alpha[7])-21.21320343559643*(alpha[0]*favg[4]+favg[0]*alpha[4]+alpha[1]*favg[2]+favg[1]*alpha[2])); 
  Ghat[5] = -0.008333333333333333*((94.86832980505142*fr[39]-94.86832980505142*fl[39]-73.48469228349535*(fr[17]+fl[17])+42.42640687119286*fr[8]-42.42640687119286*fl[8])*amax-21.21320343559643*alpha[8]*favg[18]-18.97366596101028*(alpha[4]*favg[17]+alpha[1]*favg[13])-21.21320343559643*alpha[2]*favg[10]-18.97366596101028*favg[5]*alpha[7]-21.21320343559643*(alpha[4]*favg[6]+alpha[0]*favg[5]+alpha[1]*favg[3])); 
  Ghat[6] = -0.008333333333333333*((94.86832980505142*fr[40]-94.86832980505142*fl[40]-73.48469228349535*(fr[18]+fl[18])+42.42640687119286*fr[9]-42.42640687119286*fl[9])*amax-18.97366596101028*alpha[4]*favg[18]-21.21320343559643*alpha[7]*favg[17]-18.97366596101028*alpha[2]*favg[14]-21.21320343559643*alpha[1]*favg[10]-18.97366596101028*favg[6]*alpha[8]-21.21320343559643*(alpha[0]*favg[6]+alpha[4]*favg[5]+alpha[2]*favg[3])); 
  Ghat[7] = 0.001190476190476191*((514.3928459844675*(fr[21]+fl[21])-296.98484809835*fr[11]+296.98484809835*fl[11])*amax+148.492424049175*alpha[2]*favg[11]+(94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[7]+148.492424049175*favg[0]*alpha[7]+132.815661727072*(alpha[4]*favg[4]+alpha[1]*favg[1])); 
  Ghat[8] = 0.001190476190476191*((514.3928459844675*(fr[22]+fl[22])-296.98484809835*fr[12]+296.98484809835*fl[12])*amax+148.492424049175*alpha[1]*favg[12]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[8]+148.492424049175*favg[0]*alpha[8]+132.815661727072*(alpha[4]*favg[4]+alpha[2]*favg[2])); 
  Ghat[9] = 0.01863389981249824*((32.86335345030997*(fr[30]+fl[30])-18.97366596101028*fr[14]+18.97366596101028*fl[14])*amax+9.48683298050514*(alpha[4]*favg[19]+alpha[2]*favg[16]+alpha[1]*favg[15]+alpha[0]*favg[9])); 
  Ghat[10] = -0.008333333333333333*((94.8683298050514*fr[46]-94.8683298050514*fl[46]-73.48469228349535*(fr[31]+fl[31])+42.42640687119286*fr[16]-42.42640687119286*fl[16])*amax-18.97366596101028*(alpha[2]*favg[18]+alpha[1]*favg[17]+alpha[4]*(favg[14]+favg[13]))+((-18.97366596101028*(alpha[8]+alpha[7]))-21.21320343559643*alpha[0])*favg[10]-21.21320343559643*(alpha[1]*favg[6]+alpha[2]*favg[5]+favg[3]*alpha[4])); 
  Ghat[11] = 0.001190476190476191*((514.3928459844675*(fr[32]+fl[32])-296.98484809835*fr[19]+296.98484809835*fl[19])*amax+118.79393923934*alpha[4]*favg[12]+(132.815661727072*alpha[8]+94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[11]+148.492424049175*(alpha[2]*favg[7]+favg[2]*alpha[7])+132.815661727072*(alpha[1]*favg[4]+favg[1]*alpha[4])); 
  Ghat[12] = 0.001190476190476191*((514.3928459844675*(fr[33]+fl[33])-296.98484809835*fr[20]+296.98484809835*fl[20])*amax+(94.86832980505142*alpha[8]+132.815661727072*alpha[7]+148.492424049175*alpha[0])*favg[12]+118.79393923934*alpha[4]*favg[11]+148.492424049175*(alpha[1]*favg[8]+favg[1]*alpha[8])+132.815661727072*(alpha[2]*favg[4]+favg[2]*alpha[4])); 
  Ghat[13] = 0.001190476190476191*((514.3928459844675*(fr[37]+fl[37])-296.98484809835*fr[25]+296.98484809835*fl[25])*amax+148.492424049175*alpha[2]*favg[17]+(94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[13]+132.815661727072*alpha[4]*favg[10]+148.492424049175*favg[3]*alpha[7]+132.815661727072*alpha[1]*favg[5]); 
  Ghat[14] = 0.001190476190476191*((514.3928459844675*(fr[38]+fl[38])-296.98484809835*fr[26]+296.98484809835*fl[26])*amax+148.492424049175*alpha[1]*favg[18]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[14]+132.815661727072*alpha[4]*favg[10]+148.492424049175*favg[3]*alpha[8]+132.815661727072*alpha[2]*favg[6]); 
  Ghat[15] = 0.006454972243679028*((94.86832980505142*(fr[42]+fl[42])-54.77225575051663*fr[28]+54.77225575051663*fl[28])*amax+27.38612787525831*alpha[2]*favg[19]+27.38612787525831*alpha[4]*favg[16]+(24.49489742783179*alpha[7]+27.38612787525831*alpha[0])*favg[15]+27.38612787525831*alpha[1]*favg[9]); 
  Ghat[16] = 0.006454972243679028*((94.86832980505142*(fr[43]+fl[43])-54.77225575051663*fr[29]+54.77225575051663*fl[29])*amax+27.38612787525831*alpha[1]*favg[19]+(24.49489742783179*alpha[8]+27.38612787525831*alpha[0])*favg[16]+27.38612787525831*alpha[4]*favg[15]+27.38612787525831*alpha[2]*favg[9]); 
  Ghat[17] = 0.001190476190476191*((514.3928459844675*(fr[44]+fl[44])-296.98484809835*fr[35]+296.98484809835*fl[35])*amax+118.79393923934*alpha[4]*favg[18]+(132.815661727072*alpha[8]+94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[17]+148.492424049175*alpha[2]*favg[13]+132.815661727072*alpha[1]*favg[10]+148.492424049175*favg[6]*alpha[7]+132.815661727072*alpha[4]*favg[5]); 
  Ghat[18] = 0.001190476190476191*((514.3928459844675*(fr[45]+fl[45])-296.98484809835*fr[36]+296.98484809835*fl[36])*amax+(94.86832980505142*alpha[8]+132.815661727072*alpha[7]+148.492424049175*alpha[0])*favg[18]+118.79393923934*alpha[4]*favg[17]+148.492424049175*alpha[1]*favg[14]+132.815661727072*alpha[2]*favg[10]+148.492424049175*favg[5]*alpha[8]+132.815661727072*alpha[4]*favg[6]); 
  Ghat[19] = 0.01863389981249824*((32.86335345030997*(fr[47]+fl[47])-18.97366596101028*fr[41]+18.97366596101028*fl[41])*amax+(8.485281374238571*(alpha[8]+alpha[7])+9.48683298050514*alpha[0])*favg[19]+9.48683298050514*(alpha[1]*favg[16]+alpha[2]*favg[15]+alpha[4]*favg[9])); 
  incr[0] = 0.7071067811865475*Ghat[0]*dfac_v; 
  incr[1] = 0.7071067811865475*Ghat[1]*dfac_v; 
  incr[2] = 0.7071067811865475*Ghat[2]*dfac_v; 
  incr[3] = -1.224744871391589*Ghat[0]*dfac_v; 
  incr[4] = 0.7071067811865475*Ghat[3]*dfac_v; 
  incr[5] = 0.7071067811865475*Ghat[4]*dfac_v; 
  incr[6] = -1.224744871391589*Ghat[1]*dfac_v; 
  incr[7] = -1.224744871391589*Ghat[2]*dfac_v; 
  incr[8] = 0.7071067811865475*Ghat[5]*dfac_v; 
  incr[9] = 0.7071067811865475*Ghat[6]*dfac_v; 
  incr[10] = -1.224744871391589*Ghat[3]*dfac_v; 
  incr[11] = 0.7071067811865475*Ghat[7]*dfac_v; 
  incr[12] = 0.7071067811865475*Ghat[8]*dfac_v; 
  incr[13] = 1.58113883008419*Ghat[0]*dfac_v; 
  incr[14] = 0.7071067811865475*Ghat[9]*dfac_v; 
  incr[15] = -1.224744871391589*Ghat[4]*dfac_v; 
  incr[16] = 0.7071067811865475*Ghat[10]*dfac_v; 
  incr[17] = -1.224744871391589*Ghat[5]*dfac_v; 
  incr[18] = -1.224744871391589*Ghat[6]*dfac_v; 
  incr[19] = 0.7071067811865475*Ghat[11]*dfac_v; 
  incr[20] = 0.7071067811865475*Ghat[12]*dfac_v; 
  incr[21] = -1.224744871391589*Ghat[7]*dfac_v; 
  incr[22] = -1.224744871391589*Ghat[8]*dfac_v; 
  incr[23] = 1.58113883008419*Ghat[1]*dfac_v; 
  incr[24] = 1.58113883008419*Ghat[2]*dfac_v; 
  incr[25] = 0.7071067811865475*Ghat[13]*dfac_v; 
  incr[26] = 0.7071067811865475*Ghat[14]*dfac_v; 
  incr[27] = 1.58113883008419*Ghat[3]*dfac_v; 
  incr[28] = 0.7071067811865475*Ghat[15]*dfac_v; 
  incr[29] = 0.7071067811865475*Ghat[16]*dfac_v; 
  incr[30] = -1.224744871391589*Ghat[9]*dfac_v; 
  incr[31] = -1.224744871391589*Ghat[10]*dfac_v; 
  incr[32] = -1.224744871391589*Ghat[11]*dfac_v; 
  incr[33] = -1.224744871391589*Ghat[12]*dfac_v; 
  incr[34] = 1.58113883008419*Ghat[4]*dfac_v; 
  incr[35] = 0.7071067811865475*Ghat[17]*dfac_v; 
  incr[36] = 0.7071067811865475*Ghat[18]*dfac_v; 
  incr[37] = -1.224744871391589*Ghat[13]*dfac_v; 
  incr[38] = -1.224744871391589*Ghat[14]*dfac_v; 
  incr[39] = 1.58113883008419*Ghat[5]*dfac_v; 
  incr[40] = 1.58113883008419*Ghat[6]*dfac_v; 
  incr[41] = 0.7071067811865475*Ghat[19]*dfac_v; 
  incr[42] = -1.224744871391589*Ghat[15]*dfac_v; 
  incr[43] = -1.224744871391589*Ghat[16]*dfac_v; 
  incr[44] = -1.224744871391589*Ghat[17]*dfac_v; 
  incr[45] = -1.224744871391589*Ghat[18]*dfac_v; 
  incr[46] = 1.58113883008419*Ghat[10]*dfac_v; 
  incr[47] = -1.224744871391589*Ghat[19]*dfac_v; 

  outr[0] += incr[0]; 
  outr[1] += incr[1]; 
  outr[2] += incr[2]; 
  outr[3] += incr[3]; 
  outr[4] += incr[4]; 
  outr[5] += incr[5]; 
  outr[6] += incr[6]; 
  outr[7] += incr[7]; 
  outr[8] += incr[8]; 
  outr[9] += incr[9]; 
  outr[10] += incr[10]; 
  outr[11] += incr[11]; 
  outr[12] += incr[12]; 
  outr[13] += incr[13]; 
  outr[14] += incr[14]; 
  outr[15] += incr[15]; 
  outr[16] += incr[16]; 
  outr[17] += incr[17]; 
  outr[18] += incr[18]; 
  outr[19] += incr[19]; 
  outr[20] += incr[20]; 
  outr[21] += incr[21]; 
  outr[22] += incr[22]; 
  outr[23] += incr[23]; 
  outr[24] += incr[24]; 
  outr[25] += incr[25]; 
  outr[26] += incr[26]; 
  outr[27] += incr[27]; 
  outr[28] += incr[28]; 
  outr[29] += incr[29]; 
  outr[30] += incr[30]; 
  outr[31] += incr[31]; 
  outr[32] += incr[32]; 
  outr[33] += incr[33]; 
  outr[34] += incr[34]; 
  outr[35] += incr[35]; 
  outr[36] += incr[36]; 
  outr[37] += incr[37]; 
  outr[38] += incr[38]; 
  outr[39] += incr[39]; 
  outr[40] += incr[40]; 
  outr[41] += incr[41]; 
  outr[42] += incr[42]; 
  outr[43] += incr[43]; 
  outr[44] += incr[44]; 
  outr[45] += incr[45]; 
  outr[46] += incr[46]; 
  outr[47] += incr[47]; 

  outl[0] += -1.0*incr[0]; 
  outl[1] += -1.0*incr[1]; 
  outl[2] += -1.0*incr[2]; 
  outl[3] += incr[3]; 
  outl[4] += -1.0*incr[4]; 
  outl[5] += -1.0*incr[5]; 
  outl[6] += incr[6]; 
  outl[7] += incr[7]; 
  outl[8] += -1.0*incr[8]; 
  outl[9] += -1.0*incr[9]; 
  outl[10] += incr[10]; 
  outl[11] += -1.0*incr[11]; 
  outl[12] += -1.0*incr[12]; 
  outl[13] += -1.0*incr[13]; 
  outl[14] += -1.0*incr[14]; 
  outl[15] += incr[15]; 
  outl[16] += -1.0*incr[16]; 
  outl[17] += incr[17]; 
  outl[18] += incr[18]; 
  outl[19] += -1.0*incr[19]; 
  outl[20] += -1.0*incr[20]; 
  outl[21] += incr[21]; 
  outl[22] += incr[22]; 
  outl[23] += -1.0*incr[23]; 
  outl[24] += -1.0*incr[24]; 
  outl[25] += -1.0*incr[25]; 
  outl[26] += -1.0*incr[26]; 
  outl[27] += -1.0*incr[27]; 
  outl[28] += -1.0*incr[28]; 
  outl[29] += -1.0*incr[29]; 
  outl[30] += incr[30]; 
  outl[31] += incr[31]; 
  outl[32] += incr[32]; 
  outl[33] += incr[33]; 
  outl[34] += -1.0*incr[34]; 
  outl[35] += -1.0*incr[35]; 
  outl[36] += -1.0*incr[36]; 
  outl[37] += incr[37]; 
  outl[38] += incr[38]; 
  outl[39] += -1.0*incr[39]; 
  outl[40] += -1.0*incr[40]; 
  outl[41] += -1.0*incr[41]; 
  outl[42] += incr[42]; 
  outl[43] += incr[43]; 
  outl[44] += incr[44]; 
  outl[45] += incr[45]; 
  outl[46] += -1.0*incr[46]; 
  outl[47] += incr[47]; 
return std::abs(alpha0); 
} 
double GyrokineticSurf2x2vSer_X_P2_Bvars_1(const double q_, const double m_, const double cflL, const double cflR, const double *w, const double *dxv, const double amax_in, const double *Bmag, const double *BmagInv, const double *Gradpar, const double *BdriftX, const double *BdriftY, const double *Phi, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w[NDIM]: Cell-center coordinates. dxv[NDIM]: Cell spacing. H/f: Input Hamiltonian/distribution function. out: Incremented output 
  double dfac_x = 2.0/dxv[0]; 
  double dfac_y = 2.0/dxv[1]; 
  double dfac_v = 2.0/dxv[2]; 
  double dfac_m = 2.0/dxv[3]; 
  double wx = w[0]; 
  double wy = w[1]; 
  double wv = w[2]; 
  double wm = w[3]; 
  double wv2 = wv*wv; 
  double dfac_v2 = dfac_v*dfac_v; 
  double q2 = q_*q_; 
  double incr[48]; 
  // surface-averaged phase velocity in this direction 
  double alpha0 = (0.04166666666666666*(dfac_v2*(2.0*(6.708203932499369*BdriftX[4]-5.196152422706631*BdriftX[1]+3.0*BdriftX[0])*m_*wv2-1.0*(3.872983346207417*(6.708203932499369*BmagInv[4]-5.196152422706631*BmagInv[1]+3.0*BmagInv[0])*Phi[6]-1.0*(2.23606797749979*(9.0*Phi[3]-5.196152422706631*Phi[2])*BmagInv[4]+(9.0*BmagInv[0]-15.58845726811989*BmagInv[1])*Phi[3]+(9.0*BmagInv[1]-5.196152422706631*BmagInv[0])*Phi[2]))*dfac_y*q_)+2.0*(2.23606797749979*BdriftX[4]-1.732050807568877*BdriftX[1]+BdriftX[0])*m_))/(dfac_v2*q_); 

  double alpha[20]; 
  alpha[0] = (0.2357022603955158*(dfac_v2*((13.41640786499874*BdriftX[4]-10.39230484541326*BdriftX[1]+6.0*BdriftX[0])*m_*wv2+(((-25.98076211353316*BmagInv[4])+20.1246117974981*BmagInv[1]-11.61895003862225*BmagInv[0])*Phi[6]+(20.12461179749811*Phi[3]-11.61895003862225*Phi[2])*BmagInv[4]+(9.0*BmagInv[0]-15.58845726811989*BmagInv[1])*Phi[3]+(9.0*BmagInv[1]-5.196152422706631*BmagInv[0])*Phi[2])*dfac_y*q_)+(4.47213595499958*BdriftX[4]-3.464101615137754*BdriftX[1]+2.0*BdriftX[0])*m_))/(dfac_v2*q_); 
  alpha[1] = 0.7071067811865475*((15.0*BmagInv[4]-11.61895003862225*BmagInv[1]+6.708203932499369*BmagInv[0])*Phi[7]+((-8.660254037844386*BmagInv[4])+6.708203932499369*BmagInv[1]-3.872983346207417*BmagInv[0])*Phi[5])*dfac_y; 
  alpha[2] = (0.2357022603955158*(15.49193338482967*BdriftX[4]-12.0*BdriftX[1]+6.928203230275509*BdriftX[0])*m_*wv)/(dfac_v*q_); 
  alpha[8] = (0.04714045207910316*(20.0*BdriftX[4]-15.49193338482967*BdriftX[1]+8.94427190999916*BdriftX[0])*m_)/(dfac_v2*q_); 
  double amax = 0.0; 
  bool upwind = false; 
  if(upwind) 
    amax = std::abs(alpha0); 
  else 
    amax = amax_in; 

  double Ghat[20]; 
  double favg[20]; 
  favg[0] = 0.7071067811865475*(2.23606797749979*(fr[11]+fl[11])+1.732050807568877*(fl[1]-1.0*fr[1])+fr[0]+fl[0]); 
  favg[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[19]+fl[19])+3.0*(fl[5]-1.0*fr[5]))+3.0*(fr[2]+fl[2])); 
  favg[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[21]+fl[21])+3.0*(fl[6]-1.0*fr[6]))+3.0*(fr[3]+fl[3])); 
  favg[3] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[25]+fl[25])+3.0*(fl[8]-1.0*fr[8]))+3.0*(fr[4]+fl[4])); 
  favg[4] = 0.7071067811865475*(2.23606797749979*(fr[32]+fl[32])+1.732050807568877*(fl[15]-1.0*fr[15])+fr[7]+fl[7]); 
  favg[5] = 0.7071067811865475*(2.23606797749979*(fr[35]+fl[35])+1.732050807568877*(fl[16]-1.0*fr[16])+fr[9]+fl[9]); 
  favg[6] = 0.7071067811865475*(2.23606797749979*(fr[37]+fl[37])+1.732050807568877*(fl[17]-1.0*fr[17])+fr[10]+fl[10]); 
  favg[7] = -0.1414213562373095*(8.660254037844387*fr[20]-1.0*(8.660254037844387*fl[20]+5.0*(fr[12]+fl[12]))); 
  favg[8] = -0.1414213562373095*(8.660254037844387*fr[23]-1.0*(8.660254037844387*fl[23]+5.0*(fr[13]+fl[13]))); 
  favg[9] = -0.1414213562373095*(8.660254037844387*fr[28]-1.0*(8.660254037844387*fl[28]+5.0*(fr[14]+fl[14]))); 
  favg[10] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[44]+fl[44])+3.0*(fl[31]-1.0*fr[31]))+3.0*(fr[18]+fl[18])); 
  favg[11] = -0.1414213562373095*(8.660254037844387*fr[33]-1.0*(8.660254037844387*fl[33]+5.0*(fr[22]+fl[22]))); 
  favg[12] = -0.1414213562373095*(8.660254037844387*fr[34]-1.0*(8.660254037844387*fl[34]+5.0*(fr[24]+fl[24]))); 
  favg[13] = -0.1414213562373095*(8.660254037844387*fr[36]-1.0*(8.660254037844387*fl[36]+5.0*(fr[26]+fl[26]))); 
  favg[14] = -0.1414213562373095*(8.660254037844387*fr[39]-1.0*(8.660254037844387*fl[39]+5.0*(fr[27]+fl[27]))); 
  favg[15] = -0.1414213562373095*(8.660254037844387*fr[41]-1.0*(8.660254037844387*fl[41]+5.0*(fr[29]+fl[29]))); 
  favg[16] = -0.1414213562373095*(8.660254037844387*fr[42]-1.0*(8.660254037844387*fl[42]+5.0*(fr[30]+fl[30]))); 
  favg[17] = -0.1414213562373095*(8.660254037844387*fr[45]-1.0*(8.660254037844387*fl[45]+5.0*(fr[38]+fl[38]))); 
  favg[18] = -0.1414213562373095*(8.660254037844387*fr[46]-1.0*(8.660254037844387*fl[46]+5.0*(fr[40]+fl[40]))); 
  favg[19] = -0.1414213562373095*(8.660254037844387*fr[47]-1.0*(8.660254037844387*fl[47]+5.0*(fr[43]+fl[43]))); 

  Ghat[0] = -0.125*((6.324555320336761*fr[11]-6.324555320336761*fl[11]-4.898979485566357*(fr[1]+fl[1])+2.828427124746191*fr[0]-2.828427124746191*fl[0])*amax-1.414213562373095*(alpha[8]*favg[8]+alpha[2]*favg[2]+alpha[1]*favg[1]+alpha[0]*favg[0])); 
  Ghat[1] = -0.008333333333333333*((94.8683298050514*fr[19]-94.8683298050514*fl[19]-73.48469228349535*(fr[5]+fl[5])+42.42640687119286*fr[2]-42.42640687119286*fl[2])*amax-21.21320343559643*alpha[8]*favg[12]-18.97366596101028*alpha[1]*favg[7]-21.21320343559643*(alpha[2]*favg[4]+alpha[0]*favg[1]+favg[0]*alpha[1])); 
  Ghat[2] = -0.008333333333333333*((94.8683298050514*fr[21]-94.8683298050514*fl[21]-73.48469228349535*(fr[6]+fl[6])+42.42640687119286*fr[3]-42.42640687119286*fl[3])*amax-18.97366596101028*(alpha[2]*favg[8]+favg[2]*alpha[8])-21.21320343559643*(alpha[1]*favg[4]+alpha[0]*favg[2]+favg[0]*alpha[2])); 
  Ghat[3] = -0.008333333333333333*((94.8683298050514*fr[25]-94.8683298050514*fl[25]-73.48469228349535*(fr[8]+fl[8])+42.42640687119286*fr[4]-42.42640687119286*fl[4])*amax-21.21320343559643*alpha[8]*favg[14]-21.21320343559643*(alpha[2]*favg[6]+alpha[1]*favg[5]+alpha[0]*favg[3])); 
  Ghat[4] = -0.008333333333333333*((94.86832980505142*fr[32]-94.86832980505142*fl[32]-73.48469228349535*(fr[15]+fl[15])+42.42640687119286*fr[7]-42.42640687119286*fl[7])*amax-18.97366596101028*(alpha[2]*favg[12]+alpha[1]*favg[11]+favg[4]*alpha[8])-21.21320343559643*(alpha[0]*favg[4]+alpha[1]*favg[2]+favg[1]*alpha[2])); 
  Ghat[5] = -0.008333333333333333*((94.86832980505142*fr[35]-94.86832980505142*fl[35]-73.48469228349535*(fr[16]+fl[16])+42.42640687119286*fr[9]-42.42640687119286*fl[9])*amax-21.21320343559643*alpha[8]*favg[18]-18.97366596101028*alpha[1]*favg[13]-21.21320343559643*(alpha[2]*favg[10]+alpha[0]*favg[5]+alpha[1]*favg[3])); 
  Ghat[6] = -0.008333333333333333*((94.86832980505142*fr[37]-94.86832980505142*fl[37]-73.48469228349535*(fr[17]+fl[17])+42.42640687119286*fr[10]-42.42640687119286*fl[10])*amax-18.97366596101028*alpha[2]*favg[14]-21.21320343559643*alpha[1]*favg[10]-18.97366596101028*favg[6]*alpha[8]-21.21320343559643*(alpha[0]*favg[6]+alpha[2]*favg[3])); 
  Ghat[7] = 0.008333333333333333*((73.48469228349536*(fr[20]+fl[20])-42.42640687119286*fr[12]+42.42640687119286*fl[12])*amax+21.21320343559643*alpha[2]*favg[11]+21.21320343559643*alpha[0]*favg[7]+18.97366596101028*alpha[1]*favg[1]); 
  Ghat[8] = 0.001190476190476191*((514.3928459844675*(fr[23]+fl[23])-296.98484809835*fr[13]+296.98484809835*fl[13])*amax+148.492424049175*alpha[1]*favg[12]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[8]+148.492424049175*favg[0]*alpha[8]+132.815661727072*alpha[2]*favg[2]); 
  Ghat[9] = 0.01863389981249824*((32.86335345030997*(fr[28]+fl[28])-18.97366596101028*fr[14]+18.97366596101028*fl[14])*amax+9.48683298050514*(alpha[2]*favg[16]+alpha[1]*favg[15]+alpha[0]*favg[9])); 
  Ghat[10] = -0.008333333333333333*((94.8683298050514*fr[44]-94.8683298050514*fl[44]-73.48469228349535*(fr[31]+fl[31])+42.42640687119286*fr[18]-42.42640687119286*fl[18])*amax-18.97366596101028*(alpha[2]*favg[18]+alpha[1]*favg[17])+((-18.97366596101028*alpha[8])-21.21320343559643*alpha[0])*favg[10]-21.21320343559643*(alpha[1]*favg[6]+alpha[2]*favg[5])); 
  Ghat[11] = 0.008333333333333333*((73.48469228349536*(fr[33]+fl[33])-42.42640687119286*fr[22]+42.42640687119286*fl[22])*amax+(18.97366596101028*alpha[8]+21.21320343559643*alpha[0])*favg[11]+21.21320343559643*alpha[2]*favg[7]+18.97366596101028*alpha[1]*favg[4]); 
  Ghat[12] = 0.001190476190476191*((514.3928459844675*(fr[34]+fl[34])-296.98484809835*fr[24]+296.98484809835*fl[24])*amax+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[12]+148.492424049175*(alpha[1]*favg[8]+favg[1]*alpha[8])+132.815661727072*alpha[2]*favg[4]); 
  Ghat[13] = 0.03227486121839514*((18.97366596101028*(fr[36]+fl[36])-10.95445115010333*fr[26]+10.95445115010333*fl[26])*amax+5.477225575051662*(alpha[2]*favg[17]+alpha[0]*favg[13])+4.898979485566357*alpha[1]*favg[5]); 
  Ghat[14] = 0.004610694459770734*((132.815661727072*(fr[39]+fl[39])-76.68115805072327*fr[27]+76.68115805072327*fl[27])*amax+38.34057902536163*alpha[1]*favg[18]+(24.49489742783179*alpha[8]+38.34057902536163*alpha[0])*favg[14]+38.34057902536163*favg[3]*alpha[8]+34.2928563989645*alpha[2]*favg[6]); 
  Ghat[15] = 0.03227486121839514*((18.97366596101028*(fr[41]+fl[41])-10.95445115010333*fr[29]+10.95445115010333*fl[29])*amax+5.477225575051662*(alpha[2]*favg[19]+alpha[0]*favg[15]+alpha[1]*favg[9])); 
  Ghat[16] = 0.006454972243679028*((94.86832980505142*(fr[42]+fl[42])-54.77225575051663*fr[30]+54.77225575051663*fl[30])*amax+27.38612787525831*alpha[1]*favg[19]+(24.49489742783179*alpha[8]+27.38612787525831*alpha[0])*favg[16]+27.38612787525831*alpha[2]*favg[9]); 
  Ghat[17] = 0.008333333333333333*((73.48469228349536*(fr[45]+fl[45])-42.42640687119286*fr[38]+42.42640687119286*fl[38])*amax+(18.97366596101028*alpha[8]+21.21320343559643*alpha[0])*favg[17]+21.21320343559643*alpha[2]*favg[13]+18.97366596101028*alpha[1]*favg[10]); 
  Ghat[18] = 0.001190476190476191*((514.3928459844675*(fr[46]+fl[46])-296.98484809835*fr[40]+296.98484809835*fl[40])*amax+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[18]+148.492424049175*alpha[1]*favg[14]+132.815661727072*alpha[2]*favg[10]+148.492424049175*favg[5]*alpha[8]); 
  Ghat[19] = 0.00116461873828114*((525.8136552049599*(fr[47]+fl[47])-303.5786553761646*fr[43]+303.5786553761646*fl[43])*amax+(135.7645019878172*alpha[8]+151.7893276880823*alpha[0])*favg[19]+151.7893276880823*(alpha[1]*favg[16]+alpha[2]*favg[15])+(32.86335345030997*alpha[8]+36.74234614174767*alpha[0])*favg[10]+36.74234614174767*(alpha[1]*favg[6]+alpha[2]*favg[5])); 
  incr[0] = 0.7071067811865475*Ghat[0]*dfac_x; 
  incr[1] = -1.224744871391589*Ghat[0]*dfac_x; 
  incr[2] = 0.7071067811865475*Ghat[1]*dfac_x; 
  incr[3] = 0.7071067811865475*Ghat[2]*dfac_x; 
  incr[4] = 0.7071067811865475*Ghat[3]*dfac_x; 
  incr[5] = -1.224744871391589*Ghat[1]*dfac_x; 
  incr[6] = -1.224744871391589*Ghat[2]*dfac_x; 
  incr[7] = 0.7071067811865475*Ghat[4]*dfac_x; 
  incr[8] = -1.224744871391589*Ghat[3]*dfac_x; 
  incr[9] = 0.7071067811865475*Ghat[5]*dfac_x; 
  incr[10] = 0.7071067811865475*Ghat[6]*dfac_x; 
  incr[11] = 1.58113883008419*Ghat[0]*dfac_x; 
  incr[12] = 0.7071067811865475*Ghat[7]*dfac_x; 
  incr[13] = 0.7071067811865475*Ghat[8]*dfac_x; 
  incr[14] = 0.7071067811865475*Ghat[9]*dfac_x; 
  incr[15] = -1.224744871391589*Ghat[4]*dfac_x; 
  incr[16] = -1.224744871391589*Ghat[5]*dfac_x; 
  incr[17] = -1.224744871391589*Ghat[6]*dfac_x; 
  incr[18] = 0.7071067811865475*Ghat[10]*dfac_x; 
  incr[19] = 1.58113883008419*Ghat[1]*dfac_x; 
  incr[20] = -1.224744871391589*Ghat[7]*dfac_x; 
  incr[21] = 1.58113883008419*Ghat[2]*dfac_x; 
  incr[22] = 0.7071067811865475*Ghat[11]*dfac_x; 
  incr[23] = -1.224744871391589*Ghat[8]*dfac_x; 
  incr[24] = 0.7071067811865475*Ghat[12]*dfac_x; 
  incr[25] = 1.58113883008419*Ghat[3]*dfac_x; 
  incr[26] = 0.7071067811865475*Ghat[13]*dfac_x; 
  incr[27] = 0.7071067811865475*Ghat[14]*dfac_x; 
  incr[28] = -1.224744871391589*Ghat[9]*dfac_x; 
  incr[29] = 0.7071067811865475*Ghat[15]*dfac_x; 
  incr[30] = 0.7071067811865475*Ghat[16]*dfac_x; 
  incr[31] = -1.224744871391589*Ghat[10]*dfac_x; 
  incr[32] = 1.58113883008419*Ghat[4]*dfac_x; 
  incr[33] = -1.224744871391589*Ghat[11]*dfac_x; 
  incr[34] = -1.224744871391589*Ghat[12]*dfac_x; 
  incr[35] = 1.58113883008419*Ghat[5]*dfac_x; 
  incr[36] = -1.224744871391589*Ghat[13]*dfac_x; 
  incr[37] = 1.58113883008419*Ghat[6]*dfac_x; 
  incr[38] = 0.7071067811865475*Ghat[17]*dfac_x; 
  incr[39] = -1.224744871391589*Ghat[14]*dfac_x; 
  incr[40] = 0.7071067811865475*Ghat[18]*dfac_x; 
  incr[41] = -1.224744871391589*Ghat[15]*dfac_x; 
  incr[42] = -1.224744871391589*Ghat[16]*dfac_x; 
  incr[43] = 0.7071067811865475*Ghat[19]*dfac_x; 
  incr[44] = 1.58113883008419*Ghat[10]*dfac_x; 
  incr[45] = -1.224744871391589*Ghat[17]*dfac_x; 
  incr[46] = -1.224744871391589*Ghat[18]*dfac_x; 
  incr[47] = -1.224744871391589*Ghat[19]*dfac_x; 

  outr[0] += incr[0]; 
  outr[1] += incr[1]; 
  outr[2] += incr[2]; 
  outr[3] += incr[3]; 
  outr[4] += incr[4]; 
  outr[5] += incr[5]; 
  outr[6] += incr[6]; 
  outr[7] += incr[7]; 
  outr[8] += incr[8]; 
  outr[9] += incr[9]; 
  outr[10] += incr[10]; 
  outr[11] += incr[11]; 
  outr[12] += incr[12]; 
  outr[13] += incr[13]; 
  outr[14] += incr[14]; 
  outr[15] += incr[15]; 
  outr[16] += incr[16]; 
  outr[17] += incr[17]; 
  outr[18] += incr[18]; 
  outr[19] += incr[19]; 
  outr[20] += incr[20]; 
  outr[21] += incr[21]; 
  outr[22] += incr[22]; 
  outr[23] += incr[23]; 
  outr[24] += incr[24]; 
  outr[25] += incr[25]; 
  outr[26] += incr[26]; 
  outr[27] += incr[27]; 
  outr[28] += incr[28]; 
  outr[29] += incr[29]; 
  outr[30] += incr[30]; 
  outr[31] += incr[31]; 
  outr[32] += incr[32]; 
  outr[33] += incr[33]; 
  outr[34] += incr[34]; 
  outr[35] += incr[35]; 
  outr[36] += incr[36]; 
  outr[37] += incr[37]; 
  outr[38] += incr[38]; 
  outr[39] += incr[39]; 
  outr[40] += incr[40]; 
  outr[41] += incr[41]; 
  outr[42] += incr[42]; 
  outr[43] += incr[43]; 
  outr[44] += incr[44]; 
  outr[45] += incr[45]; 
  outr[46] += incr[46]; 
  outr[47] += incr[47]; 

  outl[0] += -1.0*incr[0]; 
  outl[1] += incr[1]; 
  outl[2] += -1.0*incr[2]; 
  outl[3] += -1.0*incr[3]; 
  outl[4] += -1.0*incr[4]; 
  outl[5] += incr[5]; 
  outl[6] += incr[6]; 
  outl[7] += -1.0*incr[7]; 
  outl[8] += incr[8]; 
  outl[9] += -1.0*incr[9]; 
  outl[10] += -1.0*incr[10]; 
  outl[11] += -1.0*incr[11]; 
  outl[12] += -1.0*incr[12]; 
  outl[13] += -1.0*incr[13]; 
  outl[14] += -1.0*incr[14]; 
  outl[15] += incr[15]; 
  outl[16] += incr[16]; 
  outl[17] += incr[17]; 
  outl[18] += -1.0*incr[18]; 
  outl[19] += -1.0*incr[19]; 
  outl[20] += incr[20]; 
  outl[21] += -1.0*incr[21]; 
  outl[22] += -1.0*incr[22]; 
  outl[23] += incr[23]; 
  outl[24] += -1.0*incr[24]; 
  outl[25] += -1.0*incr[25]; 
  outl[26] += -1.0*incr[26]; 
  outl[27] += -1.0*incr[27]; 
  outl[28] += incr[28]; 
  outl[29] += -1.0*incr[29]; 
  outl[30] += -1.0*incr[30]; 
  outl[31] += incr[31]; 
  outl[32] += -1.0*incr[32]; 
  outl[33] += incr[33]; 
  outl[34] += incr[34]; 
  outl[35] += -1.0*incr[35]; 
  outl[36] += incr[36]; 
  outl[37] += -1.0*incr[37]; 
  outl[38] += -1.0*incr[38]; 
  outl[39] += incr[39]; 
  outl[40] += -1.0*incr[40]; 
  outl[41] += incr[41]; 
  outl[42] += incr[42]; 
  outl[43] += -1.0*incr[43]; 
  outl[44] += -1.0*incr[44]; 
  outl[45] += incr[45]; 
  outl[46] += incr[46]; 
  outl[47] += incr[47]; 
return std::abs(alpha0); 
} 
double GyrokineticSurf2x2vSer_Y_P2_Bvars_1(const double q_, const double m_, const double cflL, const double cflR, const double *w, const double *dxv, const double amax_in, const double *Bmag, const double *BmagInv, const double *Gradpar, const double *BdriftX, const double *BdriftY, const double *Phi, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w[NDIM]: Cell-center coordinates. dxv[NDIM]: Cell spacing. H/f: Input Hamiltonian/distribution function. out: Incremented output 
  double dfac_x = 2.0/dxv[0]; 
  double dfac_y = 2.0/dxv[1]; 
  double dfac_v = 2.0/dxv[2]; 
  double dfac_m = 2.0/dxv[3]; 
  double wx = w[0]; 
  double wy = w[1]; 
  double wv = w[2]; 
  double wm = w[3]; 
  double wv2 = wv*wv; 
  double dfac_v2 = dfac_v*dfac_v; 
  double q2 = q_*q_; 
  double incr[48]; 
  // surface-averaged phase velocity in this direction 
  double alpha0 = (0.04166666666666666*(dfac_v2*(6.0*BdriftY[0]*m_*wv2+dfac_x*(5.196152422706631*(2.23606797749979*BmagInv[1]*Bmag[4]+BmagInv[0]*Bmag[1])*wm+(11.61895003862225*BmagInv[0]*Phi[7]+5.196152422706631*BmagInv[1]*(2.23606797749979*Phi[4]-3.872983346207417*Phi[6])+BmagInv[0]*(5.196152422706631*Phi[1]-9.0*Phi[3]))*q_))+2.0*BdriftY[0]*m_))/(dfac_v2*q_); 

  double alpha[20]; 
  alpha[0] = (0.2357022603955158*(dfac_v2*(6.0*BdriftY[0]*m_*wv2+dfac_x*((11.61895003862225*BmagInv[1]*Bmag[4]+5.196152422706631*BmagInv[0]*Bmag[1])*wm+(11.61895003862225*BmagInv[0]*Phi[7]+BmagInv[1]*(11.61895003862225*Phi[4]-20.1246117974981*Phi[6])+BmagInv[0]*(5.196152422706631*Phi[1]-9.0*Phi[3]))*q_))+2.0*BdriftY[0]*m_))/(dfac_v2*q_); 
  alpha[1] = (0.04714045207910316*(dfac_v2*(30.0*BdriftY[1]*m_*wv2+dfac_x*((Bmag[4]*(51.96152422706631*BmagInv[4]+58.09475019311126*BmagInv[0])+25.98076211353316*Bmag[1]*BmagInv[1])*wm+(58.09475019311126*BmagInv[1]*Phi[7]+((-90.0*BmagInv[4])-100.6230589874905*BmagInv[0])*Phi[6]+(51.96152422706631*BmagInv[4]+58.09475019311126*BmagInv[0])*Phi[4]+BmagInv[1]*(25.98076211353316*Phi[1]-45.0*Phi[3]))*q_))+10.0*BdriftY[1]*m_))/(dfac_v2*q_); 
  alpha[2] = (1.632993161855453*BdriftY[0]*m_*wv)/(dfac_v*q_); 
  alpha[3] = (0.7071067811865475*(2.23606797749979*BmagInv[1]*Bmag[4]+BmagInv[0]*Bmag[1])*dfac_x)/(dfac_m*q_); 
  alpha[4] = (1.632993161855453*BdriftY[1]*m_*wv)/(dfac_v*q_); 
  alpha[5] = (0.7071067811865475*(Bmag[4]*(2.0*BmagInv[4]+2.23606797749979*BmagInv[0])+Bmag[1]*BmagInv[1])*dfac_x)/(dfac_m*q_); 
  alpha[7] = (0.04714045207910316*(dfac_v2*(30.0*BdriftY[4]*m_*wv2+dfac_x*((25.98076211353316*Bmag[1]*BmagInv[4]+51.96152422706631*BmagInv[1]*Bmag[4])*wm+(58.09475019311126*BmagInv[4]*Phi[7]+BmagInv[1]*(51.96152422706631*Phi[4]-90.0*Phi[6])+(25.98076211353316*Phi[1]-45.0*Phi[3])*BmagInv[4])*q_))+10.0*BdriftY[4]*m_))/(dfac_v2*q_); 
  alpha[8] = (0.421637021355784*BdriftY[0]*m_)/(dfac_v2*q_); 
  alpha[11] = (1.632993161855453*BdriftY[4]*m_*wv)/(dfac_v*q_); 
  alpha[12] = (0.4216370213557841*BdriftY[1]*m_)/(dfac_v2*q_); 
  alpha[13] = (0.04714045207910316*(15.0*Bmag[1]*BmagInv[4]+30.0*BmagInv[1]*Bmag[4])*dfac_x)/(dfac_m*q_); 
  double amax = 0.0; 
  bool upwind = false; 
  if(upwind) 
    amax = std::abs(alpha0); 
  else 
    amax = amax_in; 

  double Ghat[20]; 
  double favg[20]; 
  favg[0] = 0.7071067811865475*(2.23606797749979*(fr[12]+fl[12])+1.732050807568877*(fl[2]-1.0*fr[2])+fr[0]+fl[0]); 
  favg[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[20]+fl[20])+3.0*(fl[5]-1.0*fr[5]))+3.0*(fr[1]+fl[1])); 
  favg[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[22]+fl[22])+3.0*(fl[7]-1.0*fr[7]))+3.0*(fr[3]+fl[3])); 
  favg[3] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[26]+fl[26])+3.0*(fl[9]-1.0*fr[9]))+3.0*(fr[4]+fl[4])); 
  favg[4] = 0.7071067811865475*(2.23606797749979*(fr[33]+fl[33])+1.732050807568877*(fl[15]-1.0*fr[15])+fr[6]+fl[6]); 
  favg[5] = 0.7071067811865475*(2.23606797749979*(fr[36]+fl[36])+1.732050807568877*(fl[16]-1.0*fr[16])+fr[8]+fl[8]); 
  favg[6] = 0.7071067811865475*(2.23606797749979*(fr[38]+fl[38])+1.732050807568877*(fl[18]-1.0*fr[18])+fr[10]+fl[10]); 
  favg[7] = -0.1414213562373095*(8.660254037844387*fr[19]-1.0*(8.660254037844387*fl[19]+5.0*(fr[11]+fl[11]))); 
  favg[8] = -0.1414213562373095*(8.660254037844387*fr[24]-1.0*(8.660254037844387*fl[24]+5.0*(fr[13]+fl[13]))); 
  favg[9] = -0.1414213562373095*(8.660254037844387*fr[29]-1.0*(8.660254037844387*fl[29]+5.0*(fr[14]+fl[14]))); 
  favg[10] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[45]+fl[45])+3.0*(fl[31]-1.0*fr[31]))+3.0*(fr[17]+fl[17])); 
  favg[11] = -0.1414213562373095*(8.660254037844387*fr[32]-1.0*(8.660254037844387*fl[32]+5.0*(fr[21]+fl[21]))); 
  favg[12] = -0.1414213562373095*(8.660254037844387*fr[34]-1.0*(8.660254037844387*fl[34]+5.0*(fr[23]+fl[23]))); 
  favg[13] = -0.1414213562373095*(8.660254037844387*fr[35]-1.0*(8.660254037844387*fl[35]+5.0*(fr[25]+fl[25]))); 
  favg[14] = -0.1414213562373095*(8.660254037844387*fr[40]-1.0*(8.660254037844387*fl[40]+5.0*(fr[27]+fl[27]))); 
  favg[15] = -0.1414213562373095*(8.660254037844387*fr[41]-1.0*(8.660254037844387*fl[41]+5.0*(fr[28]+fl[28]))); 
  favg[16] = -0.1414213562373095*(8.660254037844387*fr[43]-1.0*(8.660254037844387*fl[43]+5.0*(fr[30]+fl[30]))); 
  favg[17] = -0.1414213562373095*(8.660254037844387*fr[44]-1.0*(8.660254037844387*fl[44]+5.0*(fr[37]+fl[37]))); 
  favg[18] = -0.1414213562373095*(8.660254037844387*fr[46]-1.0*(8.660254037844387*fl[46]+5.0*(fr[39]+fl[39]))); 
  favg[19] = -0.1414213562373095*(8.660254037844387*fr[47]-1.0*(8.660254037844387*fl[47]+5.0*(fr[42]+fl[42]))); 

  Ghat[0] = -0.125*((6.324555320336761*fr[12]-6.324555320336761*fl[12]-4.898979485566357*(fr[2]+fl[2])+2.828427124746191*fr[0]-2.828427124746191*fl[0])*amax-1.414213562373095*(alpha[13]*favg[13]+alpha[12]*favg[12]+alpha[11]*favg[11]+alpha[8]*favg[8]+alpha[7]*favg[7]+alpha[5]*favg[5]+alpha[4]*favg[4]+alpha[3]*favg[3]+alpha[2]*favg[2]+alpha[1]*favg[1]+alpha[0]*favg[0])); 
  Ghat[1] = -0.008333333333333333*((94.8683298050514*fr[20]-94.8683298050514*fl[20]-73.48469228349535*(fr[5]+fl[5])+42.42640687119286*fr[1]-42.42640687119286*fl[1])*amax-18.97366596101028*(alpha[5]*favg[13]+favg[5]*alpha[13])-21.21320343559643*(alpha[8]*favg[12]+favg[8]*alpha[12])-18.97366596101028*(alpha[4]*favg[11]+favg[4]*alpha[11]+alpha[1]*favg[7]+favg[1]*alpha[7])-21.21320343559643*(alpha[3]*favg[5]+favg[3]*alpha[5]+alpha[2]*favg[4]+favg[2]*alpha[4]+alpha[0]*favg[1]+favg[0]*alpha[1])); 
  Ghat[2] = -0.008333333333333333*((94.8683298050514*fr[22]-94.8683298050514*fl[22]-73.48469228349535*(fr[7]+fl[7])+42.42640687119286*fr[3]-42.42640687119286*fl[3])*amax-21.21320343559643*alpha[13]*favg[17]-18.97366596101028*(alpha[4]*favg[12]+favg[4]*alpha[12])-21.21320343559643*(alpha[7]*favg[11]+favg[7]*alpha[11])-21.21320343559643*alpha[5]*favg[10]-18.97366596101028*(alpha[2]*favg[8]+favg[2]*alpha[8])-21.21320343559643*(alpha[3]*favg[6]+alpha[1]*favg[4]+favg[1]*alpha[4]+alpha[0]*favg[2]+favg[0]*alpha[2])); 
  Ghat[3] = -0.008333333333333333*((94.8683298050514*fr[26]-94.8683298050514*fl[26]-73.48469228349535*(fr[9]+fl[9])+42.42640687119286*fr[4]-42.42640687119286*fl[4])*amax-21.21320343559643*(alpha[12]*favg[18]+alpha[11]*favg[17])-18.97366596101028*alpha[5]*favg[15]-21.21320343559643*(alpha[8]*favg[14]+alpha[7]*favg[13]+favg[7]*alpha[13])-21.21320343559643*alpha[4]*favg[10]-18.97366596101028*alpha[3]*favg[9]-21.21320343559643*(alpha[2]*favg[6]+alpha[1]*favg[5]+favg[1]*alpha[5]+alpha[0]*favg[3]+favg[0]*alpha[3])); 
  Ghat[4] = -0.008333333333333333*((94.86832980505142*fr[33]-94.86832980505142*fl[33]-73.48469228349535*(fr[15]+fl[15])+42.42640687119286*fr[6]-42.42640687119286*fl[6])*amax-18.97366596101028*(alpha[5]*favg[17]+favg[10]*alpha[13])+((-16.97056274847715*alpha[11])-18.97366596101028*alpha[2])*favg[12]+((-16.97056274847715*favg[11])-18.97366596101028*favg[2])*alpha[12]-18.97366596101028*(alpha[1]*favg[11]+favg[1]*alpha[11])-21.21320343559643*alpha[3]*favg[10]-18.97366596101028*(alpha[4]*favg[8]+favg[4]*alpha[8]+alpha[4]*favg[7]+favg[4]*alpha[7])-21.21320343559643*(alpha[5]*favg[6]+alpha[0]*favg[4]+favg[0]*alpha[4]+alpha[1]*favg[2]+favg[1]*alpha[2])); 
  Ghat[5] = -0.008333333333333333*((94.86832980505142*fr[36]-94.86832980505142*fl[36]-73.48469228349535*(fr[16]+fl[16])+42.42640687119286*fr[8]-42.42640687119286*fl[8])*amax-21.21320343559643*alpha[8]*favg[18]-18.97366596101028*alpha[4]*favg[17]+((-16.97056274847715*alpha[13])-18.97366596101028*alpha[3])*favg[15]-21.21320343559643*alpha[12]*favg[14]-18.97366596101028*(alpha[1]*favg[13]+favg[1]*alpha[13])+favg[10]*((-18.97366596101028*alpha[11])-21.21320343559643*alpha[2])-18.97366596101028*(alpha[5]*(favg[9]+favg[7])+favg[5]*alpha[7])-21.21320343559643*(alpha[4]*favg[6]+alpha[0]*favg[5]+favg[0]*alpha[5]+alpha[1]*favg[3]+favg[1]*alpha[3])); 
  Ghat[6] = -0.008333333333333333*((94.86832980505142*fr[38]-94.86832980505142*fl[38]-73.48469228349535*(fr[18]+fl[18])+42.42640687119286*fr[10]-42.42640687119286*fl[10])*amax-18.97366596101028*(alpha[5]*favg[19]+alpha[4]*favg[18])-21.21320343559643*alpha[7]*favg[17]-18.97366596101028*(alpha[3]*favg[16]+alpha[2]*favg[14])-21.21320343559643*(alpha[11]*favg[13]+favg[11]*alpha[13])+favg[10]*((-18.97366596101028*alpha[12])-21.21320343559643*alpha[1])-18.97366596101028*favg[6]*alpha[8]-21.21320343559643*(alpha[0]*favg[6]+alpha[4]*favg[5]+favg[4]*alpha[5]+alpha[2]*favg[3]+favg[2]*alpha[3])); 
  Ghat[7] = 0.001190476190476191*((514.3928459844675*(fr[19]+fl[19])-296.98484809835*fr[11]+296.98484809835*fl[11])*amax+(94.86832980505142*alpha[13]+148.492424049175*alpha[3])*favg[13]+148.492424049175*favg[3]*alpha[13]+132.815661727072*alpha[12]*favg[12]+(94.86832980505142*alpha[11]+148.492424049175*alpha[2])*favg[11]+148.492424049175*favg[2]*alpha[11]+(94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[7]+148.492424049175*favg[0]*alpha[7]+132.815661727072*(alpha[5]*favg[5]+alpha[4]*favg[4]+alpha[1]*favg[1])); 
  Ghat[8] = 0.001190476190476191*((514.3928459844675*(fr[24]+fl[24])-296.98484809835*fr[13]+296.98484809835*fl[13])*amax+148.492424049175*(alpha[5]*favg[18]+alpha[3]*favg[14])+(94.86832980505142*alpha[12]+148.492424049175*alpha[1])*favg[12]+148.492424049175*favg[1]*alpha[12]+132.815661727072*alpha[11]*favg[11]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[8]+148.492424049175*favg[0]*alpha[8]+132.815661727072*(alpha[4]*favg[4]+alpha[2]*favg[2])); 
  Ghat[9] = 0.00116461873828114*((525.8136552049599*(fr[29]+fl[29])-303.5786553761646*fr[14]+303.5786553761646*fl[14])*amax+151.7893276880823*(alpha[4]*favg[19]+alpha[2]*favg[16])+(82.15838362577493*alpha[5]+151.7893276880823*alpha[1])*favg[15]+135.7645019878172*alpha[13]*favg[13]+151.7893276880823*alpha[0]*favg[9]+135.7645019878172*(alpha[5]*favg[5]+alpha[3]*favg[3])); 
  Ghat[10] = -0.002886751345948129*((273.8612787525831*fr[45]-273.8612787525831*fl[45]-212.1320343559643*(fr[31]+fl[31])+122.4744871391589*fr[17]-122.4744871391589*fl[17])*amax+((-48.98979485566359*alpha[13])-54.77225575051663*alpha[3])*favg[19]+((-48.98979485566359*alpha[11])-54.77225575051663*alpha[2])*favg[18]+((-48.98979485566359*alpha[12])-54.77225575051663*alpha[1])*favg[17]-54.77225575051663*(alpha[5]*favg[16]+alpha[4]*(favg[14]+favg[13])+favg[4]*alpha[13]+favg[6]*alpha[12]+alpha[5]*favg[11]+favg[5]*alpha[11])+((-54.77225575051663*(alpha[8]+alpha[7]))-61.23724356957945*alpha[0])*favg[10]-61.23724356957945*(alpha[1]*favg[6]+alpha[2]*favg[5]+favg[2]*alpha[5]+alpha[3]*favg[4]+favg[3]*alpha[4])); 
  Ghat[11] = 0.001190476190476191*((514.3928459844675*(fr[32]+fl[32])-296.98484809835*fr[21]+296.98484809835*fl[21])*amax+(94.86832980505142*alpha[13]+148.492424049175*alpha[3])*favg[17]+148.492424049175*favg[6]*alpha[13]+118.79393923934*(alpha[4]*favg[12]+favg[4]*alpha[12])+(132.815661727072*alpha[8]+94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[11]+(132.815661727072*favg[8]+94.86832980505142*favg[7]+148.492424049175*favg[0])*alpha[11]+132.815661727072*alpha[5]*favg[10]+148.492424049175*(alpha[2]*favg[7]+favg[2]*alpha[7])+132.815661727072*(alpha[1]*favg[4]+favg[1]*alpha[4])); 
  Ghat[12] = 9.221388919541468e-4*((664.0783086353599*(fr[34]+fl[34])-383.4057902536164*fr[23]+383.4057902536164*fl[23])*amax+(171.4642819948225*alpha[13]+191.7028951268082*alpha[3])*favg[18]+191.7028951268082*alpha[5]*favg[14]+(122.474487139159*alpha[8]+171.4642819948225*alpha[7]+191.7028951268082*alpha[0])*favg[12]+(122.474487139159*favg[8]+171.4642819948225*favg[7]+191.7028951268082*favg[0])*alpha[12]+153.3623161014466*(alpha[4]*favg[11]+favg[4]*alpha[11])+191.7028951268082*(alpha[1]*favg[8]+favg[1]*alpha[8])+171.4642819948225*(alpha[2]*favg[4]+favg[2]*alpha[4])); 
  Ghat[13] = 0.001190476190476191*((514.3928459844675*(fr[35]+fl[35])-296.98484809835*fr[25]+296.98484809835*fl[25])*amax+132.815661727072*alpha[12]*favg[18]+(94.86832980505142*alpha[11]+148.492424049175*alpha[2])*favg[17]+118.79393923934*alpha[5]*favg[15]+(94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[13]+(132.815661727072*favg[9]+94.86832980505142*favg[7]+148.492424049175*favg[0])*alpha[13]+148.492424049175*favg[6]*alpha[11]+132.815661727072*alpha[4]*favg[10]+148.492424049175*(alpha[3]*favg[7]+favg[3]*alpha[7])+132.815661727072*(alpha[1]*favg[5]+favg[1]*alpha[5])); 
  Ghat[14] = 0.001190476190476191*((514.3928459844675*(fr[40]+fl[40])-296.98484809835*fr[27]+296.98484809835*fl[27])*amax+(94.86832980505142*alpha[12]+148.492424049175*alpha[1])*favg[18]+132.815661727072*alpha[11]*favg[17]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[14]+148.492424049175*(alpha[5]*favg[12]+favg[5]*alpha[12])+132.815661727072*alpha[4]*favg[10]+148.492424049175*(alpha[3]*favg[8]+favg[3]*alpha[8])+132.815661727072*alpha[2]*favg[6]); 
  Ghat[15] = 0.006454972243679028*((94.86832980505142*(fr[41]+fl[41])-54.77225575051663*fr[28]+54.77225575051663*fl[28])*amax+(24.49489742783179*alpha[11]+27.38612787525831*alpha[2])*favg[19]+27.38612787525831*alpha[4]*favg[16]+(24.49489742783179*alpha[7]+27.38612787525831*alpha[0])*favg[15]+21.90890230020666*(alpha[5]*favg[13]+favg[5]*alpha[13])+27.38612787525831*alpha[1]*favg[9]+24.49489742783179*(alpha[3]*favg[5]+favg[3]*alpha[5])); 
  Ghat[16] = 0.006454972243679028*((94.86832980505142*(fr[43]+fl[43])-54.77225575051663*fr[30]+54.77225575051663*fl[30])*amax+(24.49489742783179*alpha[12]+27.38612787525831*alpha[1])*favg[19]+24.49489742783179*alpha[13]*favg[17]+(24.49489742783179*alpha[8]+27.38612787525831*alpha[0])*favg[16]+27.38612787525831*alpha[4]*favg[15]+24.49489742783179*alpha[5]*favg[10]+27.38612787525831*alpha[2]*favg[9]+24.49489742783179*alpha[3]*favg[6]); 
  Ghat[17] = 2.380952380952381e-4*((2571.964229922338*(fr[44]+fl[44])-1484.92424049175*fr[37]+1484.92424049175*fl[37])*amax+593.9696961967002*(alpha[5]*favg[19]+alpha[4]*favg[18])+(664.0783086353599*alpha[8]+474.3416490252571*alpha[7]+742.462120245875*alpha[0])*favg[17]+664.0783086353599*(alpha[13]*favg[16]+alpha[11]*favg[14])+(474.3416490252571*alpha[11]+742.462120245875*alpha[2])*favg[13]+(474.3416490252571*favg[11]+742.462120245875*favg[2])*alpha[13]+593.9696961967002*favg[10]*alpha[12]+742.462120245875*(alpha[3]*favg[11]+favg[3]*alpha[11])+664.0783086353599*alpha[1]*favg[10]+742.462120245875*favg[6]*alpha[7]+664.0783086353599*(alpha[4]*favg[5]+favg[4]*alpha[5])); 
  Ghat[18] = 2.380952380952381e-4*((2571.964229922338*(fr[46]+fl[46])-1484.92424049175*fr[39]+1484.92424049175*fl[39])*amax+(474.3416490252571*alpha[8]+664.0783086353599*alpha[7]+742.462120245875*alpha[0])*favg[18]+593.9696961967002*alpha[4]*favg[17]+(474.3416490252571*alpha[12]+742.462120245875*alpha[1])*favg[14]+664.0783086353599*(alpha[12]*favg[13]+favg[12]*alpha[13])+742.462120245875*(alpha[3]*favg[12]+favg[3]*alpha[12])+favg[10]*(593.9696961967002*alpha[11]+664.0783086353599*alpha[2])+742.462120245875*(alpha[5]*favg[8]+favg[5]*alpha[8])+664.0783086353599*alpha[4]*favg[6]); 
  Ghat[19] = 0.001666666666666667*((367.4234614174769*(fr[47]+fl[47])-212.1320343559643*fr[42]+212.1320343559643*fl[42])*amax+(94.86832980505142*(alpha[8]+alpha[7])+106.0660171779821*alpha[0])*favg[19]+84.85281374238573*alpha[5]*favg[17]+(94.86832980505142*alpha[12]+106.0660171779822*alpha[1])*favg[16]+(94.86832980505142*alpha[11]+106.0660171779822*alpha[2])*favg[15]+favg[10]*(84.85281374238573*alpha[13]+94.86832980505142*alpha[3])+106.0660171779821*alpha[4]*favg[9]+94.86832980505142*alpha[5]*favg[6]); 
  incr[0] = 0.7071067811865475*Ghat[0]*dfac_y; 
  incr[1] = 0.7071067811865475*Ghat[1]*dfac_y; 
  incr[2] = -1.224744871391589*Ghat[0]*dfac_y; 
  incr[3] = 0.7071067811865475*Ghat[2]*dfac_y; 
  incr[4] = 0.7071067811865475*Ghat[3]*dfac_y; 
  incr[5] = -1.224744871391589*Ghat[1]*dfac_y; 
  incr[6] = 0.7071067811865475*Ghat[4]*dfac_y; 
  incr[7] = -1.224744871391589*Ghat[2]*dfac_y; 
  incr[8] = 0.7071067811865475*Ghat[5]*dfac_y; 
  incr[9] = -1.224744871391589*Ghat[3]*dfac_y; 
  incr[10] = 0.7071067811865475*Ghat[6]*dfac_y; 
  incr[11] = 0.7071067811865475*Ghat[7]*dfac_y; 
  incr[12] = 1.58113883008419*Ghat[0]*dfac_y; 
  incr[13] = 0.7071067811865475*Ghat[8]*dfac_y; 
  incr[14] = 0.7071067811865475*Ghat[9]*dfac_y; 
  incr[15] = -1.224744871391589*Ghat[4]*dfac_y; 
  incr[16] = -1.224744871391589*Ghat[5]*dfac_y; 
  incr[17] = 0.7071067811865475*Ghat[10]*dfac_y; 
  incr[18] = -1.224744871391589*Ghat[6]*dfac_y; 
  incr[19] = -1.224744871391589*Ghat[7]*dfac_y; 
  incr[20] = 1.58113883008419*Ghat[1]*dfac_y; 
  incr[21] = 0.7071067811865475*Ghat[11]*dfac_y; 
  incr[22] = 1.58113883008419*Ghat[2]*dfac_y; 
  incr[23] = 0.7071067811865475*Ghat[12]*dfac_y; 
  incr[24] = -1.224744871391589*Ghat[8]*dfac_y; 
  incr[25] = 0.7071067811865475*Ghat[13]*dfac_y; 
  incr[26] = 1.58113883008419*Ghat[3]*dfac_y; 
  incr[27] = 0.7071067811865475*Ghat[14]*dfac_y; 
  incr[28] = 0.7071067811865475*Ghat[15]*dfac_y; 
  incr[29] = -1.224744871391589*Ghat[9]*dfac_y; 
  incr[30] = 0.7071067811865475*Ghat[16]*dfac_y; 
  incr[31] = -1.224744871391589*Ghat[10]*dfac_y; 
  incr[32] = -1.224744871391589*Ghat[11]*dfac_y; 
  incr[33] = 1.58113883008419*Ghat[4]*dfac_y; 
  incr[34] = -1.224744871391589*Ghat[12]*dfac_y; 
  incr[35] = -1.224744871391589*Ghat[13]*dfac_y; 
  incr[36] = 1.58113883008419*Ghat[5]*dfac_y; 
  incr[37] = 0.7071067811865475*Ghat[17]*dfac_y; 
  incr[38] = 1.58113883008419*Ghat[6]*dfac_y; 
  incr[39] = 0.7071067811865475*Ghat[18]*dfac_y; 
  incr[40] = -1.224744871391589*Ghat[14]*dfac_y; 
  incr[41] = -1.224744871391589*Ghat[15]*dfac_y; 
  incr[42] = 0.7071067811865475*Ghat[19]*dfac_y; 
  incr[43] = -1.224744871391589*Ghat[16]*dfac_y; 
  incr[44] = -1.224744871391589*Ghat[17]*dfac_y; 
  incr[45] = 1.58113883008419*Ghat[10]*dfac_y; 
  incr[46] = -1.224744871391589*Ghat[18]*dfac_y; 
  incr[47] = -1.224744871391589*Ghat[19]*dfac_y; 

  outr[0] += incr[0]; 
  outr[1] += incr[1]; 
  outr[2] += incr[2]; 
  outr[3] += incr[3]; 
  outr[4] += incr[4]; 
  outr[5] += incr[5]; 
  outr[6] += incr[6]; 
  outr[7] += incr[7]; 
  outr[8] += incr[8]; 
  outr[9] += incr[9]; 
  outr[10] += incr[10]; 
  outr[11] += incr[11]; 
  outr[12] += incr[12]; 
  outr[13] += incr[13]; 
  outr[14] += incr[14]; 
  outr[15] += incr[15]; 
  outr[16] += incr[16]; 
  outr[17] += incr[17]; 
  outr[18] += incr[18]; 
  outr[19] += incr[19]; 
  outr[20] += incr[20]; 
  outr[21] += incr[21]; 
  outr[22] += incr[22]; 
  outr[23] += incr[23]; 
  outr[24] += incr[24]; 
  outr[25] += incr[25]; 
  outr[26] += incr[26]; 
  outr[27] += incr[27]; 
  outr[28] += incr[28]; 
  outr[29] += incr[29]; 
  outr[30] += incr[30]; 
  outr[31] += incr[31]; 
  outr[32] += incr[32]; 
  outr[33] += incr[33]; 
  outr[34] += incr[34]; 
  outr[35] += incr[35]; 
  outr[36] += incr[36]; 
  outr[37] += incr[37]; 
  outr[38] += incr[38]; 
  outr[39] += incr[39]; 
  outr[40] += incr[40]; 
  outr[41] += incr[41]; 
  outr[42] += incr[42]; 
  outr[43] += incr[43]; 
  outr[44] += incr[44]; 
  outr[45] += incr[45]; 
  outr[46] += incr[46]; 
  outr[47] += incr[47]; 

  outl[0] += -1.0*incr[0]; 
  outl[1] += -1.0*incr[1]; 
  outl[2] += incr[2]; 
  outl[3] += -1.0*incr[3]; 
  outl[4] += -1.0*incr[4]; 
  outl[5] += incr[5]; 
  outl[6] += -1.0*incr[6]; 
  outl[7] += incr[7]; 
  outl[8] += -1.0*incr[8]; 
  outl[9] += incr[9]; 
  outl[10] += -1.0*incr[10]; 
  outl[11] += -1.0*incr[11]; 
  outl[12] += -1.0*incr[12]; 
  outl[13] += -1.0*incr[13]; 
  outl[14] += -1.0*incr[14]; 
  outl[15] += incr[15]; 
  outl[16] += incr[16]; 
  outl[17] += -1.0*incr[17]; 
  outl[18] += incr[18]; 
  outl[19] += incr[19]; 
  outl[20] += -1.0*incr[20]; 
  outl[21] += -1.0*incr[21]; 
  outl[22] += -1.0*incr[22]; 
  outl[23] += -1.0*incr[23]; 
  outl[24] += incr[24]; 
  outl[25] += -1.0*incr[25]; 
  outl[26] += -1.0*incr[26]; 
  outl[27] += -1.0*incr[27]; 
  outl[28] += -1.0*incr[28]; 
  outl[29] += incr[29]; 
  outl[30] += -1.0*incr[30]; 
  outl[31] += incr[31]; 
  outl[32] += incr[32]; 
  outl[33] += -1.0*incr[33]; 
  outl[34] += incr[34]; 
  outl[35] += incr[35]; 
  outl[36] += -1.0*incr[36]; 
  outl[37] += -1.0*incr[37]; 
  outl[38] += -1.0*incr[38]; 
  outl[39] += -1.0*incr[39]; 
  outl[40] += incr[40]; 
  outl[41] += incr[41]; 
  outl[42] += -1.0*incr[42]; 
  outl[43] += incr[43]; 
  outl[44] += incr[44]; 
  outl[45] += -1.0*incr[45]; 
  outl[46] += incr[46]; 
  outl[47] += incr[47]; 
return std::abs(alpha0); 
} 
double GyrokineticSurf2x2vSer_Vpar_P2_Bvars_1(const double q_, const double m_, const double cflL, const double cflR, const double *w, const double *dxv, const double amax_in, const double *Bmag, const double *BmagInv, const double *Gradpar, const double *BdriftX, const double *BdriftY, const double *Phi, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w[NDIM]: Cell-center coordinates. dxv[NDIM]: Cell spacing. H/f: Input Hamiltonian/distribution function. out: Incremented output 
  double dfac_x = 2.0/dxv[0]; 
  double dfac_y = 2.0/dxv[1]; 
  double dfac_v = 2.0/dxv[2]; 
  double dfac_m = 2.0/dxv[3]; 
  double wx = w[0]; 
  double wy = w[1]; 
  double wv = w[2]; 
  double wm = w[3]; 
  double wv2 = wv*wv; 
  double dfac_v2 = dfac_v*dfac_v; 
  double q2 = q_*q_; 
  double incr[48]; 
  // surface-averaged phase velocity in this direction 
  double alpha0 = -(0.025*(dfac_v*(1.732050807568877*(11.18033988749895*BdriftX[1]*Bmag[4]+5.0*BdriftX[0]*Bmag[1])*dfac_x*wm+((8.660254037844387*BdriftY[4]*Phi[6]+8.660254037844386*(BdriftY[1]*Phi[3]+BdriftY[0]*Phi[2]))*dfac_y+1.732050807568877*(11.18033988749895*BdriftX[1]*Phi[4]+5.0*BdriftX[0]*Phi[1])*dfac_x)*q_)*wv-1.0*(1.732050807568877*(11.18033988749895*BdriftX[1]*Bmag[4]+5.0*BdriftX[0]*Bmag[1])*dfac_x*wm+((8.660254037844387*BdriftY[4]*Phi[6]+8.660254037844386*(BdriftY[1]*Phi[3]+BdriftY[0]*Phi[2]))*dfac_y+1.732050807568877*(11.18033988749895*BdriftX[1]*Phi[4]+5.0*BdriftX[0]*Phi[1])*dfac_x)*q_)))/(dfac_v*q_); 

  double alpha[20]; 
  alpha[0] = -(0.1414213562373095*(dfac_v*((19.36491673103709*BdriftX[1]*Bmag[4]+8.660254037844386*BdriftX[0]*Bmag[1])*dfac_x*wm+((8.660254037844387*BdriftY[4]*Phi[6]+8.660254037844386*(BdriftY[1]*Phi[3]+BdriftY[0]*Phi[2]))*dfac_y+(19.36491673103709*BdriftX[1]*Phi[4]+8.660254037844386*BdriftX[0]*Phi[1])*dfac_x)*q_)*wv+((-19.36491673103709*BdriftX[1]*Bmag[4])-8.660254037844386*BdriftX[0]*Bmag[1])*dfac_x*wm+(((-8.660254037844387*BdriftY[4]*Phi[6])-8.660254037844386*(BdriftY[1]*Phi[3]+BdriftY[0]*Phi[2]))*dfac_y+((-19.36491673103709*BdriftX[1]*Phi[4])-8.660254037844386*BdriftX[0]*Phi[1])*dfac_x)*q_))/(dfac_v*q_); 
  alpha[1] = -(0.1414213562373095*(dfac_v*(((17.32050807568877*BdriftX[4]+19.36491673103709*BdriftX[0])*Bmag[4]+8.660254037844386*BdriftX[1]*Bmag[1])*dfac_x*wm+((7.745966692414834*(BdriftY[1]*Phi[6]+Phi[3]*BdriftY[4])+8.660254037844386*(BdriftY[0]*Phi[3]+BdriftY[1]*Phi[2]))*dfac_y+((17.32050807568877*BdriftX[4]+19.36491673103709*BdriftX[0])*Phi[4]+8.660254037844386*BdriftX[1]*Phi[1])*dfac_x)*q_)*wv+(((-17.32050807568877*BdriftX[4])-19.36491673103709*BdriftX[0])*Bmag[4]-8.660254037844386*BdriftX[1]*Bmag[1])*dfac_x*wm+(((-7.745966692414834*(BdriftY[1]*Phi[6]+Phi[3]*BdriftY[4]))-8.660254037844386*(BdriftY[0]*Phi[3]+BdriftY[1]*Phi[2]))*dfac_y+(((-17.32050807568877*BdriftX[4])-19.36491673103709*BdriftX[0])*Phi[4]-8.660254037844386*BdriftX[1]*Phi[1])*dfac_x)*q_))/(dfac_v*q_); 
  alpha[2] = -(0.408248290463863*(dfac_v*((6.708203932499369*BdriftY[1]*Phi[7]+6.708203932499369*BdriftY[0]*Phi[5])*dfac_y+(6.708203932499369*BdriftX[1]*Phi[6]+3.0*BdriftX[0]*Phi[3])*dfac_x)*wv+((-6.708203932499369*BdriftY[1]*Phi[7])-6.708203932499369*BdriftY[0]*Phi[5])*dfac_y+((-6.708203932499369*BdriftX[1]*Phi[6])-3.0*BdriftX[0]*Phi[3])*dfac_x))/dfac_v; 
  alpha[3] = -(0.7071067811865475*dfac_x*((2.23606797749979*BdriftX[1]*Bmag[4]+BdriftX[0]*Bmag[1])*dfac_v*wv-2.23606797749979*BdriftX[1]*Bmag[4]-1.0*BdriftX[0]*Bmag[1]))/(dfac_m*dfac_v*q_); 
  alpha[4] = -(0.1414213562373095*(dfac_v*(((17.32050807568877*BdriftY[4]+19.36491673103708*BdriftY[0])*Phi[7]+19.36491673103709*BdriftY[1]*Phi[5])*dfac_y+((17.32050807568877*BdriftX[4]+19.36491673103708*BdriftX[0])*Phi[6]+8.660254037844386*BdriftX[1]*Phi[3])*dfac_x)*wv+(((-17.32050807568877*BdriftY[4])-19.36491673103708*BdriftY[0])*Phi[7]-19.36491673103709*BdriftY[1]*Phi[5])*dfac_y+(((-17.32050807568877*BdriftX[4])-19.36491673103708*BdriftX[0])*Phi[6]-8.660254037844386*BdriftX[1]*Phi[3])*dfac_x))/dfac_v; 
  alpha[5] = -(0.7071067811865475*dfac_x*(((2.0*BdriftX[4]+2.23606797749979*BdriftX[0])*Bmag[4]+BdriftX[1]*Bmag[1])*dfac_v*wv+((-2.0*BdriftX[4])-2.23606797749979*BdriftX[0])*Bmag[4]-1.0*BdriftX[1]*Bmag[1]))/(dfac_m*dfac_v*q_); 
  alpha[7] = -(0.02020305089104421*(dfac_v*((121.2435565298214*BdriftX[1]*Bmag[4]+60.6217782649107*Bmag[1]*BdriftX[4])*dfac_x*wm+(((38.72983346207417*BdriftY[4]+60.62177826491071*BdriftY[0])*Phi[6]+60.6217782649107*Phi[2]*BdriftY[4]+54.22176684690384*BdriftY[1]*Phi[3])*dfac_y+(121.2435565298214*BdriftX[1]*Phi[4]+60.6217782649107*Phi[1]*BdriftX[4])*dfac_x)*q_)*wv+((-121.2435565298214*BdriftX[1]*Bmag[4])-60.6217782649107*Bmag[1]*BdriftX[4])*dfac_x*wm+((((-38.72983346207417*BdriftY[4])-60.62177826491071*BdriftY[0])*Phi[6]-60.6217782649107*Phi[2]*BdriftY[4]-54.22176684690384*BdriftY[1]*Phi[3])*dfac_y+((-121.2435565298214*BdriftX[1]*Phi[4])-60.6217782649107*Phi[1]*BdriftX[4])*dfac_x)*q_))/(dfac_v*q_); 
  alpha[8] = -(0.1414213562373095*BdriftX[0]*Phi[7]*dfac_x*(8.660254037844387*dfac_v*wv-8.660254037844387))/dfac_v; 
  alpha[11] = -(0.1825741858350553*(dfac_v*((13.41640786499874*BdriftY[1]*Phi[7]+15.0*BdriftY[4]*Phi[5])*dfac_y+(13.41640786499874*BdriftX[1]*Phi[6]+6.708203932499369*Phi[3]*BdriftX[4])*dfac_x)*wv+((-13.41640786499874*BdriftY[1]*Phi[7])-15.0*BdriftY[4]*Phi[5])*dfac_y+((-13.41640786499874*BdriftX[1]*Phi[6])-6.708203932499369*Phi[3]*BdriftX[4])*dfac_x))/dfac_v; 
  alpha[12] = -(0.7071067811865475*BdriftX[1]*Phi[7]*dfac_x*(1.732050807568877*dfac_v*wv-1.732050807568877))/dfac_v; 
  alpha[13] = -(0.04714045207910316*dfac_x*((30.0*BdriftX[1]*Bmag[4]+15.0*Bmag[1]*BdriftX[4])*dfac_v*wv-30.0*BdriftX[1]*Bmag[4]-15.0*Bmag[1]*BdriftX[4]))/(dfac_m*dfac_v*q_); 
  double amax = 0.0; 
  bool upwind = false; 
  if(upwind) 
    amax = std::abs(alpha0); 
  else 
    amax = amax_in; 

  double Ghat[20]; 
  double favg[20]; 
  favg[0] = 0.7071067811865475*(2.23606797749979*(fr[13]+fl[13])+1.732050807568877*(fl[3]-1.0*fr[3])+fr[0]+fl[0]); 
  favg[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[23]+fl[23])+3.0*(fl[6]-1.0*fr[6]))+3.0*(fr[1]+fl[1])); 
  favg[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[24]+fl[24])+3.0*(fl[7]-1.0*fr[7]))+3.0*(fr[2]+fl[2])); 
  favg[3] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[27]+fl[27])+3.0*(fl[10]-1.0*fr[10]))+3.0*(fr[4]+fl[4])); 
  favg[4] = 0.7071067811865475*(2.23606797749979*(fr[34]+fl[34])+1.732050807568877*(fl[15]-1.0*fr[15])+fr[5]+fl[5]); 
  favg[5] = 0.7071067811865475*(2.23606797749979*(fr[39]+fl[39])+1.732050807568877*(fl[17]-1.0*fr[17])+fr[8]+fl[8]); 
  favg[6] = 0.7071067811865475*(2.23606797749979*(fr[40]+fl[40])+1.732050807568877*(fl[18]-1.0*fr[18])+fr[9]+fl[9]); 
  favg[7] = -0.1414213562373095*(8.660254037844387*fr[21]-1.0*(8.660254037844387*fl[21]+5.0*(fr[11]+fl[11]))); 
  favg[8] = -0.1414213562373095*(8.660254037844387*fr[22]-1.0*(8.660254037844387*fl[22]+5.0*(fr[12]+fl[12]))); 
  favg[9] = -0.1414213562373095*(8.660254037844387*fr[30]-1.0*(8.660254037844387*fl[30]+5.0*(fr[14]+fl[14]))); 
  favg[10] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*(fr[46]+fl[46])+3.0*(fl[31]-1.0*fr[31]))+3.0*(fr[16]+fl[16])); 
  favg[11] = -0.1414213562373095*(8.660254037844387*fr[32]-1.0*(8.660254037844387*fl[32]+5.0*(fr[19]+fl[19]))); 
  favg[12] = -0.1414213562373095*(8.660254037844387*fr[33]-1.0*(8.660254037844387*fl[33]+5.0*(fr[20]+fl[20]))); 
  favg[13] = -0.1414213562373095*(8.660254037844387*fr[37]-1.0*(8.660254037844387*fl[37]+5.0*(fr[25]+fl[25]))); 
  favg[14] = -0.1414213562373095*(8.660254037844387*fr[38]-1.0*(8.660254037844387*fl[38]+5.0*(fr[26]+fl[26]))); 
  favg[15] = -0.1414213562373095*(8.660254037844387*fr[42]-1.0*(8.660254037844387*fl[42]+5.0*(fr[28]+fl[28]))); 
  favg[16] = -0.1414213562373095*(8.660254037844387*fr[43]-1.0*(8.660254037844387*fl[43]+5.0*(fr[29]+fl[29]))); 
  favg[17] = -0.1414213562373095*(8.660254037844387*fr[44]-1.0*(8.660254037844387*fl[44]+5.0*(fr[35]+fl[35]))); 
  favg[18] = -0.1414213562373095*(8.660254037844387*fr[45]-1.0*(8.660254037844387*fl[45]+5.0*(fr[36]+fl[36]))); 
  favg[19] = -0.1414213562373095*(8.660254037844387*fr[47]-1.0*(8.660254037844387*fl[47]+5.0*(fr[41]+fl[41]))); 

  Ghat[0] = -0.125*((6.324555320336761*fr[13]-6.324555320336761*fl[13]-4.898979485566357*(fr[3]+fl[3])+2.828427124746191*fr[0]-2.828427124746191*fl[0])*amax-1.414213562373095*(alpha[13]*favg[13]+alpha[12]*favg[12]+alpha[11]*favg[11]+alpha[8]*favg[8]+alpha[7]*favg[7]+alpha[5]*favg[5]+alpha[4]*favg[4]+alpha[3]*favg[3]+alpha[2]*favg[2]+alpha[1]*favg[1]+alpha[0]*favg[0])); 
  Ghat[1] = -0.008333333333333333*((94.8683298050514*fr[23]-94.8683298050514*fl[23]-73.48469228349535*(fr[6]+fl[6])+42.42640687119286*fr[1]-42.42640687119286*fl[1])*amax-18.97366596101028*(alpha[5]*favg[13]+favg[5]*alpha[13])-21.21320343559643*(alpha[8]*favg[12]+favg[8]*alpha[12])-18.97366596101028*(alpha[4]*favg[11]+favg[4]*alpha[11]+alpha[1]*favg[7]+favg[1]*alpha[7])-21.21320343559643*(alpha[3]*favg[5]+favg[3]*alpha[5]+alpha[2]*favg[4]+favg[2]*alpha[4]+alpha[0]*favg[1]+favg[0]*alpha[1])); 
  Ghat[2] = -0.008333333333333333*((94.8683298050514*fr[24]-94.8683298050514*fl[24]-73.48469228349535*(fr[7]+fl[7])+42.42640687119286*fr[2]-42.42640687119286*fl[2])*amax-21.21320343559643*alpha[13]*favg[17]-18.97366596101028*(alpha[4]*favg[12]+favg[4]*alpha[12])-21.21320343559643*(alpha[7]*favg[11]+favg[7]*alpha[11])-21.21320343559643*alpha[5]*favg[10]-18.97366596101028*(alpha[2]*favg[8]+favg[2]*alpha[8])-21.21320343559643*(alpha[3]*favg[6]+alpha[1]*favg[4]+favg[1]*alpha[4]+alpha[0]*favg[2]+favg[0]*alpha[2])); 
  Ghat[3] = -0.008333333333333333*((94.8683298050514*fr[27]-94.8683298050514*fl[27]-73.48469228349535*(fr[10]+fl[10])+42.42640687119286*fr[4]-42.42640687119286*fl[4])*amax-21.21320343559643*(alpha[12]*favg[18]+alpha[11]*favg[17])-18.97366596101028*alpha[5]*favg[15]-21.21320343559643*(alpha[8]*favg[14]+alpha[7]*favg[13]+favg[7]*alpha[13])-21.21320343559643*alpha[4]*favg[10]-18.97366596101028*alpha[3]*favg[9]-21.21320343559643*(alpha[2]*favg[6]+alpha[1]*favg[5]+favg[1]*alpha[5]+alpha[0]*favg[3]+favg[0]*alpha[3])); 
  Ghat[4] = -0.008333333333333333*((94.86832980505142*fr[34]-94.86832980505142*fl[34]-73.48469228349535*(fr[15]+fl[15])+42.42640687119286*fr[5]-42.42640687119286*fl[5])*amax-18.97366596101028*(alpha[5]*favg[17]+favg[10]*alpha[13])+((-16.97056274847715*alpha[11])-18.97366596101028*alpha[2])*favg[12]+((-16.97056274847715*favg[11])-18.97366596101028*favg[2])*alpha[12]-18.97366596101028*(alpha[1]*favg[11]+favg[1]*alpha[11])-21.21320343559643*alpha[3]*favg[10]-18.97366596101028*(alpha[4]*favg[8]+favg[4]*alpha[8]+alpha[4]*favg[7]+favg[4]*alpha[7])-21.21320343559643*(alpha[5]*favg[6]+alpha[0]*favg[4]+favg[0]*alpha[4]+alpha[1]*favg[2]+favg[1]*alpha[2])); 
  Ghat[5] = -0.008333333333333333*((94.86832980505142*fr[39]-94.86832980505142*fl[39]-73.48469228349535*(fr[17]+fl[17])+42.42640687119286*fr[8]-42.42640687119286*fl[8])*amax-21.21320343559643*alpha[8]*favg[18]-18.97366596101028*alpha[4]*favg[17]+((-16.97056274847715*alpha[13])-18.97366596101028*alpha[3])*favg[15]-21.21320343559643*alpha[12]*favg[14]-18.97366596101028*(alpha[1]*favg[13]+favg[1]*alpha[13])+favg[10]*((-18.97366596101028*alpha[11])-21.21320343559643*alpha[2])-18.97366596101028*(alpha[5]*(favg[9]+favg[7])+favg[5]*alpha[7])-21.21320343559643*(alpha[4]*favg[6]+alpha[0]*favg[5]+favg[0]*alpha[5]+alpha[1]*favg[3]+favg[1]*alpha[3])); 
  Ghat[6] = -0.008333333333333333*((94.86832980505142*fr[40]-94.86832980505142*fl[40]-73.48469228349535*(fr[18]+fl[18])+42.42640687119286*fr[9]-42.42640687119286*fl[9])*amax-18.97366596101028*(alpha[5]*favg[19]+alpha[4]*favg[18])-21.21320343559643*alpha[7]*favg[17]-18.97366596101028*(alpha[3]*favg[16]+alpha[2]*favg[14])-21.21320343559643*(alpha[11]*favg[13]+favg[11]*alpha[13])+favg[10]*((-18.97366596101028*alpha[12])-21.21320343559643*alpha[1])-18.97366596101028*favg[6]*alpha[8]-21.21320343559643*(alpha[0]*favg[6]+alpha[4]*favg[5]+favg[4]*alpha[5]+alpha[2]*favg[3]+favg[2]*alpha[3])); 
  Ghat[7] = 0.001190476190476191*((514.3928459844675*(fr[21]+fl[21])-296.98484809835*fr[11]+296.98484809835*fl[11])*amax+(94.86832980505142*alpha[13]+148.492424049175*alpha[3])*favg[13]+148.492424049175*favg[3]*alpha[13]+132.815661727072*alpha[12]*favg[12]+(94.86832980505142*alpha[11]+148.492424049175*alpha[2])*favg[11]+148.492424049175*favg[2]*alpha[11]+(94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[7]+148.492424049175*favg[0]*alpha[7]+132.815661727072*(alpha[5]*favg[5]+alpha[4]*favg[4]+alpha[1]*favg[1])); 
  Ghat[8] = 0.001190476190476191*((514.3928459844675*(fr[22]+fl[22])-296.98484809835*fr[12]+296.98484809835*fl[12])*amax+148.492424049175*(alpha[5]*favg[18]+alpha[3]*favg[14])+(94.86832980505142*alpha[12]+148.492424049175*alpha[1])*favg[12]+148.492424049175*favg[1]*alpha[12]+132.815661727072*alpha[11]*favg[11]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[8]+148.492424049175*favg[0]*alpha[8]+132.815661727072*(alpha[4]*favg[4]+alpha[2]*favg[2])); 
  Ghat[9] = 0.00116461873828114*((525.8136552049599*(fr[30]+fl[30])-303.5786553761646*fr[14]+303.5786553761646*fl[14])*amax+151.7893276880823*(alpha[4]*favg[19]+alpha[2]*favg[16])+(82.15838362577493*alpha[5]+151.7893276880823*alpha[1])*favg[15]+135.7645019878172*alpha[13]*favg[13]+151.7893276880823*alpha[0]*favg[9]+135.7645019878172*(alpha[5]*favg[5]+alpha[3]*favg[3])); 
  Ghat[10] = -0.002886751345948129*((273.8612787525831*fr[46]-273.8612787525831*fl[46]-212.1320343559643*(fr[31]+fl[31])+122.4744871391589*fr[16]-122.4744871391589*fl[16])*amax+((-48.98979485566359*alpha[13])-54.77225575051663*alpha[3])*favg[19]+((-48.98979485566359*alpha[11])-54.77225575051663*alpha[2])*favg[18]+((-48.98979485566359*alpha[12])-54.77225575051663*alpha[1])*favg[17]-54.77225575051663*(alpha[5]*favg[16]+alpha[4]*(favg[14]+favg[13])+favg[4]*alpha[13]+favg[6]*alpha[12]+alpha[5]*favg[11]+favg[5]*alpha[11])+((-54.77225575051663*(alpha[8]+alpha[7]))-61.23724356957945*alpha[0])*favg[10]-61.23724356957945*(alpha[1]*favg[6]+alpha[2]*favg[5]+favg[2]*alpha[5]+alpha[3]*favg[4]+favg[3]*alpha[4])); 
  Ghat[11] = 0.001190476190476191*((514.3928459844675*(fr[32]+fl[32])-296.98484809835*fr[19]+296.98484809835*fl[19])*amax+(94.86832980505142*alpha[13]+148.492424049175*alpha[3])*favg[17]+148.492424049175*favg[6]*alpha[13]+118.79393923934*(alpha[4]*favg[12]+favg[4]*alpha[12])+(132.815661727072*alpha[8]+94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[11]+(132.815661727072*favg[8]+94.86832980505142*favg[7]+148.492424049175*favg[0])*alpha[11]+132.815661727072*alpha[5]*favg[10]+148.492424049175*(alpha[2]*favg[7]+favg[2]*alpha[7])+132.815661727072*(alpha[1]*favg[4]+favg[1]*alpha[4])); 
  Ghat[12] = 9.221388919541468e-4*((664.0783086353599*(fr[33]+fl[33])-383.4057902536164*fr[20]+383.4057902536164*fl[20])*amax+(171.4642819948225*alpha[13]+191.7028951268082*alpha[3])*favg[18]+191.7028951268082*alpha[5]*favg[14]+(122.474487139159*alpha[8]+171.4642819948225*alpha[7]+191.7028951268082*alpha[0])*favg[12]+(122.474487139159*favg[8]+171.4642819948225*favg[7]+191.7028951268082*favg[0])*alpha[12]+153.3623161014466*(alpha[4]*favg[11]+favg[4]*alpha[11])+191.7028951268082*(alpha[1]*favg[8]+favg[1]*alpha[8])+171.4642819948225*(alpha[2]*favg[4]+favg[2]*alpha[4])); 
  Ghat[13] = 0.001190476190476191*((514.3928459844675*(fr[37]+fl[37])-296.98484809835*fr[25]+296.98484809835*fl[25])*amax+132.815661727072*alpha[12]*favg[18]+(94.86832980505142*alpha[11]+148.492424049175*alpha[2])*favg[17]+118.79393923934*alpha[5]*favg[15]+(94.86832980505142*alpha[7]+148.492424049175*alpha[0])*favg[13]+(132.815661727072*favg[9]+94.86832980505142*favg[7]+148.492424049175*favg[0])*alpha[13]+148.492424049175*favg[6]*alpha[11]+132.815661727072*alpha[4]*favg[10]+148.492424049175*(alpha[3]*favg[7]+favg[3]*alpha[7])+132.815661727072*(alpha[1]*favg[5]+favg[1]*alpha[5])); 
  Ghat[14] = 0.001190476190476191*((514.3928459844675*(fr[38]+fl[38])-296.98484809835*fr[26]+296.98484809835*fl[26])*amax+(94.86832980505142*alpha[12]+148.492424049175*alpha[1])*favg[18]+132.815661727072*alpha[11]*favg[17]+(94.86832980505142*alpha[8]+148.492424049175*alpha[0])*favg[14]+148.492424049175*(alpha[5]*favg[12]+favg[5]*alpha[12])+132.815661727072*alpha[4]*favg[10]+148.492424049175*(alpha[3]*favg[8]+favg[3]*alpha[8])+132.815661727072*alpha[2]*favg[6]); 
  Ghat[15] = 0.006454972243679028*((94.86832980505142*(fr[42]+fl[42])-54.77225575051663*fr[28]+54.77225575051663*fl[28])*amax+(24.49489742783179*alpha[11]+27.38612787525831*alpha[2])*favg[19]+27.38612787525831*alpha[4]*favg[16]+(24.49489742783179*alpha[7]+27.38612787525831*alpha[0])*favg[15]+21.90890230020666*(alpha[5]*favg[13]+favg[5]*alpha[13])+27.38612787525831*alpha[1]*favg[9]+24.49489742783179*(alpha[3]*favg[5]+favg[3]*alpha[5])); 
  Ghat[16] = 0.006454972243679028*((94.86832980505142*(fr[43]+fl[43])-54.77225575051663*fr[29]+54.77225575051663*fl[29])*amax+(24.49489742783179*alpha[12]+27.38612787525831*alpha[1])*favg[19]+24.49489742783179*alpha[13]*favg[17]+(24.49489742783179*alpha[8]+27.38612787525831*alpha[0])*favg[16]+27.38612787525831*alpha[4]*favg[15]+24.49489742783179*alpha[5]*favg[10]+27.38612787525831*alpha[2]*favg[9]+24.49489742783179*alpha[3]*favg[6]); 
  Ghat[17] = 2.380952380952381e-4*((2571.964229922338*(fr[44]+fl[44])-1484.92424049175*fr[35]+1484.92424049175*fl[35])*amax+593.9696961967002*(alpha[5]*favg[19]+alpha[4]*favg[18])+(664.0783086353599*alpha[8]+474.3416490252571*alpha[7]+742.462120245875*alpha[0])*favg[17]+664.0783086353599*(alpha[13]*favg[16]+alpha[11]*favg[14])+(474.3416490252571*alpha[11]+742.462120245875*alpha[2])*favg[13]+(474.3416490252571*favg[11]+742.462120245875*favg[2])*alpha[13]+593.9696961967002*favg[10]*alpha[12]+742.462120245875*(alpha[3]*favg[11]+favg[3]*alpha[11])+664.0783086353599*alpha[1]*favg[10]+742.462120245875*favg[6]*alpha[7]+664.0783086353599*(alpha[4]*favg[5]+favg[4]*alpha[5])); 
  Ghat[18] = 2.380952380952381e-4*((2571.964229922338*(fr[45]+fl[45])-1484.92424049175*fr[36]+1484.92424049175*fl[36])*amax+(474.3416490252571*alpha[8]+664.0783086353599*alpha[7]+742.462120245875*alpha[0])*favg[18]+593.9696961967002*alpha[4]*favg[17]+(474.3416490252571*alpha[12]+742.462120245875*alpha[1])*favg[14]+664.0783086353599*(alpha[12]*favg[13]+favg[12]*alpha[13])+742.462120245875*(alpha[3]*favg[12]+favg[3]*alpha[12])+favg[10]*(593.9696961967002*alpha[11]+664.0783086353599*alpha[2])+742.462120245875*(alpha[5]*favg[8]+favg[5]*alpha[8])+664.0783086353599*alpha[4]*favg[6]); 
  Ghat[19] = 0.001666666666666667*((367.4234614174769*(fr[47]+fl[47])-212.1320343559643*fr[41]+212.1320343559643*fl[41])*amax+(94.86832980505142*(alpha[8]+alpha[7])+106.0660171779821*alpha[0])*favg[19]+84.85281374238573*alpha[5]*favg[17]+(94.86832980505142*alpha[12]+106.0660171779822*alpha[1])*favg[16]+(94.86832980505142*alpha[11]+106.0660171779822*alpha[2])*favg[15]+favg[10]*(84.85281374238573*alpha[13]+94.86832980505142*alpha[3])+106.0660171779821*alpha[4]*favg[9]+94.86832980505142*alpha[5]*favg[6]); 
  incr[0] = 0.7071067811865475*Ghat[0]*dfac_v; 
  incr[1] = 0.7071067811865475*Ghat[1]*dfac_v; 
  incr[2] = 0.7071067811865475*Ghat[2]*dfac_v; 
  incr[3] = -1.224744871391589*Ghat[0]*dfac_v; 
  incr[4] = 0.7071067811865475*Ghat[3]*dfac_v; 
  incr[5] = 0.7071067811865475*Ghat[4]*dfac_v; 
  incr[6] = -1.224744871391589*Ghat[1]*dfac_v; 
  incr[7] = -1.224744871391589*Ghat[2]*dfac_v; 
  incr[8] = 0.7071067811865475*Ghat[5]*dfac_v; 
  incr[9] = 0.7071067811865475*Ghat[6]*dfac_v; 
  incr[10] = -1.224744871391589*Ghat[3]*dfac_v; 
  incr[11] = 0.7071067811865475*Ghat[7]*dfac_v; 
  incr[12] = 0.7071067811865475*Ghat[8]*dfac_v; 
  incr[13] = 1.58113883008419*Ghat[0]*dfac_v; 
  incr[14] = 0.7071067811865475*Ghat[9]*dfac_v; 
  incr[15] = -1.224744871391589*Ghat[4]*dfac_v; 
  incr[16] = 0.7071067811865475*Ghat[10]*dfac_v; 
  incr[17] = -1.224744871391589*Ghat[5]*dfac_v; 
  incr[18] = -1.224744871391589*Ghat[6]*dfac_v; 
  incr[19] = 0.7071067811865475*Ghat[11]*dfac_v; 
  incr[20] = 0.7071067811865475*Ghat[12]*dfac_v; 
  incr[21] = -1.224744871391589*Ghat[7]*dfac_v; 
  incr[22] = -1.224744871391589*Ghat[8]*dfac_v; 
  incr[23] = 1.58113883008419*Ghat[1]*dfac_v; 
  incr[24] = 1.58113883008419*Ghat[2]*dfac_v; 
  incr[25] = 0.7071067811865475*Ghat[13]*dfac_v; 
  incr[26] = 0.7071067811865475*Ghat[14]*dfac_v; 
  incr[27] = 1.58113883008419*Ghat[3]*dfac_v; 
  incr[28] = 0.7071067811865475*Ghat[15]*dfac_v; 
  incr[29] = 0.7071067811865475*Ghat[16]*dfac_v; 
  incr[30] = -1.224744871391589*Ghat[9]*dfac_v; 
  incr[31] = -1.224744871391589*Ghat[10]*dfac_v; 
  incr[32] = -1.224744871391589*Ghat[11]*dfac_v; 
  incr[33] = -1.224744871391589*Ghat[12]*dfac_v; 
  incr[34] = 1.58113883008419*Ghat[4]*dfac_v; 
  incr[35] = 0.7071067811865475*Ghat[17]*dfac_v; 
  incr[36] = 0.7071067811865475*Ghat[18]*dfac_v; 
  incr[37] = -1.224744871391589*Ghat[13]*dfac_v; 
  incr[38] = -1.224744871391589*Ghat[14]*dfac_v; 
  incr[39] = 1.58113883008419*Ghat[5]*dfac_v; 
  incr[40] = 1.58113883008419*Ghat[6]*dfac_v; 
  incr[41] = 0.7071067811865475*Ghat[19]*dfac_v; 
  incr[42] = -1.224744871391589*Ghat[15]*dfac_v; 
  incr[43] = -1.224744871391589*Ghat[16]*dfac_v; 
  incr[44] = -1.224744871391589*Ghat[17]*dfac_v; 
  incr[45] = -1.224744871391589*Ghat[18]*dfac_v; 
  incr[46] = 1.58113883008419*Ghat[10]*dfac_v; 
  incr[47] = -1.224744871391589*Ghat[19]*dfac_v; 

  outr[0] += incr[0]; 
  outr[1] += incr[1]; 
  outr[2] += incr[2]; 
  outr[3] += incr[3]; 
  outr[4] += incr[4]; 
  outr[5] += incr[5]; 
  outr[6] += incr[6]; 
  outr[7] += incr[7]; 
  outr[8] += incr[8]; 
  outr[9] += incr[9]; 
  outr[10] += incr[10]; 
  outr[11] += incr[11]; 
  outr[12] += incr[12]; 
  outr[13] += incr[13]; 
  outr[14] += incr[14]; 
  outr[15] += incr[15]; 
  outr[16] += incr[16]; 
  outr[17] += incr[17]; 
  outr[18] += incr[18]; 
  outr[19] += incr[19]; 
  outr[20] += incr[20]; 
  outr[21] += incr[21]; 
  outr[22] += incr[22]; 
  outr[23] += incr[23]; 
  outr[24] += incr[24]; 
  outr[25] += incr[25]; 
  outr[26] += incr[26]; 
  outr[27] += incr[27]; 
  outr[28] += incr[28]; 
  outr[29] += incr[29]; 
  outr[30] += incr[30]; 
  outr[31] += incr[31]; 
  outr[32] += incr[32]; 
  outr[33] += incr[33]; 
  outr[34] += incr[34]; 
  outr[35] += incr[35]; 
  outr[36] += incr[36]; 
  outr[37] += incr[37]; 
  outr[38] += incr[38]; 
  outr[39] += incr[39]; 
  outr[40] += incr[40]; 
  outr[41] += incr[41]; 
  outr[42] += incr[42]; 
  outr[43] += incr[43]; 
  outr[44] += incr[44]; 
  outr[45] += incr[45]; 
  outr[46] += incr[46]; 
  outr[47] += incr[47]; 

  outl[0] += -1.0*incr[0]; 
  outl[1] += -1.0*incr[1]; 
  outl[2] += -1.0*incr[2]; 
  outl[3] += incr[3]; 
  outl[4] += -1.0*incr[4]; 
  outl[5] += -1.0*incr[5]; 
  outl[6] += incr[6]; 
  outl[7] += incr[7]; 
  outl[8] += -1.0*incr[8]; 
  outl[9] += -1.0*incr[9]; 
  outl[10] += incr[10]; 
  outl[11] += -1.0*incr[11]; 
  outl[12] += -1.0*incr[12]; 
  outl[13] += -1.0*incr[13]; 
  outl[14] += -1.0*incr[14]; 
  outl[15] += incr[15]; 
  outl[16] += -1.0*incr[16]; 
  outl[17] += incr[17]; 
  outl[18] += incr[18]; 
  outl[19] += -1.0*incr[19]; 
  outl[20] += -1.0*incr[20]; 
  outl[21] += incr[21]; 
  outl[22] += incr[22]; 
  outl[23] += -1.0*incr[23]; 
  outl[24] += -1.0*incr[24]; 
  outl[25] += -1.0*incr[25]; 
  outl[26] += -1.0*incr[26]; 
  outl[27] += -1.0*incr[27]; 
  outl[28] += -1.0*incr[28]; 
  outl[29] += -1.0*incr[29]; 
  outl[30] += incr[30]; 
  outl[31] += incr[31]; 
  outl[32] += incr[32]; 
  outl[33] += incr[33]; 
  outl[34] += -1.0*incr[34]; 
  outl[35] += -1.0*incr[35]; 
  outl[36] += -1.0*incr[36]; 
  outl[37] += incr[37]; 
  outl[38] += incr[38]; 
  outl[39] += -1.0*incr[39]; 
  outl[40] += -1.0*incr[40]; 
  outl[41] += -1.0*incr[41]; 
  outl[42] += incr[42]; 
  outl[43] += incr[43]; 
  outl[44] += incr[44]; 
  outl[45] += incr[45]; 
  outl[46] += -1.0*incr[46]; 
  outl[47] += incr[47]; 
return std::abs(alpha0); 
} 
