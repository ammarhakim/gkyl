#include <PositivityVolLimiterImpl.h> 
double findAlpha(const double *fVol, const double *fHat, int ndim) { 
  double alpha = 1.0; 
  if (ndim == 1) { 
    double fVolVal[2]; // fVal = array of vales of fIn evaluated at each node 
    fVolVal[0] = 0.7071067811865475*(fVol[0]-0.5773502691896258*fVol[1]); 
    fVolVal[1] = 0.7071067811865475*(0.5773502691896258*fVol[1]+fVol[0]); 

    double fHatVal[2]; // fVal = array of vales of fIn evaluated at each node 
    fHatVal[0] = 0.7071067811865475*(fHat[0]-0.5773502691896258*fHat[1]); 
    fHatVal[1] = 0.7071067811865475*(0.5773502691896258*fHat[1]+fHat[0]); 

    for(int i=0; i<2; i++) {
      double ratio = fHatVal[i]/(-fVolVal[i] + EPSILON);
      if(ratio>=0.0) alpha = std::min(alpha, ratio);
    }
  } 
  else if(ndim == 2) { 
    double fVolVal[4]; // fVolVal = array of vales of fVol evaluated at each node 
    fVolVal[0] = 0.1666666666666667*fVol[3]-0.2886751345948129*(fVol[2]+fVol[1])+0.5*fVol[0]; 
    fVolVal[1] = (-0.1666666666666667*fVol[3])-0.2886751345948129*fVol[2]+0.5*(0.5773502691896258*fVol[1]+fVol[0]); 
    fVolVal[2] = (-0.1666666666666667*fVol[3])+0.5773502691896258*(0.5*fVol[2]-0.5*fVol[1])+0.5*fVol[0]; 
    fVolVal[3] = 0.1666666666666667*fVol[3]+0.5*(0.5773502691896258*(fVol[2]+fVol[1])+fVol[0]); 

    double fHatVal[4]; // fHatVal = array of vales of fHat evaluated at each node 
    fHatVal[0] = 0.1666666666666667*fHat[3]-0.2886751345948129*(fHat[2]+fHat[1])+0.5*fHat[0]; 
    fHatVal[1] = (-0.1666666666666667*fHat[3])-0.2886751345948129*fHat[2]+0.5*(0.5773502691896258*fHat[1]+fHat[0]); 
    fHatVal[2] = (-0.1666666666666667*fHat[3])+0.5773502691896258*(0.5*fHat[2]-0.5*fHat[1])+0.5*fHat[0]; 
    fHatVal[3] = 0.1666666666666667*fHat[3]+0.5*(0.5773502691896258*(fHat[2]+fHat[1])+fHat[0]); 

    for(int i=0; i<4; i++) {
      if(fHatVal[i] + fVolVal[i]<0.) {
        double ratio = fHatVal[i]/(-fVolVal[i] + EPSILON);
        if(ratio>=-.5) alpha = std::min(alpha, ratio);
      }
    }
    for(int i=0; i<4; i++) {
      if(fHatVal[i] + alpha*fVolVal[i]<-EPSILON) {
        printf("not working..., fhatVal = %f, fVolVal = %f, alpha = %f, fNew = %f\n", fHatVal[i], fVolVal[i], alpha, fHatVal[i]+alpha*fVolVal[i]);
      }
    }
  } 
  else if(ndim == 3) { 
    double fVolVal[8]; // fVolVal = array of vales of fVol evaluated at each node 
    fVolVal[0] = -0.3535533905932737*(0.1924500897298753*fVol[7]-0.3333333333333333*fVol[6]-0.3333333333333333*(fVol[5]+fVol[4])+0.5773502691896258*(fVol[3]+fVol[2]+fVol[1])-1.0*fVol[0]); 
    fVolVal[1] = 0.3535533905932737*(0.1924500897298753*fVol[7]+0.3333333333333333*fVol[6]-0.3333333333333333*(fVol[5]+fVol[4])+0.5773502691896258*(fVol[1]-1.0*(fVol[3]+fVol[2]))+fVol[0]); 
    fVolVal[2] = 0.3535533905932737*(0.1924500897298753*fVol[7]-0.3333333333333333*fVol[6]+0.3333333333333333*fVol[5]-0.3333333333333333*fVol[4]+0.5773502691896258*((-1.0*fVol[3])+fVol[2]-1.0*fVol[1])+fVol[0]); 
    fVolVal[3] = -0.3535533905932737*(0.1924500897298753*fVol[7]-1.0*((-0.3333333333333333*fVol[6])-1.0*(0.3333333333333333*fVol[5]-0.3333333333333333*fVol[4]))+0.5773502691896258*fVol[3]-1.0*(0.5773502691896258*(fVol[2]+fVol[1])+fVol[0])); 
    fVolVal[4] = 0.3535533905932737*(0.1924500897298753*fVol[7]-0.3333333333333333*(fVol[6]+fVol[5])+0.3333333333333333*fVol[4]+0.5773502691896258*(fVol[3]-1.0*(fVol[2]+fVol[1]))+fVol[0]); 
    fVolVal[5] = -0.3535533905932737*(0.1924500897298753*fVol[7]-1.0*((-0.3333333333333333*fVol[6])-1.0*(0.3333333333333333*fVol[4]-0.3333333333333333*fVol[5]))+0.5773502691896258*(fVol[2]-1.0*fVol[3])-1.0*(0.5773502691896258*fVol[1]+fVol[0])); 
    fVolVal[6] = -0.3535533905932737*(0.1924500897298753*fVol[7]+0.3333333333333333*((-1.0*fVol[6])+fVol[5]+fVol[4])+0.5773502691896258*(fVol[1]-1.0*(fVol[3]+fVol[2]))-1.0*fVol[0]); 
    fVolVal[7] = 0.3535533905932737*(0.1924500897298753*fVol[7]+0.3333333333333333*(fVol[6]+fVol[5]+fVol[4])+0.5773502691896258*(fVol[3]+fVol[2]+fVol[1])+fVol[0]); 

    double fHatVal[8]; // fHatVal = array of vales of fHat evaluated at each node 
    fHatVal[0] = -0.3535533905932737*(0.1924500897298753*fHat[7]-0.3333333333333333*fHat[6]-0.3333333333333333*(fHat[5]+fHat[4])+0.5773502691896258*(fHat[3]+fHat[2]+fHat[1])-1.0*fHat[0]); 
    fHatVal[1] = 0.3535533905932737*(0.1924500897298753*fHat[7]+0.3333333333333333*fHat[6]-0.3333333333333333*(fHat[5]+fHat[4])+0.5773502691896258*(fHat[1]-1.0*(fHat[3]+fHat[2]))+fHat[0]); 
    fHatVal[2] = 0.3535533905932737*(0.1924500897298753*fHat[7]-0.3333333333333333*fHat[6]+0.3333333333333333*fHat[5]-0.3333333333333333*fHat[4]+0.5773502691896258*((-1.0*fHat[3])+fHat[2]-1.0*fHat[1])+fHat[0]); 
    fHatVal[3] = -0.3535533905932737*(0.1924500897298753*fHat[7]-1.0*((-0.3333333333333333*fHat[6])-1.0*(0.3333333333333333*fHat[5]-0.3333333333333333*fHat[4]))+0.5773502691896258*fHat[3]-1.0*(0.5773502691896258*(fHat[2]+fHat[1])+fHat[0])); 
    fHatVal[4] = 0.3535533905932737*(0.1924500897298753*fHat[7]-0.3333333333333333*(fHat[6]+fHat[5])+0.3333333333333333*fHat[4]+0.5773502691896258*(fHat[3]-1.0*(fHat[2]+fHat[1]))+fHat[0]); 
    fHatVal[5] = -0.3535533905932737*(0.1924500897298753*fHat[7]-1.0*((-0.3333333333333333*fHat[6])-1.0*(0.3333333333333333*fHat[4]-0.3333333333333333*fHat[5]))+0.5773502691896258*(fHat[2]-1.0*fHat[3])-1.0*(0.5773502691896258*fHat[1]+fHat[0])); 
    fHatVal[6] = -0.3535533905932737*(0.1924500897298753*fHat[7]+0.3333333333333333*((-1.0*fHat[6])+fHat[5]+fHat[4])+0.5773502691896258*(fHat[1]-1.0*(fHat[3]+fHat[2]))-1.0*fHat[0]); 
    fHatVal[7] = 0.3535533905932737*(0.1924500897298753*fHat[7]+0.3333333333333333*(fHat[6]+fHat[5]+fHat[4])+0.5773502691896258*(fHat[3]+fHat[2]+fHat[1])+fHat[0]); 

    for(int i=0; i<8; i++) {
      double ratio = fHatVal[i]/(-fVolVal[i] + EPSILON);
      if(ratio>=0.0) alpha = std::min(alpha, ratio);
    }
  } 
  else if(ndim == 4) { 
    double fVolVal[16]; // fVolVal = array of vales of fVol evaluated at each node 
    fVolVal[0] = 0.02777777777777778*fVol[15]-0.04811252243246882*(fVol[14]+fVol[13]+fVol[12]+fVol[11])+0.08333333333333333*(fVol[10]+fVol[9]+fVol[8]+fVol[7]+fVol[6]+fVol[5])-0.1443375672974065*(fVol[4]+fVol[3]+fVol[2]+fVol[1])+0.25*fVol[0]; 
    fVolVal[1] = (-0.02777777777777778*fVol[15])+0.1924500897298753*(0.25*(fVol[13]+fVol[12]+fVol[11])-0.25*fVol[14])+0.08333333333333333*(fVol[10]+fVol[9])-0.08333333333333333*fVol[8]+0.08333333333333333*fVol[7]-0.08333333333333333*(fVol[6]+fVol[5])-0.1443375672974065*(fVol[4]+fVol[3]+fVol[2])+0.25*(0.5773502691896258*fVol[1]+fVol[0]); 
    fVolVal[2] = (-0.02777777777777778*fVol[15])+0.1924500897298753*(0.25*fVol[14]-0.25*fVol[13]+0.25*(fVol[12]+fVol[11]))+0.08333333333333333*fVol[10]-0.08333333333333333*fVol[9]+0.08333333333333333*fVol[8]-0.08333333333333333*fVol[7]+0.08333333333333333*fVol[6]-0.08333333333333333*fVol[5]+0.5773502691896258*((-0.25*(fVol[4]+fVol[3]))+0.25*fVol[2]-0.25*fVol[1])+0.25*fVol[0]; 
    fVolVal[3] = 0.02777777777777778*fVol[15]+0.1924500897298753*(0.25*(fVol[14]+fVol[13])-0.25*(fVol[12]+fVol[11]))+0.08333333333333333*fVol[10]-0.08333333333333333*(fVol[9]+fVol[8]+fVol[7]+fVol[6])+0.08333333333333333*fVol[5]-0.1443375672974065*(fVol[4]+fVol[3])+0.25*(0.5773502691896258*(fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[4] = (-0.02777777777777778*fVol[15])+0.1924500897298753*(0.25*(fVol[14]+fVol[13])-0.25*fVol[12]+0.25*fVol[11])-0.08333333333333333*fVol[10]+0.08333333333333333*(fVol[9]+fVol[8])-0.08333333333333333*(fVol[7]+fVol[6])+0.08333333333333333*fVol[5]+0.5773502691896258*((-0.25*fVol[4])+0.25*fVol[3]-0.25*(fVol[2]+fVol[1]))+0.25*fVol[0]; 
    fVolVal[5] = 0.02777777777777778*fVol[15]+0.1924500897298753*(0.25*fVol[14]-0.25*fVol[13]+0.25*fVol[12]-0.25*fVol[11])-0.08333333333333333*fVol[10]+0.08333333333333333*fVol[9]-0.08333333333333333*(fVol[8]+fVol[7])+0.08333333333333333*fVol[6]-0.08333333333333333*fVol[5]+0.5773502691896258*((-0.25*fVol[4])+0.25*fVol[3]-0.25*fVol[2])+0.25*(0.5773502691896258*fVol[1]+fVol[0]); 
    fVolVal[6] = 0.02777777777777778*fVol[15]+0.1924500897298753*((-0.25*fVol[14])+0.25*(fVol[13]+fVol[12])-0.25*fVol[11])-0.08333333333333333*(fVol[10]+fVol[9])+0.08333333333333333*(fVol[8]+fVol[7])-0.08333333333333333*(fVol[6]+fVol[5])+0.5773502691896258*((-0.25*fVol[4])+0.25*(fVol[3]+fVol[2])-0.25*fVol[1])+0.25*fVol[0]; 
    fVolVal[7] = (-0.02777777777777778*fVol[15])+0.1924500897298753*(0.25*fVol[11]-0.25*(fVol[14]+fVol[13]+fVol[12]))-0.08333333333333333*(fVol[10]+fVol[9]+fVol[8])+0.08333333333333333*(fVol[7]+fVol[6]+fVol[5])-0.1443375672974065*fVol[4]+0.25*(0.5773502691896258*(fVol[3]+fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[8] = (-0.02777777777777778*fVol[15])+0.1924500897298753*(0.25*(fVol[14]+fVol[13]+fVol[12])-0.25*fVol[11])-0.08333333333333333*(fVol[10]+fVol[9]+fVol[8])+0.08333333333333333*(fVol[7]+fVol[6]+fVol[5])+0.5773502691896258*(0.25*fVol[4]-0.25*(fVol[3]+fVol[2]+fVol[1]))+0.25*fVol[0]; 
    fVolVal[9] = 0.02777777777777778*fVol[15]+0.1924500897298753*(0.25*fVol[14]-0.25*(fVol[13]+fVol[12])+0.25*fVol[11])-0.08333333333333333*(fVol[10]+fVol[9])+0.08333333333333333*(fVol[8]+fVol[7])-0.08333333333333333*(fVol[6]+fVol[5])+0.5773502691896258*(0.25*fVol[4]-0.25*(fVol[3]+fVol[2]))+0.25*(0.5773502691896258*fVol[1]+fVol[0]); 
    fVolVal[10] = 0.02777777777777778*fVol[15]+0.1924500897298753*((-0.25*fVol[14])+0.25*fVol[13]-0.25*fVol[12]+0.25*fVol[11])-0.08333333333333333*fVol[10]+0.08333333333333333*fVol[9]-0.08333333333333333*(fVol[8]+fVol[7])+0.08333333333333333*fVol[6]-0.08333333333333333*fVol[5]+0.5773502691896258*(0.25*fVol[4]-0.25*fVol[3]+0.25*fVol[2]-0.25*fVol[1])+0.25*fVol[0]; 
    fVolVal[11] = (-0.02777777777777778*fVol[15])+0.1924500897298753*((-0.25*(fVol[14]+fVol[13]))+0.25*fVol[12]-0.25*fVol[11])-0.08333333333333333*fVol[10]+0.08333333333333333*(fVol[9]+fVol[8])-0.08333333333333333*(fVol[7]+fVol[6])+0.08333333333333333*fVol[5]+0.5773502691896258*(0.25*fVol[4]-0.25*fVol[3])+0.25*(0.5773502691896258*(fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[12] = 0.02777777777777778*fVol[15]+0.1924500897298753*(0.25*(fVol[12]+fVol[11])-0.25*(fVol[14]+fVol[13]))+0.08333333333333333*fVol[10]-0.08333333333333333*(fVol[9]+fVol[8]+fVol[7]+fVol[6])+0.08333333333333333*fVol[5]+0.5773502691896258*(0.25*(fVol[4]+fVol[3])-0.25*(fVol[2]+fVol[1]))+0.25*fVol[0]; 
    fVolVal[13] = (-0.02777777777777778*fVol[15])+0.1924500897298753*((-0.25*fVol[14])+0.25*fVol[13]-0.25*(fVol[12]+fVol[11]))+0.08333333333333333*fVol[10]-0.08333333333333333*fVol[9]+0.08333333333333333*fVol[8]-0.08333333333333333*fVol[7]+0.08333333333333333*fVol[6]-0.08333333333333333*fVol[5]+0.5773502691896258*(0.25*(fVol[4]+fVol[3])-0.25*fVol[2])+0.25*(0.5773502691896258*fVol[1]+fVol[0]); 
    fVolVal[14] = (-0.02777777777777778*fVol[15])+0.1924500897298753*(0.25*fVol[14]-0.25*(fVol[13]+fVol[12]+fVol[11]))+0.08333333333333333*(fVol[10]+fVol[9])-0.08333333333333333*fVol[8]+0.08333333333333333*fVol[7]-0.08333333333333333*(fVol[6]+fVol[5])+0.5773502691896258*(0.25*(fVol[4]+fVol[3]+fVol[2])-0.25*fVol[1])+0.25*fVol[0]; 
    fVolVal[15] = 0.02777777777777778*fVol[15]+0.04811252243246882*(fVol[14]+fVol[13]+fVol[12]+fVol[11])+0.08333333333333333*(fVol[10]+fVol[9]+fVol[8]+fVol[7]+fVol[6]+fVol[5])+0.25*(0.5773502691896258*(fVol[4]+fVol[3]+fVol[2]+fVol[1])+fVol[0]); 

    double fHatVal[16]; // fHatVal = array of vales of fHat evaluated at each node 
    fHatVal[0] = 0.02777777777777778*fHat[15]-0.04811252243246882*(fHat[14]+fHat[13]+fHat[12]+fHat[11])+0.08333333333333333*(fHat[10]+fHat[9]+fHat[8]+fHat[7]+fHat[6]+fHat[5])-0.1443375672974065*(fHat[4]+fHat[3]+fHat[2]+fHat[1])+0.25*fHat[0]; 
    fHatVal[1] = (-0.02777777777777778*fHat[15])+0.1924500897298753*(0.25*(fHat[13]+fHat[12]+fHat[11])-0.25*fHat[14])+0.08333333333333333*(fHat[10]+fHat[9])-0.08333333333333333*fHat[8]+0.08333333333333333*fHat[7]-0.08333333333333333*(fHat[6]+fHat[5])-0.1443375672974065*(fHat[4]+fHat[3]+fHat[2])+0.25*(0.5773502691896258*fHat[1]+fHat[0]); 
    fHatVal[2] = (-0.02777777777777778*fHat[15])+0.1924500897298753*(0.25*fHat[14]-0.25*fHat[13]+0.25*(fHat[12]+fHat[11]))+0.08333333333333333*fHat[10]-0.08333333333333333*fHat[9]+0.08333333333333333*fHat[8]-0.08333333333333333*fHat[7]+0.08333333333333333*fHat[6]-0.08333333333333333*fHat[5]+0.5773502691896258*((-0.25*(fHat[4]+fHat[3]))+0.25*fHat[2]-0.25*fHat[1])+0.25*fHat[0]; 
    fHatVal[3] = 0.02777777777777778*fHat[15]+0.1924500897298753*(0.25*(fHat[14]+fHat[13])-0.25*(fHat[12]+fHat[11]))+0.08333333333333333*fHat[10]-0.08333333333333333*(fHat[9]+fHat[8]+fHat[7]+fHat[6])+0.08333333333333333*fHat[5]-0.1443375672974065*(fHat[4]+fHat[3])+0.25*(0.5773502691896258*(fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[4] = (-0.02777777777777778*fHat[15])+0.1924500897298753*(0.25*(fHat[14]+fHat[13])-0.25*fHat[12]+0.25*fHat[11])-0.08333333333333333*fHat[10]+0.08333333333333333*(fHat[9]+fHat[8])-0.08333333333333333*(fHat[7]+fHat[6])+0.08333333333333333*fHat[5]+0.5773502691896258*((-0.25*fHat[4])+0.25*fHat[3]-0.25*(fHat[2]+fHat[1]))+0.25*fHat[0]; 
    fHatVal[5] = 0.02777777777777778*fHat[15]+0.1924500897298753*(0.25*fHat[14]-0.25*fHat[13]+0.25*fHat[12]-0.25*fHat[11])-0.08333333333333333*fHat[10]+0.08333333333333333*fHat[9]-0.08333333333333333*(fHat[8]+fHat[7])+0.08333333333333333*fHat[6]-0.08333333333333333*fHat[5]+0.5773502691896258*((-0.25*fHat[4])+0.25*fHat[3]-0.25*fHat[2])+0.25*(0.5773502691896258*fHat[1]+fHat[0]); 
    fHatVal[6] = 0.02777777777777778*fHat[15]+0.1924500897298753*((-0.25*fHat[14])+0.25*(fHat[13]+fHat[12])-0.25*fHat[11])-0.08333333333333333*(fHat[10]+fHat[9])+0.08333333333333333*(fHat[8]+fHat[7])-0.08333333333333333*(fHat[6]+fHat[5])+0.5773502691896258*((-0.25*fHat[4])+0.25*(fHat[3]+fHat[2])-0.25*fHat[1])+0.25*fHat[0]; 
    fHatVal[7] = (-0.02777777777777778*fHat[15])+0.1924500897298753*(0.25*fHat[11]-0.25*(fHat[14]+fHat[13]+fHat[12]))-0.08333333333333333*(fHat[10]+fHat[9]+fHat[8])+0.08333333333333333*(fHat[7]+fHat[6]+fHat[5])-0.1443375672974065*fHat[4]+0.25*(0.5773502691896258*(fHat[3]+fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[8] = (-0.02777777777777778*fHat[15])+0.1924500897298753*(0.25*(fHat[14]+fHat[13]+fHat[12])-0.25*fHat[11])-0.08333333333333333*(fHat[10]+fHat[9]+fHat[8])+0.08333333333333333*(fHat[7]+fHat[6]+fHat[5])+0.5773502691896258*(0.25*fHat[4]-0.25*(fHat[3]+fHat[2]+fHat[1]))+0.25*fHat[0]; 
    fHatVal[9] = 0.02777777777777778*fHat[15]+0.1924500897298753*(0.25*fHat[14]-0.25*(fHat[13]+fHat[12])+0.25*fHat[11])-0.08333333333333333*(fHat[10]+fHat[9])+0.08333333333333333*(fHat[8]+fHat[7])-0.08333333333333333*(fHat[6]+fHat[5])+0.5773502691896258*(0.25*fHat[4]-0.25*(fHat[3]+fHat[2]))+0.25*(0.5773502691896258*fHat[1]+fHat[0]); 
    fHatVal[10] = 0.02777777777777778*fHat[15]+0.1924500897298753*((-0.25*fHat[14])+0.25*fHat[13]-0.25*fHat[12]+0.25*fHat[11])-0.08333333333333333*fHat[10]+0.08333333333333333*fHat[9]-0.08333333333333333*(fHat[8]+fHat[7])+0.08333333333333333*fHat[6]-0.08333333333333333*fHat[5]+0.5773502691896258*(0.25*fHat[4]-0.25*fHat[3]+0.25*fHat[2]-0.25*fHat[1])+0.25*fHat[0]; 
    fHatVal[11] = (-0.02777777777777778*fHat[15])+0.1924500897298753*((-0.25*(fHat[14]+fHat[13]))+0.25*fHat[12]-0.25*fHat[11])-0.08333333333333333*fHat[10]+0.08333333333333333*(fHat[9]+fHat[8])-0.08333333333333333*(fHat[7]+fHat[6])+0.08333333333333333*fHat[5]+0.5773502691896258*(0.25*fHat[4]-0.25*fHat[3])+0.25*(0.5773502691896258*(fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[12] = 0.02777777777777778*fHat[15]+0.1924500897298753*(0.25*(fHat[12]+fHat[11])-0.25*(fHat[14]+fHat[13]))+0.08333333333333333*fHat[10]-0.08333333333333333*(fHat[9]+fHat[8]+fHat[7]+fHat[6])+0.08333333333333333*fHat[5]+0.5773502691896258*(0.25*(fHat[4]+fHat[3])-0.25*(fHat[2]+fHat[1]))+0.25*fHat[0]; 
    fHatVal[13] = (-0.02777777777777778*fHat[15])+0.1924500897298753*((-0.25*fHat[14])+0.25*fHat[13]-0.25*(fHat[12]+fHat[11]))+0.08333333333333333*fHat[10]-0.08333333333333333*fHat[9]+0.08333333333333333*fHat[8]-0.08333333333333333*fHat[7]+0.08333333333333333*fHat[6]-0.08333333333333333*fHat[5]+0.5773502691896258*(0.25*(fHat[4]+fHat[3])-0.25*fHat[2])+0.25*(0.5773502691896258*fHat[1]+fHat[0]); 
    fHatVal[14] = (-0.02777777777777778*fHat[15])+0.1924500897298753*(0.25*fHat[14]-0.25*(fHat[13]+fHat[12]+fHat[11]))+0.08333333333333333*(fHat[10]+fHat[9])-0.08333333333333333*fHat[8]+0.08333333333333333*fHat[7]-0.08333333333333333*(fHat[6]+fHat[5])+0.5773502691896258*(0.25*(fHat[4]+fHat[3]+fHat[2])-0.25*fHat[1])+0.25*fHat[0]; 
    fHatVal[15] = 0.02777777777777778*fHat[15]+0.04811252243246882*(fHat[14]+fHat[13]+fHat[12]+fHat[11])+0.08333333333333333*(fHat[10]+fHat[9]+fHat[8]+fHat[7]+fHat[6]+fHat[5])+0.25*(0.5773502691896258*(fHat[4]+fHat[3]+fHat[2]+fHat[1])+fHat[0]); 

    for(int i=0; i<16; i++) {
      double ratio = fHatVal[i]/(-fVolVal[i] + EPSILON);
      if(ratio>=0.0) alpha = std::min(alpha, ratio);
    }
  } 
  else if(ndim == 5) { 
    double fVolVal[32]; // fVolVal = array of vales of fVol evaluated at each node 
    fVolVal[0] = -0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*fVol[30]-0.1111111111111111*(fVol[29]+fVol[28])-0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]+fVol[22]+fVol[21]+fVol[20]+fVol[19]+fVol[18]+fVol[17]+fVol[16])-0.3333333333333333*(fVol[15]+fVol[14])-0.3333333333333333*(fVol[13]+fVol[12])-0.3333333333333333*(fVol[11]+fVol[10])-0.3333333333333333*(fVol[9]+fVol[8])-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]+fVol[4]+fVol[3]+fVol[2]+fVol[1])-1.0*fVol[0]); 
    fVolVal[1] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*fVol[30]-0.1111111111111111*(fVol[29]+fVol[28]+fVol[27]+fVol[26])+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]-1.0*fVol[22]+fVol[21]+fVol[20]-1.0*fVol[19]+fVol[18]+fVol[17]+fVol[16])+0.3333333333333333*(fVol[15]+fVol[14]+fVol[13])-0.3333333333333333*fVol[12]+0.3333333333333333*(fVol[11]+fVol[10])-0.3333333333333333*fVol[9]+0.3333333333333333*fVol[8]-0.3333333333333333*(fVol[7]+fVol[6])-0.5773502691896258*(fVol[5]+fVol[4]+fVol[3]+fVol[2]-1.0*fVol[1])+fVol[0]); 
    fVolVal[2] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*fVol[30]+0.1111111111111111*fVol[29]-0.1111111111111111*(fVol[28]+fVol[27]+fVol[26])+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20]+fVol[19]-1.0*fVol[18]+fVol[17]+fVol[16])+0.3333333333333333*(fVol[15]+fVol[14])-0.3333333333333333*fVol[13]+0.3333333333333333*(fVol[12]+fVol[11])-0.3333333333333333*fVol[10]+0.3333333333333333*fVol[9]-0.3333333333333333*fVol[8]+0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]+0.5773502691896258*((-1.0*(fVol[5]+fVol[4]+fVol[3]-1.0*fVol[2]))-1.0*fVol[1])+fVol[0]); 
    fVolVal[3] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*((-0.1111111111111111*fVol[30])-1.0*(0.1111111111111111*fVol[29]-0.1111111111111111*fVol[28]))-0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]+fVol[22]+fVol[21]-1.0*fVol[20]+fVol[19]+fVol[18]-1.0*(fVol[17]+fVol[16])))-1.0*(0.3333333333333333*fVol[15]-1.0*((-0.3333333333333333*(fVol[14]-1.0*(fVol[13]+fVol[12]-1.0*fVol[11])))-1.0*((-0.3333333333333333*(fVol[10]+fVol[9]+fVol[8]))-1.0*(0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]))))+0.5773502691896258*(fVol[5]+fVol[4]+fVol[3])-1.0*(0.5773502691896258*(fVol[2]+fVol[1])+fVol[0])); 
    fVolVal[4] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*(fVol[30]+fVol[29])+0.1111111111111111*fVol[28]-0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]-1.0*fVol[22])+fVol[21]-1.0*fVol[20]+fVol[19]+fVol[18]-1.0*fVol[17]+fVol[16])+0.3333333333333333*fVol[15]-0.3333333333333333*fVol[14]+0.3333333333333333*(fVol[13]+fVol[12])-0.3333333333333333*fVol[11]+0.3333333333333333*(fVol[10]+fVol[9])-0.3333333333333333*(fVol[8]+fVol[7])+0.3333333333333333*fVol[6]+0.5773502691896258*((-1.0*(fVol[5]+fVol[4]))+fVol[3]-1.0*(fVol[2]+fVol[1]))+fVol[0]); 
    fVolVal[5] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*(0.1111111111111111*fVol[29]-0.1111111111111111*fVol[30])-0.1111111111111111*((-1.0*fVol[28])+fVol[27]+fVol[26])+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*(fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20]+fVol[19]-1.0*fVol[18]+fVol[17]-1.0*fVol[16]))-1.0*(0.3333333333333333*fVol[15]-1.0*(0.3333333333333333*fVol[14]-1.0*(0.3333333333333333*(fVol[13]-1.0*(fVol[12]+fVol[11]-1.0*fVol[10])-1.0*(fVol[9]+fVol[8]-1.0*fVol[7]))-0.3333333333333333*fVol[6])))+0.5773502691896258*(fVol[5]+fVol[4]-1.0*fVol[3]+fVol[2])-1.0*(0.5773502691896258*fVol[1]+fVol[0])); 
    fVolVal[6] = -0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*fVol[30]-0.1111111111111111*((-1.0*(fVol[29]+fVol[28]))+fVol[27]+fVol[26])+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]+fVol[22]-1.0*(fVol[21]+fVol[20]-1.0*fVol[19]+fVol[18]+fVol[17]-1.0*fVol[16]))+0.3333333333333333*((-1.0*fVol[15])+fVol[14]+fVol[13])+0.3333333333333333*((-1.0*fVol[12])+fVol[11]+fVol[10])+0.3333333333333333*((-1.0*(fVol[9]+fVol[8]))+fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]+fVol[4]-1.0*(fVol[3]+fVol[2]-1.0*fVol[1]))-1.0*fVol[0]); 
    fVolVal[7] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*(fVol[30]+fVol[29]+fVol[28])-0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]-1.0*(fVol[22]+fVol[21]+fVol[20]+fVol[19]+fVol[18]+fVol[17]-1.0*fVol[16]))+0.3333333333333333*fVol[15]-0.3333333333333333*(fVol[14]+fVol[13]+fVol[12]+fVol[11]+fVol[10]+fVol[9])+0.3333333333333333*(fVol[8]+fVol[7]+fVol[6])+0.5773502691896258*((-1.0*(fVol[5]+fVol[4]))+fVol[3]+fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[8] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*(fVol[30]+fVol[29]+fVol[28])+0.1111111111111111*fVol[27]-0.1111111111111111*fVol[26]+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]-1.0*(fVol[22]+fVol[21]+fVol[20]-1.0*(fVol[19]+fVol[18]+fVol[17])+fVol[16]))-0.3333333333333333*fVol[15]+0.3333333333333333*(fVol[14]+fVol[13]+fVol[12])-0.3333333333333333*(fVol[11]+fVol[10]+fVol[9])+0.3333333333333333*(fVol[8]+fVol[7]+fVol[6])+0.5773502691896258*((-1.0*fVol[5])+fVol[4]-1.0*(fVol[3]+fVol[2]+fVol[1]))+fVol[0]); 
    fVolVal[9] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*(0.1111111111111111*fVol[26]-0.1111111111111111*(fVol[30]-1.0*(fVol[29]+fVol[28]-1.0*fVol[27])))+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]+fVol[22]-1.0*(fVol[21]+fVol[20]+fVol[19]-1.0*(fVol[18]+fVol[17])))-1.0*(0.1924500897298753*fVol[16]-1.0*(0.3333333333333333*fVol[15]-0.3333333333333333*fVol[14])+0.3333333333333333*fVol[13]-0.3333333333333333*fVol[12])+0.3333333333333333*(fVol[11]+fVol[10])+0.3333333333333333*((-1.0*(fVol[9]+fVol[8]))+fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]-1.0*fVol[4]+fVol[3]+fVol[2])-1.0*(0.5773502691896258*fVol[1]+fVol[0])); 
    fVolVal[10] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*(0.1111111111111111*(fVol[30]-1.0*fVol[29])-0.1111111111111111*(fVol[27]-1.0*fVol[28])+0.1111111111111111*fVol[26])+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*(fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20])+fVol[19]-1.0*fVol[18]+fVol[17])-1.0*(0.1924500897298753*fVol[16]-1.0*(0.3333333333333333*(fVol[15]-1.0*fVol[14])-1.0*(0.3333333333333333*((-1.0*(fVol[13]-1.0*fVol[12]+fVol[11]))+fVol[10]-1.0*(fVol[9]+fVol[8]-1.0*fVol[7]))-0.3333333333333333*fVol[6])))+0.5773502691896258*(fVol[5]-1.0*fVol[4]+fVol[3]-1.0*fVol[2]+fVol[1])-1.0*fVol[0]); 
    fVolVal[11] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*(fVol[30]+fVol[29])-0.1111111111111111*fVol[28]+0.1111111111111111*fVol[27]-0.1111111111111111*fVol[26]+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]-1.0*fVol[22])+fVol[21]-1.0*(fVol[20]+fVol[19]+fVol[18]-1.0*fVol[17]+fVol[16]))-0.3333333333333333*fVol[15]+0.3333333333333333*fVol[14]-0.3333333333333333*(fVol[13]+fVol[12]+fVol[11])+0.3333333333333333*(fVol[10]+fVol[9])-0.3333333333333333*(fVol[8]+fVol[7])+0.3333333333333333*fVol[6]+0.5773502691896258*((-1.0*fVol[5])+fVol[4]-1.0*fVol[3]+fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[12] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*(0.1111111111111111*fVol[30]-1.0*(0.1111111111111111*fVol[28]-0.1111111111111111*fVol[29])-0.1111111111111111*fVol[27]+0.1111111111111111*fVol[26])+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]+fVol[22]+fVol[21]-1.0*(fVol[20]+fVol[19]+fVol[18])))-1.0*(0.1924500897298753*(fVol[17]+fVol[16])-1.0*((-0.3333333333333333*((-1.0*(fVol[15]+fVol[14]))+fVol[13]+fVol[12]))-1.0*(0.3333333333333333*fVol[11]-0.3333333333333333*(fVol[10]+fVol[9]+fVol[8]))+0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]))+0.5773502691896258*(fVol[5]-1.0*(fVol[4]+fVol[3]-1.0*fVol[2])+fVol[1])-1.0*fVol[0]); 
    fVolVal[13] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*fVol[30]-0.1111111111111111*fVol[29]+0.1111111111111111*(fVol[28]+fVol[27])-0.1111111111111111*fVol[26]+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20]-1.0*fVol[19]+fVol[18]-1.0*(fVol[17]+fVol[16]))-0.3333333333333333*(fVol[15]+fVol[14])+0.3333333333333333*fVol[13]-0.3333333333333333*fVol[12]+0.3333333333333333*fVol[11]-0.3333333333333333*fVol[10]+0.3333333333333333*fVol[9]-0.3333333333333333*fVol[8]+0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]+0.5773502691896258*((-1.0*fVol[5])+fVol[4]+fVol[3]-1.0*fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[14] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*fVol[30]+0.1111111111111111*(fVol[29]+fVol[28]+fVol[27])-0.1111111111111111*fVol[26]+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]-1.0*fVol[22]+fVol[21]+fVol[20]+fVol[19]-1.0*(fVol[18]+fVol[17]+fVol[16]))-0.3333333333333333*(fVol[15]+fVol[14]+fVol[13])+0.3333333333333333*(fVol[12]+fVol[11]+fVol[10])-0.3333333333333333*fVol[9]+0.3333333333333333*fVol[8]-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*((-1.0*fVol[5])+fVol[4]+fVol[3]+fVol[2]-1.0*fVol[1])+fVol[0]); 
    fVolVal[15] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*((-0.1111111111111111*(fVol[30]+fVol[29]+fVol[28]))-0.1111111111111111*fVol[27]+0.1111111111111111*fVol[26])+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]+fVol[22]+fVol[21]+fVol[20]-1.0*(fVol[19]+fVol[18]+fVol[17]+fVol[16]))+0.3333333333333333*(fVol[15]+fVol[14]+fVol[13]+fVol[12]-1.0*(fVol[11]+fVol[10]))-0.3333333333333333*(fVol[9]+fVol[8])-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*fVol[5]-1.0*(0.5773502691896258*(fVol[4]+fVol[3]+fVol[2]+fVol[1])+fVol[0])); 
    fVolVal[16] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*(fVol[30]+fVol[29]+fVol[28]+fVol[27])+0.1111111111111111*fVol[26]+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]+fVol[22]+fVol[21]+fVol[20]-1.0*(fVol[19]+fVol[18]+fVol[17]+fVol[16]))-0.3333333333333333*(fVol[15]+fVol[14]+fVol[13]+fVol[12])+0.3333333333333333*(fVol[11]+fVol[10]+fVol[9]+fVol[8]+fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]-1.0*(fVol[4]+fVol[3]+fVol[2]+fVol[1]))+fVol[0]); 
    fVolVal[17] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*((-0.1111111111111111*fVol[30])+0.1111111111111111*(fVol[29]+fVol[28])+0.1111111111111111*fVol[27]-0.1111111111111111*fVol[26])+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]-1.0*fVol[22]+fVol[21]+fVol[20]+fVol[19])-1.0*(0.1924500897298753*(fVol[18]+fVol[17]+fVol[16])-1.0*((-0.3333333333333333*(fVol[11]-1.0*(fVol[15]+fVol[14]+fVol[13]-1.0*fVol[12])))-1.0*(0.3333333333333333*fVol[10]-0.3333333333333333*fVol[9])))+0.3333333333333333*((-1.0*fVol[8])+fVol[7]+fVol[6])+0.5773502691896258*((-1.0*fVol[5])+fVol[4]+fVol[3]+fVol[2])-1.0*(0.5773502691896258*fVol[1]+fVol[0])); 
    fVolVal[18] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*(0.1111111111111111*fVol[30]-1.0*(0.1111111111111111*fVol[29]-0.1111111111111111*fVol[28])+0.1111111111111111*fVol[27]-0.1111111111111111*fVol[26])+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20]-1.0*fVol[19]+fVol[18]-1.0*(fVol[17]+fVol[16]))+0.3333333333333333*(fVol[15]+fVol[14]-1.0*fVol[13]+fVol[12]-1.0*fVol[11]+fVol[10]-1.0*fVol[9]+fVol[8]-1.0*fVol[7]+fVol[6])+0.5773502691896258*((-1.0*fVol[5])+fVol[4]+fVol[3]-1.0*fVol[2]+fVol[1])-1.0*fVol[0]); 
    fVolVal[19] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*(fVol[30]+fVol[29])-0.1111111111111111*(fVol[28]+fVol[27])+0.1111111111111111*fVol[26]+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]+fVol[22]+fVol[21]-1.0*(fVol[20]+fVol[19]+fVol[18]))-1.0*(fVol[17]+fVol[16]))-0.3333333333333333*(fVol[15]+fVol[14])+0.3333333333333333*(fVol[13]+fVol[12]+fVol[11])-0.3333333333333333*(fVol[10]+fVol[9]+fVol[8]+fVol[7])+0.3333333333333333*fVol[6]+0.5773502691896258*(fVol[5]-1.0*(fVol[4]+fVol[3]-1.0*fVol[2])+fVol[1])+fVol[0]); 
    fVolVal[20] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*(0.1111111111111111*fVol[30]+0.1111111111111111*fVol[29]+0.1111111111111111*(fVol[27]-1.0*fVol[28])-0.1111111111111111*fVol[26])+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]-1.0*fVol[22])+fVol[21]-1.0*(fVol[20]+fVol[19]+fVol[18]-1.0*fVol[17]))-1.0*(0.1924500897298753*fVol[16]-0.3333333333333333*fVol[15]-0.3333333333333333*((-1.0*fVol[14])+fVol[13]+fVol[12])-1.0*(0.3333333333333333*fVol[11]-0.3333333333333333*fVol[10])+0.3333333333333333*fVol[9]-0.3333333333333333*fVol[8]-1.0*(0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]))+0.5773502691896258*((-1.0*fVol[5])+fVol[4]-1.0*fVol[3]+fVol[2]+fVol[1])-1.0*fVol[0]); 
    fVolVal[21] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*fVol[30]-0.1111111111111111*fVol[29]+0.1111111111111111*fVol[28]-0.1111111111111111*fVol[27]+0.1111111111111111*fVol[26]+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*(fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20])+fVol[19]-1.0*fVol[18]+fVol[17]-1.0*fVol[16])-0.3333333333333333*fVol[15]+0.3333333333333333*fVol[14]-0.3333333333333333*fVol[13]+0.3333333333333333*fVol[12]-0.3333333333333333*fVol[11]+0.3333333333333333*fVol[10]-0.3333333333333333*(fVol[9]+fVol[8])+0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]+0.5773502691896258*(fVol[5]-1.0*fVol[4]+fVol[3]-1.0*fVol[2]+fVol[1])+fVol[0]); 
    fVolVal[22] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*fVol[30]+0.1111111111111111*(fVol[29]+fVol[28])-0.1111111111111111*fVol[27]+0.1111111111111111*fVol[26]+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]+fVol[22]-1.0*(fVol[21]+fVol[20]+fVol[19]-1.0*(fVol[18]+fVol[17])+fVol[16]))-0.3333333333333333*fVol[15]+0.3333333333333333*(fVol[14]+fVol[13])-0.3333333333333333*(fVol[12]+fVol[11]+fVol[10])+0.3333333333333333*(fVol[9]+fVol[8])-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]-1.0*fVol[4]+fVol[3]+fVol[2]-1.0*fVol[1])+fVol[0]); 
    fVolVal[23] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*((-0.1111111111111111*fVol[30])+0.1111111111111111*(fVol[27]-1.0*(fVol[29]+fVol[28]))-0.1111111111111111*fVol[26])+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]-1.0*(fVol[22]+fVol[21]+fVol[20]-1.0*(fVol[19]+fVol[18]+fVol[17])))-1.0*(0.1924500897298753*fVol[16]-0.3333333333333333*fVol[15]-0.3333333333333333*(fVol[10]-1.0*(fVol[14]+fVol[13]+fVol[12]-1.0*fVol[11]))-1.0*(0.3333333333333333*fVol[9]-0.3333333333333333*fVol[8]))-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*(fVol[4]-1.0*fVol[5])-1.0*(0.5773502691896258*(fVol[3]+fVol[2]+fVol[1])+fVol[0])); 
    fVolVal[24] = -0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*(fVol[26]-1.0*(fVol[30]+fVol[29]+fVol[28]-1.0*fVol[27]))+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]-1.0*(fVol[22]+fVol[21]+fVol[20]+fVol[19]+fVol[18]+fVol[17]-1.0*fVol[16]))-1.0*(0.3333333333333333*fVol[15]-1.0*(0.3333333333333333*(fVol[14]+fVol[13]+fVol[12]+fVol[11]+fVol[10])-1.0*(0.3333333333333333*fVol[8]-0.3333333333333333*fVol[9])))-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*((-1.0*(fVol[5]+fVol[4]))+fVol[3]+fVol[2]+fVol[1])-1.0*fVol[0]); 
    fVolVal[25] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*fVol[30]-0.1111111111111111*(fVol[29]+fVol[28])+0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]+fVol[22]-1.0*(fVol[21]+fVol[20]-1.0*fVol[19]+fVol[18]+fVol[17]-1.0*fVol[16]))+0.3333333333333333*fVol[15]-0.3333333333333333*(fVol[14]+fVol[13])+0.3333333333333333*fVol[12]-0.3333333333333333*(fVol[11]+fVol[10])+0.3333333333333333*(fVol[9]+fVol[8])-0.3333333333333333*(fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]+fVol[4]-1.0*(fVol[3]+fVol[2]-1.0*fVol[1]))+fVol[0]); 
    fVolVal[26] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*fVol[30]+0.1111111111111111*fVol[29]-0.1111111111111111*fVol[28]+0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*(fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20]+fVol[19]-1.0*fVol[18]+fVol[17]-1.0*fVol[16]))+0.3333333333333333*fVol[15]-0.3333333333333333*fVol[14]+0.3333333333333333*fVol[13]-0.3333333333333333*(fVol[12]+fVol[11])+0.3333333333333333*fVol[10]-0.3333333333333333*(fVol[9]+fVol[8])+0.3333333333333333*fVol[7]-0.3333333333333333*fVol[6]+0.5773502691896258*(fVol[5]+fVol[4]-1.0*fVol[3]+fVol[2]-1.0*fVol[1])+fVol[0]); 
    fVolVal[27] = -0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*(fVol[30]+fVol[29])+0.1111111111111111*((-1.0*fVol[28])+fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]-1.0*fVol[22])+fVol[21]-1.0*fVol[20]+fVol[19]+fVol[18]-1.0*fVol[17]+fVol[16])-1.0*(0.3333333333333333*fVol[15]-1.0*(0.3333333333333333*(fVol[14]-1.0*(fVol[13]+fVol[12]-1.0*fVol[11]))-1.0*(0.3333333333333333*fVol[10]-1.0*(0.3333333333333333*fVol[8]-0.3333333333333333*fVol[9])-0.3333333333333333*fVol[7]+0.3333333333333333*fVol[6])))+0.5773502691896258*(fVol[3]-1.0*(fVol[5]+fVol[4]))-1.0*(0.5773502691896258*(fVol[2]+fVol[1])+fVol[0])); 
    fVolVal[28] = 0.1767766952966368*(0.06415002990995844*fVol[31]-0.1111111111111111*(fVol[30]+fVol[29])+0.1111111111111111*(fVol[28]+fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]-1.0*(fVol[24]+fVol[23]+fVol[22]+fVol[21]-1.0*fVol[20]+fVol[19]+fVol[18]-1.0*(fVol[17]+fVol[16])))+0.3333333333333333*(fVol[15]+fVol[14])-0.3333333333333333*(fVol[13]+fVol[12])+0.3333333333333333*fVol[11]-0.3333333333333333*(fVol[10]+fVol[9]+fVol[8]+fVol[7])+0.3333333333333333*fVol[6]+0.5773502691896258*(fVol[5]+fVol[4]+fVol[3]-1.0*(fVol[2]+fVol[1]))+fVol[0]); 
    fVolVal[29] = -0.1767766952966368*(0.06415002990995844*fVol[31]-1.0*((-0.1111111111111111*fVol[30])-1.0*(0.1111111111111111*fVol[28]-0.1111111111111111*fVol[29]))+0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*((-1.0*fVol[25])+fVol[24]-1.0*fVol[23]+fVol[22]-1.0*fVol[21]+fVol[20]+fVol[19]-1.0*fVol[18]+fVol[17]+fVol[16])-1.0*(0.3333333333333333*fVol[15]-1.0*((-0.3333333333333333*fVol[14])-1.0*(0.3333333333333333*(fVol[12]+fVol[11]-1.0*(fVol[10]-1.0*(fVol[9]-1.0*(fVol[8]-1.0*(fVol[7]-1.0*fVol[6])))))-0.3333333333333333*fVol[13]))+0.5773502691896258*(fVol[5]+fVol[4]+fVol[3]-1.0*fVol[2]))-1.0*(0.5773502691896258*fVol[1]+fVol[0])); 
    fVolVal[30] = -0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*((-1.0*fVol[30])+fVol[29]+fVol[28])+0.1111111111111111*(fVol[27]+fVol[26])+0.1924500897298753*((-1.0*(fVol[25]+fVol[24]))+fVol[23]-1.0*fVol[22]+fVol[21]+fVol[20]-1.0*fVol[19]+fVol[18]+fVol[17]+fVol[16])-1.0*(0.3333333333333333*fVol[15]-1.0*((-0.3333333333333333*fVol[14])-0.3333333333333333*fVol[13]-0.3333333333333333*((-1.0*fVol[12])+fVol[11]+fVol[10])-1.0*(0.3333333333333333*(fVol[8]-1.0*fVol[9])-0.3333333333333333*(fVol[7]+fVol[6])))+0.5773502691896258*(fVol[5]+fVol[4]+fVol[3]+fVol[2]-1.0*fVol[1]))-1.0*fVol[0]); 
    fVolVal[31] = 0.1767766952966368*(0.06415002990995844*fVol[31]+0.1111111111111111*(fVol[30]+fVol[29]+fVol[28]+fVol[27]+fVol[26])+0.1924500897298753*(fVol[25]+fVol[24]+fVol[23]+fVol[22]+fVol[21]+fVol[20]+fVol[19]+fVol[18]+fVol[17]+fVol[16])+0.3333333333333333*(fVol[15]+fVol[14]+fVol[13]+fVol[12]+fVol[11]+fVol[10]+fVol[9]+fVol[8]+fVol[7]+fVol[6])+0.5773502691896258*(fVol[5]+fVol[4]+fVol[3]+fVol[2]+fVol[1])+fVol[0]); 

    double fHatVal[32]; // fHatVal = array of vales of fHat evaluated at each node 
    fHatVal[0] = -0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*fHat[30]-0.1111111111111111*(fHat[29]+fHat[28])-0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]+fHat[22]+fHat[21]+fHat[20]+fHat[19]+fHat[18]+fHat[17]+fHat[16])-0.3333333333333333*(fHat[15]+fHat[14])-0.3333333333333333*(fHat[13]+fHat[12])-0.3333333333333333*(fHat[11]+fHat[10])-0.3333333333333333*(fHat[9]+fHat[8])-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]+fHat[4]+fHat[3]+fHat[2]+fHat[1])-1.0*fHat[0]); 
    fHatVal[1] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*fHat[30]-0.1111111111111111*(fHat[29]+fHat[28]+fHat[27]+fHat[26])+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]-1.0*fHat[22]+fHat[21]+fHat[20]-1.0*fHat[19]+fHat[18]+fHat[17]+fHat[16])+0.3333333333333333*(fHat[15]+fHat[14]+fHat[13])-0.3333333333333333*fHat[12]+0.3333333333333333*(fHat[11]+fHat[10])-0.3333333333333333*fHat[9]+0.3333333333333333*fHat[8]-0.3333333333333333*(fHat[7]+fHat[6])-0.5773502691896258*(fHat[5]+fHat[4]+fHat[3]+fHat[2]-1.0*fHat[1])+fHat[0]); 
    fHatVal[2] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*fHat[30]+0.1111111111111111*fHat[29]-0.1111111111111111*(fHat[28]+fHat[27]+fHat[26])+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20]+fHat[19]-1.0*fHat[18]+fHat[17]+fHat[16])+0.3333333333333333*(fHat[15]+fHat[14])-0.3333333333333333*fHat[13]+0.3333333333333333*(fHat[12]+fHat[11])-0.3333333333333333*fHat[10]+0.3333333333333333*fHat[9]-0.3333333333333333*fHat[8]+0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]+0.5773502691896258*((-1.0*(fHat[5]+fHat[4]+fHat[3]-1.0*fHat[2]))-1.0*fHat[1])+fHat[0]); 
    fHatVal[3] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*((-0.1111111111111111*fHat[30])-1.0*(0.1111111111111111*fHat[29]-0.1111111111111111*fHat[28]))-0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]+fHat[22]+fHat[21]-1.0*fHat[20]+fHat[19]+fHat[18]-1.0*(fHat[17]+fHat[16])))-1.0*(0.3333333333333333*fHat[15]-1.0*((-0.3333333333333333*(fHat[14]-1.0*(fHat[13]+fHat[12]-1.0*fHat[11])))-1.0*((-0.3333333333333333*(fHat[10]+fHat[9]+fHat[8]))-1.0*(0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]))))+0.5773502691896258*(fHat[5]+fHat[4]+fHat[3])-1.0*(0.5773502691896258*(fHat[2]+fHat[1])+fHat[0])); 
    fHatVal[4] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*(fHat[30]+fHat[29])+0.1111111111111111*fHat[28]-0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]-1.0*fHat[22])+fHat[21]-1.0*fHat[20]+fHat[19]+fHat[18]-1.0*fHat[17]+fHat[16])+0.3333333333333333*fHat[15]-0.3333333333333333*fHat[14]+0.3333333333333333*(fHat[13]+fHat[12])-0.3333333333333333*fHat[11]+0.3333333333333333*(fHat[10]+fHat[9])-0.3333333333333333*(fHat[8]+fHat[7])+0.3333333333333333*fHat[6]+0.5773502691896258*((-1.0*(fHat[5]+fHat[4]))+fHat[3]-1.0*(fHat[2]+fHat[1]))+fHat[0]); 
    fHatVal[5] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*(0.1111111111111111*fHat[29]-0.1111111111111111*fHat[30])-0.1111111111111111*((-1.0*fHat[28])+fHat[27]+fHat[26])+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*(fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20]+fHat[19]-1.0*fHat[18]+fHat[17]-1.0*fHat[16]))-1.0*(0.3333333333333333*fHat[15]-1.0*(0.3333333333333333*fHat[14]-1.0*(0.3333333333333333*(fHat[13]-1.0*(fHat[12]+fHat[11]-1.0*fHat[10])-1.0*(fHat[9]+fHat[8]-1.0*fHat[7]))-0.3333333333333333*fHat[6])))+0.5773502691896258*(fHat[5]+fHat[4]-1.0*fHat[3]+fHat[2])-1.0*(0.5773502691896258*fHat[1]+fHat[0])); 
    fHatVal[6] = -0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*fHat[30]-0.1111111111111111*((-1.0*(fHat[29]+fHat[28]))+fHat[27]+fHat[26])+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]+fHat[22]-1.0*(fHat[21]+fHat[20]-1.0*fHat[19]+fHat[18]+fHat[17]-1.0*fHat[16]))+0.3333333333333333*((-1.0*fHat[15])+fHat[14]+fHat[13])+0.3333333333333333*((-1.0*fHat[12])+fHat[11]+fHat[10])+0.3333333333333333*((-1.0*(fHat[9]+fHat[8]))+fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]+fHat[4]-1.0*(fHat[3]+fHat[2]-1.0*fHat[1]))-1.0*fHat[0]); 
    fHatVal[7] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*(fHat[30]+fHat[29]+fHat[28])-0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]-1.0*(fHat[22]+fHat[21]+fHat[20]+fHat[19]+fHat[18]+fHat[17]-1.0*fHat[16]))+0.3333333333333333*fHat[15]-0.3333333333333333*(fHat[14]+fHat[13]+fHat[12]+fHat[11]+fHat[10]+fHat[9])+0.3333333333333333*(fHat[8]+fHat[7]+fHat[6])+0.5773502691896258*((-1.0*(fHat[5]+fHat[4]))+fHat[3]+fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[8] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*(fHat[30]+fHat[29]+fHat[28])+0.1111111111111111*fHat[27]-0.1111111111111111*fHat[26]+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]-1.0*(fHat[22]+fHat[21]+fHat[20]-1.0*(fHat[19]+fHat[18]+fHat[17])+fHat[16]))-0.3333333333333333*fHat[15]+0.3333333333333333*(fHat[14]+fHat[13]+fHat[12])-0.3333333333333333*(fHat[11]+fHat[10]+fHat[9])+0.3333333333333333*(fHat[8]+fHat[7]+fHat[6])+0.5773502691896258*((-1.0*fHat[5])+fHat[4]-1.0*(fHat[3]+fHat[2]+fHat[1]))+fHat[0]); 
    fHatVal[9] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*(0.1111111111111111*fHat[26]-0.1111111111111111*(fHat[30]-1.0*(fHat[29]+fHat[28]-1.0*fHat[27])))+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]+fHat[22]-1.0*(fHat[21]+fHat[20]+fHat[19]-1.0*(fHat[18]+fHat[17])))-1.0*(0.1924500897298753*fHat[16]-1.0*(0.3333333333333333*fHat[15]-0.3333333333333333*fHat[14])+0.3333333333333333*fHat[13]-0.3333333333333333*fHat[12])+0.3333333333333333*(fHat[11]+fHat[10])+0.3333333333333333*((-1.0*(fHat[9]+fHat[8]))+fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]-1.0*fHat[4]+fHat[3]+fHat[2])-1.0*(0.5773502691896258*fHat[1]+fHat[0])); 
    fHatVal[10] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*(0.1111111111111111*(fHat[30]-1.0*fHat[29])-0.1111111111111111*(fHat[27]-1.0*fHat[28])+0.1111111111111111*fHat[26])+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*(fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20])+fHat[19]-1.0*fHat[18]+fHat[17])-1.0*(0.1924500897298753*fHat[16]-1.0*(0.3333333333333333*(fHat[15]-1.0*fHat[14])-1.0*(0.3333333333333333*((-1.0*(fHat[13]-1.0*fHat[12]+fHat[11]))+fHat[10]-1.0*(fHat[9]+fHat[8]-1.0*fHat[7]))-0.3333333333333333*fHat[6])))+0.5773502691896258*(fHat[5]-1.0*fHat[4]+fHat[3]-1.0*fHat[2]+fHat[1])-1.0*fHat[0]); 
    fHatVal[11] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*(fHat[30]+fHat[29])-0.1111111111111111*fHat[28]+0.1111111111111111*fHat[27]-0.1111111111111111*fHat[26]+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]-1.0*fHat[22])+fHat[21]-1.0*(fHat[20]+fHat[19]+fHat[18]-1.0*fHat[17]+fHat[16]))-0.3333333333333333*fHat[15]+0.3333333333333333*fHat[14]-0.3333333333333333*(fHat[13]+fHat[12]+fHat[11])+0.3333333333333333*(fHat[10]+fHat[9])-0.3333333333333333*(fHat[8]+fHat[7])+0.3333333333333333*fHat[6]+0.5773502691896258*((-1.0*fHat[5])+fHat[4]-1.0*fHat[3]+fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[12] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*(0.1111111111111111*fHat[30]-1.0*(0.1111111111111111*fHat[28]-0.1111111111111111*fHat[29])-0.1111111111111111*fHat[27]+0.1111111111111111*fHat[26])+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]+fHat[22]+fHat[21]-1.0*(fHat[20]+fHat[19]+fHat[18])))-1.0*(0.1924500897298753*(fHat[17]+fHat[16])-1.0*((-0.3333333333333333*((-1.0*(fHat[15]+fHat[14]))+fHat[13]+fHat[12]))-1.0*(0.3333333333333333*fHat[11]-0.3333333333333333*(fHat[10]+fHat[9]+fHat[8]))+0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]))+0.5773502691896258*(fHat[5]-1.0*(fHat[4]+fHat[3]-1.0*fHat[2])+fHat[1])-1.0*fHat[0]); 
    fHatVal[13] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*fHat[30]-0.1111111111111111*fHat[29]+0.1111111111111111*(fHat[28]+fHat[27])-0.1111111111111111*fHat[26]+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20]-1.0*fHat[19]+fHat[18]-1.0*(fHat[17]+fHat[16]))-0.3333333333333333*(fHat[15]+fHat[14])+0.3333333333333333*fHat[13]-0.3333333333333333*fHat[12]+0.3333333333333333*fHat[11]-0.3333333333333333*fHat[10]+0.3333333333333333*fHat[9]-0.3333333333333333*fHat[8]+0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]+0.5773502691896258*((-1.0*fHat[5])+fHat[4]+fHat[3]-1.0*fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[14] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*fHat[30]+0.1111111111111111*(fHat[29]+fHat[28]+fHat[27])-0.1111111111111111*fHat[26]+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]-1.0*fHat[22]+fHat[21]+fHat[20]+fHat[19]-1.0*(fHat[18]+fHat[17]+fHat[16]))-0.3333333333333333*(fHat[15]+fHat[14]+fHat[13])+0.3333333333333333*(fHat[12]+fHat[11]+fHat[10])-0.3333333333333333*fHat[9]+0.3333333333333333*fHat[8]-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*((-1.0*fHat[5])+fHat[4]+fHat[3]+fHat[2]-1.0*fHat[1])+fHat[0]); 
    fHatVal[15] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*((-0.1111111111111111*(fHat[30]+fHat[29]+fHat[28]))-0.1111111111111111*fHat[27]+0.1111111111111111*fHat[26])+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]+fHat[22]+fHat[21]+fHat[20]-1.0*(fHat[19]+fHat[18]+fHat[17]+fHat[16]))+0.3333333333333333*(fHat[15]+fHat[14]+fHat[13]+fHat[12]-1.0*(fHat[11]+fHat[10]))-0.3333333333333333*(fHat[9]+fHat[8])-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*fHat[5]-1.0*(0.5773502691896258*(fHat[4]+fHat[3]+fHat[2]+fHat[1])+fHat[0])); 
    fHatVal[16] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*(fHat[30]+fHat[29]+fHat[28]+fHat[27])+0.1111111111111111*fHat[26]+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]+fHat[22]+fHat[21]+fHat[20]-1.0*(fHat[19]+fHat[18]+fHat[17]+fHat[16]))-0.3333333333333333*(fHat[15]+fHat[14]+fHat[13]+fHat[12])+0.3333333333333333*(fHat[11]+fHat[10]+fHat[9]+fHat[8]+fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]-1.0*(fHat[4]+fHat[3]+fHat[2]+fHat[1]))+fHat[0]); 
    fHatVal[17] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*((-0.1111111111111111*fHat[30])+0.1111111111111111*(fHat[29]+fHat[28])+0.1111111111111111*fHat[27]-0.1111111111111111*fHat[26])+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]-1.0*fHat[22]+fHat[21]+fHat[20]+fHat[19])-1.0*(0.1924500897298753*(fHat[18]+fHat[17]+fHat[16])-1.0*((-0.3333333333333333*(fHat[11]-1.0*(fHat[15]+fHat[14]+fHat[13]-1.0*fHat[12])))-1.0*(0.3333333333333333*fHat[10]-0.3333333333333333*fHat[9])))+0.3333333333333333*((-1.0*fHat[8])+fHat[7]+fHat[6])+0.5773502691896258*((-1.0*fHat[5])+fHat[4]+fHat[3]+fHat[2])-1.0*(0.5773502691896258*fHat[1]+fHat[0])); 
    fHatVal[18] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*(0.1111111111111111*fHat[30]-1.0*(0.1111111111111111*fHat[29]-0.1111111111111111*fHat[28])+0.1111111111111111*fHat[27]-0.1111111111111111*fHat[26])+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20]-1.0*fHat[19]+fHat[18]-1.0*(fHat[17]+fHat[16]))+0.3333333333333333*(fHat[15]+fHat[14]-1.0*fHat[13]+fHat[12]-1.0*fHat[11]+fHat[10]-1.0*fHat[9]+fHat[8]-1.0*fHat[7]+fHat[6])+0.5773502691896258*((-1.0*fHat[5])+fHat[4]+fHat[3]-1.0*fHat[2]+fHat[1])-1.0*fHat[0]); 
    fHatVal[19] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*(fHat[30]+fHat[29])-0.1111111111111111*(fHat[28]+fHat[27])+0.1111111111111111*fHat[26]+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]+fHat[22]+fHat[21]-1.0*(fHat[20]+fHat[19]+fHat[18]))-1.0*(fHat[17]+fHat[16]))-0.3333333333333333*(fHat[15]+fHat[14])+0.3333333333333333*(fHat[13]+fHat[12]+fHat[11])-0.3333333333333333*(fHat[10]+fHat[9]+fHat[8]+fHat[7])+0.3333333333333333*fHat[6]+0.5773502691896258*(fHat[5]-1.0*(fHat[4]+fHat[3]-1.0*fHat[2])+fHat[1])+fHat[0]); 
    fHatVal[20] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*(0.1111111111111111*fHat[30]+0.1111111111111111*fHat[29]+0.1111111111111111*(fHat[27]-1.0*fHat[28])-0.1111111111111111*fHat[26])+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]-1.0*fHat[22])+fHat[21]-1.0*(fHat[20]+fHat[19]+fHat[18]-1.0*fHat[17]))-1.0*(0.1924500897298753*fHat[16]-0.3333333333333333*fHat[15]-0.3333333333333333*((-1.0*fHat[14])+fHat[13]+fHat[12])-1.0*(0.3333333333333333*fHat[11]-0.3333333333333333*fHat[10])+0.3333333333333333*fHat[9]-0.3333333333333333*fHat[8]-1.0*(0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]))+0.5773502691896258*((-1.0*fHat[5])+fHat[4]-1.0*fHat[3]+fHat[2]+fHat[1])-1.0*fHat[0]); 
    fHatVal[21] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*fHat[30]-0.1111111111111111*fHat[29]+0.1111111111111111*fHat[28]-0.1111111111111111*fHat[27]+0.1111111111111111*fHat[26]+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*(fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20])+fHat[19]-1.0*fHat[18]+fHat[17]-1.0*fHat[16])-0.3333333333333333*fHat[15]+0.3333333333333333*fHat[14]-0.3333333333333333*fHat[13]+0.3333333333333333*fHat[12]-0.3333333333333333*fHat[11]+0.3333333333333333*fHat[10]-0.3333333333333333*(fHat[9]+fHat[8])+0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]+0.5773502691896258*(fHat[5]-1.0*fHat[4]+fHat[3]-1.0*fHat[2]+fHat[1])+fHat[0]); 
    fHatVal[22] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*fHat[30]+0.1111111111111111*(fHat[29]+fHat[28])-0.1111111111111111*fHat[27]+0.1111111111111111*fHat[26]+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]+fHat[22]-1.0*(fHat[21]+fHat[20]+fHat[19]-1.0*(fHat[18]+fHat[17])+fHat[16]))-0.3333333333333333*fHat[15]+0.3333333333333333*(fHat[14]+fHat[13])-0.3333333333333333*(fHat[12]+fHat[11]+fHat[10])+0.3333333333333333*(fHat[9]+fHat[8])-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]-1.0*fHat[4]+fHat[3]+fHat[2]-1.0*fHat[1])+fHat[0]); 
    fHatVal[23] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*((-0.1111111111111111*fHat[30])+0.1111111111111111*(fHat[27]-1.0*(fHat[29]+fHat[28]))-0.1111111111111111*fHat[26])+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]-1.0*(fHat[22]+fHat[21]+fHat[20]-1.0*(fHat[19]+fHat[18]+fHat[17])))-1.0*(0.1924500897298753*fHat[16]-0.3333333333333333*fHat[15]-0.3333333333333333*(fHat[10]-1.0*(fHat[14]+fHat[13]+fHat[12]-1.0*fHat[11]))-1.0*(0.3333333333333333*fHat[9]-0.3333333333333333*fHat[8]))-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*(fHat[4]-1.0*fHat[5])-1.0*(0.5773502691896258*(fHat[3]+fHat[2]+fHat[1])+fHat[0])); 
    fHatVal[24] = -0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*(fHat[26]-1.0*(fHat[30]+fHat[29]+fHat[28]-1.0*fHat[27]))+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]-1.0*(fHat[22]+fHat[21]+fHat[20]+fHat[19]+fHat[18]+fHat[17]-1.0*fHat[16]))-1.0*(0.3333333333333333*fHat[15]-1.0*(0.3333333333333333*(fHat[14]+fHat[13]+fHat[12]+fHat[11]+fHat[10])-1.0*(0.3333333333333333*fHat[8]-0.3333333333333333*fHat[9])))-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*((-1.0*(fHat[5]+fHat[4]))+fHat[3]+fHat[2]+fHat[1])-1.0*fHat[0]); 
    fHatVal[25] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*fHat[30]-0.1111111111111111*(fHat[29]+fHat[28])+0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]+fHat[22]-1.0*(fHat[21]+fHat[20]-1.0*fHat[19]+fHat[18]+fHat[17]-1.0*fHat[16]))+0.3333333333333333*fHat[15]-0.3333333333333333*(fHat[14]+fHat[13])+0.3333333333333333*fHat[12]-0.3333333333333333*(fHat[11]+fHat[10])+0.3333333333333333*(fHat[9]+fHat[8])-0.3333333333333333*(fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]+fHat[4]-1.0*(fHat[3]+fHat[2]-1.0*fHat[1]))+fHat[0]); 
    fHatVal[26] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*fHat[30]+0.1111111111111111*fHat[29]-0.1111111111111111*fHat[28]+0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*(fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20]+fHat[19]-1.0*fHat[18]+fHat[17]-1.0*fHat[16]))+0.3333333333333333*fHat[15]-0.3333333333333333*fHat[14]+0.3333333333333333*fHat[13]-0.3333333333333333*(fHat[12]+fHat[11])+0.3333333333333333*fHat[10]-0.3333333333333333*(fHat[9]+fHat[8])+0.3333333333333333*fHat[7]-0.3333333333333333*fHat[6]+0.5773502691896258*(fHat[5]+fHat[4]-1.0*fHat[3]+fHat[2]-1.0*fHat[1])+fHat[0]); 
    fHatVal[27] = -0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*(fHat[30]+fHat[29])+0.1111111111111111*((-1.0*fHat[28])+fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]-1.0*fHat[22])+fHat[21]-1.0*fHat[20]+fHat[19]+fHat[18]-1.0*fHat[17]+fHat[16])-1.0*(0.3333333333333333*fHat[15]-1.0*(0.3333333333333333*(fHat[14]-1.0*(fHat[13]+fHat[12]-1.0*fHat[11]))-1.0*(0.3333333333333333*fHat[10]-1.0*(0.3333333333333333*fHat[8]-0.3333333333333333*fHat[9])-0.3333333333333333*fHat[7]+0.3333333333333333*fHat[6])))+0.5773502691896258*(fHat[3]-1.0*(fHat[5]+fHat[4]))-1.0*(0.5773502691896258*(fHat[2]+fHat[1])+fHat[0])); 
    fHatVal[28] = 0.1767766952966368*(0.06415002990995844*fHat[31]-0.1111111111111111*(fHat[30]+fHat[29])+0.1111111111111111*(fHat[28]+fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]-1.0*(fHat[24]+fHat[23]+fHat[22]+fHat[21]-1.0*fHat[20]+fHat[19]+fHat[18]-1.0*(fHat[17]+fHat[16])))+0.3333333333333333*(fHat[15]+fHat[14])-0.3333333333333333*(fHat[13]+fHat[12])+0.3333333333333333*fHat[11]-0.3333333333333333*(fHat[10]+fHat[9]+fHat[8]+fHat[7])+0.3333333333333333*fHat[6]+0.5773502691896258*(fHat[5]+fHat[4]+fHat[3]-1.0*(fHat[2]+fHat[1]))+fHat[0]); 
    fHatVal[29] = -0.1767766952966368*(0.06415002990995844*fHat[31]-1.0*((-0.1111111111111111*fHat[30])-1.0*(0.1111111111111111*fHat[28]-0.1111111111111111*fHat[29]))+0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*((-1.0*fHat[25])+fHat[24]-1.0*fHat[23]+fHat[22]-1.0*fHat[21]+fHat[20]+fHat[19]-1.0*fHat[18]+fHat[17]+fHat[16])-1.0*(0.3333333333333333*fHat[15]-1.0*((-0.3333333333333333*fHat[14])-1.0*(0.3333333333333333*(fHat[12]+fHat[11]-1.0*(fHat[10]-1.0*(fHat[9]-1.0*(fHat[8]-1.0*(fHat[7]-1.0*fHat[6])))))-0.3333333333333333*fHat[13]))+0.5773502691896258*(fHat[5]+fHat[4]+fHat[3]-1.0*fHat[2]))-1.0*(0.5773502691896258*fHat[1]+fHat[0])); 
    fHatVal[30] = -0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*((-1.0*fHat[30])+fHat[29]+fHat[28])+0.1111111111111111*(fHat[27]+fHat[26])+0.1924500897298753*((-1.0*(fHat[25]+fHat[24]))+fHat[23]-1.0*fHat[22]+fHat[21]+fHat[20]-1.0*fHat[19]+fHat[18]+fHat[17]+fHat[16])-1.0*(0.3333333333333333*fHat[15]-1.0*((-0.3333333333333333*fHat[14])-0.3333333333333333*fHat[13]-0.3333333333333333*((-1.0*fHat[12])+fHat[11]+fHat[10])-1.0*(0.3333333333333333*(fHat[8]-1.0*fHat[9])-0.3333333333333333*(fHat[7]+fHat[6])))+0.5773502691896258*(fHat[5]+fHat[4]+fHat[3]+fHat[2]-1.0*fHat[1]))-1.0*fHat[0]); 
    fHatVal[31] = 0.1767766952966368*(0.06415002990995844*fHat[31]+0.1111111111111111*(fHat[30]+fHat[29]+fHat[28]+fHat[27]+fHat[26])+0.1924500897298753*(fHat[25]+fHat[24]+fHat[23]+fHat[22]+fHat[21]+fHat[20]+fHat[19]+fHat[18]+fHat[17]+fHat[16])+0.3333333333333333*(fHat[15]+fHat[14]+fHat[13]+fHat[12]+fHat[11]+fHat[10]+fHat[9]+fHat[8]+fHat[7]+fHat[6])+0.5773502691896258*(fHat[5]+fHat[4]+fHat[3]+fHat[2]+fHat[1])+fHat[0]); 

    for(int i=0; i<32; i++) {
      double ratio = fHatVal[i]/(-fVolVal[i] + EPSILON);
      if(ratio>=0.0) alpha = std::min(alpha, ratio);
    }
  } 
  return alpha; 
}

double limiter(const double *fVol, const double *fHat, double *fVolOut, int ndim, int numBasis)
{
  double alpha = findAlpha(fVol, fHat, ndim);
  for(int i=0; i<numBasis; i++) {
    fVolOut[i] = alpha*fVol[i];
  }

  return 0.0;
}
