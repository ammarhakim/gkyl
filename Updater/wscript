## -*- python -*-
# Build code in this directory
##    _______     ___
## + 6 @ |||| # P ||| +

import os
from waflib import Utils

def build(bld):
    sources = r"""
    momentCalcData/IntegratedDGMomentSer1x.cpp
    momentCalcData/IntegratedDGMomentSer2x.cpp
    momentCalcData/IntegratedDGMomentSer3x.cpp
    momentCalcData/IntegratedDGMomentSer4x.cpp
    momentCalcData/IntegratedDGMomentSer5x.cpp
    momentCalcData/IntegratedDGMomentSer6x.cpp
    momentCalcData/IntegratedDGMomentSer1x1v.cpp
    momentCalcData/IntegratedDGMomentSer1x2v.cpp
    momentCalcData/IntegratedDGMomentSer1x3v.cpp
    momentCalcData/IntegratedDGMomentSer2x2v.cpp
    momentCalcData/IntegratedDGMomentSer2x3v.cpp
    momentCalcData/IntegratedDGMomentSer3x3v.cpp

    mgPoissonCalcData/MGpoissonDGSer1x.cpp
    mgPoissonCalcData/MGpoissonDGSer2x.cpp
    mgPoissonCalcData/MGpoissonFEMSer1x.cpp
    mgPoissonCalcData/MGpoissonFEMSer2x.cpp
    mgPoissonCalcData/MGpoissonESenergySer1x.cpp
    mgPoissonCalcData/MGpoissonESenergySer2x.cpp

    momentCalcData/DistFuncMomentLBOCalcSer1x1v.cpp
    momentCalcData/DistFuncMomentLBOCalcSer1x2v.cpp
    momentCalcData/DistFuncMomentLBOCalcSer1x3v.cpp
    momentCalcData/DistFuncMomentLBOCalcSer2x2v.cpp
    momentCalcData/DistFuncMomentLBOCalcSer2x3v.cpp
    momentCalcData/DistFuncMomentLBOCalcSer3x3v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcSer1x1v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcSer1x2v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcSer2x2v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcSer3x2v.cpp

    momentCalcData/DistFuncMomentLBOCalcTensor1x1v.cpp
    momentCalcData/DistFuncMomentLBOCalcTensor1x2v.cpp
    momentCalcData/DistFuncMomentLBOCalcTensor1x3v.cpp
    momentCalcData/DistFuncMomentLBOCalcTensor2x2v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcTensor1x1v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcTensor1x2v.cpp
    momentCalcData/DistFuncGkMomentLBOCalcTensor2x2v.cpp

    momentCalcData/DistFuncMomentCalcSer1x1v.cpp
    momentCalcData/DistFuncMomentCalcSer1x2v.cpp
    momentCalcData/DistFuncMomentCalcSer1x3v.cpp
    momentCalcData/DistFuncMomentCalcSer2x2v.cpp
    momentCalcData/DistFuncMomentCalcSer2x3v.cpp
    momentCalcData/DistFuncMomentCalcSer3x3v.cpp

    momentCalcData/DistFuncMomentCalcTensor1x1v.cpp
    momentCalcData/DistFuncMomentCalcTensor1x2v.cpp
    momentCalcData/DistFuncMomentCalcTensor1x3v.cpp
    momentCalcData/DistFuncMomentCalcTensor2x2v.cpp

    momentCalcData/DistFuncGkMomentCalcSer1x1v.cpp
    momentCalcData/DistFuncGkMomentCalcSer1x2v.cpp
    momentCalcData/DistFuncGkMomentCalcSer2x2v.cpp
    momentCalcData/DistFuncGkMomentCalcSer3x2v.cpp

    momentCalcData/DistFuncGkMomentCalcTensor1x1v.cpp
    momentCalcData/DistFuncGkMomentCalcTensor1x2v.cpp
    momentCalcData/DistFuncGkMomentCalcTensor2x2v.cpp

    momentCalcData/DistFuncIntegratedMomentCalcSer1x1v.cpp
    momentCalcData/DistFuncIntegratedMomentCalcSer1x2v.cpp
    momentCalcData/DistFuncIntegratedMomentCalcSer1x3v.cpp
    momentCalcData/DistFuncIntegratedMomentCalcSer2x2v.cpp
    momentCalcData/DistFuncIntegratedMomentCalcSer2x3v.cpp
    momentCalcData/DistFuncIntegratedMomentCalcSer3x3v.cpp

    """

    ## HyperDisContDeviceShared.cu
    # CUDA specific code
    if bld.env['CUTOOLS_FOUND']:
        cusources = r"""
        DummyStructDevice.cu
        """

        bld(source = cusources,
            name = 'updater_cu', target='updater_cu',
            includes = '. ../Cuda ../Grid ../Lib ../Basis ../Eq ../DataStruct momentCalcData ../Eq/vlasovData', features = 'cxx nvcc '
        )


    bld.shlib(source = sources,

              includes = '. ../Cuda interpolateCalcData mgPoissonCalcData momentCalcData twistShiftData projectFluxOnGhostsData aSheathPotentialData', 

              use='lib EIGEN MPI CUTOOLS gkylzero', target = 'updater', name = 'updater', vum = '1.0')
    
## Removed the following files from the build for now
#    interpolateCalcData/CartFieldInterpSer1x.cpp
#    interpolateCalcData/CartFieldInterpSer2x.cpp
#
#    projectFluxOnGhostsData/ProjectFluxOnGhostsSer.cpp
#
#    EvaluateBronoldFehskeBCImpl.cpp

#    MomentSrcCommon.cpp
#    FiveMomentSrcImpl.cpp
#    TenMomentSrcImpl.cpp
#    TenMomentRelaxImpl.cpp
#    AxisymmetricFiveMomentSrcImpl.cpp
#    AxisymmetricPhMaxwellSrcImpl.cpp
#    FiveMomentFrictionSrcImpl.cpp
#
#    FemMatrices.cpp
#    FemPerpPoissonImpl.cpp
#    FemParPoissonImpl.cpp
#
#    DiscontPoissonImpl.cpp  
#    FemGyroaverageImpl.cpp
#    MappedPoissonImpl.cpp
#    EvalOnNodesImpl.cpp
#
#     binOpCalcData/CartFieldBinOpSer3x3vP2.cpp
#    lagrangeFixData/lagrangeFix_gk_1x2v_ser_p2.cpp
#    lagrangeFixData/lagrangeFix_gk_1x2v_tensor_p2.cpp
#    lagrangeFixData/lagrangeFix_gk_2x2v_max_p1.cpp
#    lagrangeFixData/lagrangeFix_gk_2x2v_ser_p1.cpp
#    lagrangeFixData/lagrangeFix_gk_2x2v_tensor_p1.cpp
